MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ; ============================================================================
                      00002 ; PROGRAM: MIO16x16/AD
                      00003 ; Dispositivo de interface I/O 16 Entradas, 16 Salidas TTL
                      00004 ; 4 Entradas analogicas
                      00005 ; Medicion de temperatura on board
                      00006 ; conexion teclado
                      00007 ; i2c / SPI
                      00008 ; Serial 1200,N,8,1 (configurable 1200 a 19200)
                      00009 ; Walter Gabriel Pirri
                      00010 ; ----------------------------------------------------------------------------
                      00011 ; PIC 16F877 /877A /887
                      00012 ;
                      00013 ; SELECCIONAR EL PROCESADOR EN: Configure -> Select Device...
                      00014 ;
                      00015 ;     PORT A: 0 - A/D Onboard
                      00016 ;             1 - A/D Ext. 1
                      00017 ;             2 - A/D Ext. 2
                      00018 ;             3 - A/D Ext. 3
                      00019 ;             4 - Dig Ext. 1
                      00020 ;             5 - I2C/SPI - SS
                      00021 ;
                      00022 ;     PORT B: 0 - INT
                      00023 ;             1 - Display EN
                      00024 ;             2 - Display RS
                      00025 ;             3 - Display RW
                      00026 ;             4 - Disable Entrada 1
                      00027 ;             5 - Enable salida 2
                      00028 ;             6 - Enable salida 1
                      00029 ;             7 - Disable Entrada 1
                      00030 ;
                      00031 ;     PORT C: 0 - PWM CK
                      00032 ;             1 - PWM2
                      00033 ;             2 - PWM1
                      00034 ;             3 - I2C/SPI - SCK/SCL
                      00035 ;             4 - I2C/SPI - SDI/SDA
                      00036 ;             5 - I2C/SPI - SDO
                      00037 ;             6 - Serial Tx
                      00038 ;             7 - Serial Rx
                      00039 ;
                      00040 ;     PORT D: BUS de datos
                      00041 ;
                      00042 ;     PORT E: 0 - Status led
                      00043 ;             1 - Buzzer
                      00044 ;             2 - Disable Keyboard
                      00045 ;
                      00046 ; ----------------------------------------------------------------------------
                      00047 ; Xtal 3,6864 MHz
                      00048 ; div interna /4 /256 (normal) = 278us
                      00049 ; ----------------------------------------------------------------------------
                      00050 ; prescaler asignado a WDT
                      00051 ; divisores timer(3,6864 Mhz) / 4 / 256 / 36 / 100
                      00052 ;                                          \_ 10ms
                      00053 ;                                                \_ 1 seg
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00054 ; ciclo de instruccion  1,08us
                      00055 ; int timer             278us
                      00056 ; ============================================================================
                      00057 ; Include processor definitions
                      00058  ifdef __16F877
                      00059   include "p16f877.inc"
                      00060  endif
                      00061 
                      00062  ifdef __16F877A
                      00063   include "p16f877a.inc"
                      00064  endif
                      00065 
                      00066  ifdef __16F887
                      00067   include "p16f887.inc"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Feb 13 2015
                      00005 ;  MPASM PIC16F887 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2015 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00810         LIST
                      00068  endif
                      00069 
                      00070 ; ----------------------------------------------------------------------------
                      00071 ; Configuration bits
                      00072  ifdef __16F887
2007   2FE9           00073   __CONFIG _CONFIG1, _XT_OSC & _WDT_ON & _CP_OFF & _PWRTE_ON & _LVP_OFF
2008   3FFF           00074   __CONFIG _CONFIG2, _WRT_OFF
                      00075  else
                      00076   __CONFIG _XT_OSC & _WDT_ON & _CP_OFF & _PWRTE_ON & _LVP_OFF
                      00077  endif
                      00078 ; ============================================================================
                      00079   include "const.inc"
                      00001 ; ============================================================================
                      00002 ; Constantes
                      00003 ; ============================================================================
                      00004 #define HARTYPE       0x02    ; tipo de placa
                      00005 #define HARDVER       0x01    ; versión de hard
                      00006 #define SOFTVER       0x01    ; version de soft
                      00007 
                      00008  ifdef __16F877
                      00009 #define PROCESSOR_VER 0x01    ; procesador 16F877
                      00010  endif
                      00011  ifdef __16F877A
                      00012 #define PROCESSOR_VER 0x02    ; procesador 16F877A
                      00013  endif
                      00014  ifdef __16F887
                      00015 #define PROCESSOR_VER 0x03    ; procesador 16F887
                      00016  endif
                      00017 
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00018 #define DEFADDR       0xFE    ; direccion inicial de RS-232 de la placa
                      00019 #define HSTADDR       0x00    ; direccion inicial de RS-232 del host
                      00020 #define BSTADDR       0xFF    ; direccion RS-232 de broadcast
                      00021 #define MARCA_EE_OK   0xB8    ; Marca que se escibe al inicio de la EE, modificar
                      00022                               ; cada vez que se cambie su estructura
                      00023                               ; se debe saltear FF Y 00
                      00024 #define SENS_INPUT    0x05    ; cantidad de veces que se sondea una entrada
                      00025 #define CONFIG_START  0xC0    ; Dirección de inicio del área de configuracion
                      00026 #define CONV_DELAY    0x05    ; Delay entre la selección del canal y el GO (x10ms)
                      00027 #define DIVISOR1      0x24    ; divisor del timer para 10ms aprox
                      00028 #define DIVISOR2      0x64    ; divisor del timer para 1s aprox
                      00029 #define BTNFILTER     0x32    ; delay para deteccion de botón (x10ms)
                      00030                               ; BANK3)
                      00031 #define REINTENTOS    0x0A    ; reintentos de envio de un requerimiento antes de
                      00032                               ; descartarlo
                      00033 #define REINT_DELAY   0x0C    ; delay maximo entre reintentos
                      00034 #define LONG_BEEP     0x32
                      00035 #define SHORT_BEEP    0x06
                      00036 #define BEEP_DELAY    0x0C
                      00037 ; Funcionalidad de bits del PORTA
                      00038 #define IR_OUT        PORTA,4
                      00039 
                      00040 
                      00041 ; Funcionalidad de bits del PORTB
                      00042 #define INT0          PORTB,0
                      00043 #define DISPLAY_EN    PORTB,1
                      00044 #define DISPLAY_RS    PORTB,2
                      00045 #define DISPLAY_RW    PORTB,3
                      00046 #define NIN1          PORTB,4
                      00047 #define OUT2          PORTB,5
                      00048 #define OUT1          PORTB,6
                      00049 #define NIN2          PORTB,7
                      00050 ; Bus de datos PORTD
                      00051 #define DATABUS       PORTD
                      00052 #define TRISBUS       TRISD
                      00053 ; Funcionalidad de bits del PORTE
                      00054 #define STAT_LED      PORTE,0      ; led de status (on board o en panel)
                      00055 #define BUZZER        PORTE,1      ; buzzer (on board o en panel)
                      00056 #define BTN_EN        PORTE,2      ; linea de habilitación de botones de teclado
                      00080   include "vars.inc"
                      00001 ; ============================================================================
                      00002 ; Variables
                      00003 ; ============================================================================
                      00004 ; BANK-0 (0x20..0x6F)
                      00005 ; Salvado de Contexto (el de W está en el área global)
  00000020            00006 status_saved  equ 0x20  ; para el salvado de contexto (resgistro STATUS)
  00000021            00007 pclath_saved  equ 0x21  ; para el salvado de contexto (registro PCLATH)
  00000022            00008 fsr_saved     equ 0x22  ; para el salvado de contexto (registro FSR)
                      00009 ; Flags de I/O
  00000023            00010 TDIV1         equ 0x23  ; Contador para el divisor del timer
  00000024            00011 TDIV2         equ 0x24  ; Contador para el divisor del timer
                      00012 ;
  00000025            00013 DelayDisplay  equ 0x25  ; Para implementar un delay entre cambios de mensajes 
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000026            00014 ErrCde1       equ 0x26  ; almacena el numero del ultimo error el procesar un mensaje
  00000027            00015 DisplayTO     equ 0x27  ; Lleva la cuenta del time-out en la inicializacion del
                      00016                         ; display para determinar si está conectado
  00000028            00017 Variant       equ 0x28  ; secuencia para los requerimientos salientes
                      00018 ;
  00000029            00019 TxPtrAdd      equ 0x29  ; Puntero donde agregar datos para enviar en BANK2
  0000002A            00020 TxPtrSnd      equ 0x2A  ; puntero donde leer datos para enviar en BANK2
  0000002B            00021 RxPtrAdd      equ 0x2B  ; puntero donde agregar datos recibidos en BANK3 se le
                      00022                         ; asigna el TMP cuando tengo un mensaje OK
  0000002C            00023 RxPtrAddTmp   equ 0x2C  ; puntero temporal donde agregar datos recibidos en
                      00024                         ; BANK3 para volver en caso de error
  0000002D            00025 RxPtrRcv      equ 0x2D  ; puntaro donde leer para procesar datos recibidos
                      00026                         ; en BANK3
  0000002E            00027 RxChar        equ 0x2E  ; acá se mueve el caracter recibido para tratarlo
  0000002F            00028 RxCharCount   equ 0x2F  ; lleva la cuenta de los caracteres recibidos para un
                      00029                         ; mensaje
  00000030            00030 RxCharSum     equ 0x30  ; lleva el calculo del checksum a medida que llega el
                      00031                         ; mensaje
  00000031            00032 RxTimeOut     equ 0x31  ; Es para dar un timeout a los mensajes incompletos
  00000032            00033 RxLastCnt     equ 0x32  ; Mantiene el valor de ultimo contador de msg recibido
  00000033            00034 SaveEECount   equ 0x33  ; Cuenta regresiva para grabar configuracion
  00000034            00035 ResetCount    equ 0x34  ; Delay para reset por soft
  00000035            00036 DelayStart    equ 0x35  ; Delay de aranque
  00000036            00037 DelayResend   equ 0x36  ; Contador de Delay para cualquier reenvío de mensaje
  00000037            00038 CountNotifE1  equ 0x37  ; Reintentos de reenvio de notificacion de E1
  00000038            00039 CountNotifE2  equ 0x38  ; Reintentos de reenvio de notificacion de E2
  00000039            00040 CountNotifA1  equ 0x39  ; Reintentos de reenvio de notificacion de AN1
  0000003A            00041 CountNotifA2  equ 0x3A  ; Reintentos de reenvio de notificacion de AN2
  0000003B            00042 CountNotifA3  equ 0x3B  ; Reintentos de reenvio de notificacion de AN3
  0000003C            00043 CountNotifA4  equ 0x3C  ; Reintentos de reenvio de notificacion de AN4
  0000003D            00044 CountNotifS1  equ 0x3D  ; Reintentos de reenvio de notificacion de S1
  0000003E            00045 CountNotifS2  equ 0x3E  ; Reintentos de reenvio de notificacion de S2
  0000003F            00046 ANALOG1H      equ 0x3F  ; imagen interna de entrada analogica 1 - parte alta
  00000040            00047 ANALOG1L      equ 0x40  ; imagen interna de entrada analogica 1 - parte baja
  00000041            00048 ANALOG2H      equ 0x41  ; imagen interna de entrada analogica 2 - parte alta
  00000042            00049 ANALOG2L      equ 0x42  ; imagen interna de entrada analogica 2 - parte baja
  00000043            00050 ANALOG3H      equ 0x43  ; imagen interna de entrada analogica 3 - parte alta
  00000044            00051 ANALOG3L      equ 0x44  ; imagen interna de entrada analogica 3 - parte baja
  00000045            00052 ANALOG4H      equ 0x45  ; imagen interna de entrada analogica 4 - parte alta
  00000046            00053 ANALOG4L      equ 0x46  ; imagen interna de entrada analogica 4 - parte baja
  00000047            00054 ConvertDelay  equ 0x47  ; espera luego de elegir una entrada A/D
  00000048            00055 CntTrafic     equ 0x48  ; Contador para WFT
  00000049            00056 RegTmpI       equ 0x49  ; Registro temporal para usar dentro de interrupciones
  0000004A            00057 RegTmpG       equ 0x4A  ; registro temporal generico
  0000004B            00058 RegTmpG2      equ 0x4B  ; registro temporal generico
  0000004C            00059 RegTmpD       equ 0x4C  ; Registro temporal para funciones de delay
  0000004D            00060 RegTmpL       equ 0x4D  ; Registro temporal para funciones de delay (cuando hay loop de delay)
  0000004E            00061 ReadIRetry    equ 0x4E  ; contador para los reintentos de lectura de entrada
  0000004F            00062 IRCount       equ 0x4F
                      00063 ; - Registro para colocar un mensaje salido del buffer de entrada y procesarlo
                      00064 ; - RX
  00000050            00065 rxtyp         equ 0x50 ; -----
  00000051            00066 rxdst         equ 0x51 ;      |
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000052            00067 rxsrc         equ 0x52 ;      |
  00000053            00068 rxcnt         equ 0x53 ;      |
  00000054            00069 rxfcn         equ 0x54 ;      |
  00000055            00070 rxdat1        equ 0x55 ;      |
  00000056            00071 rxdat2        equ 0x56 ;      |
  00000057            00072 rxdat3        equ 0x57 ;      | Para referencia directa
  00000058            00073 rxdat4        equ 0x58 ;      |
  00000059            00074 rxdat5        equ 0x59 ;      |
  0000005A            00075 rxdat6        equ 0x5A ;      |
  0000005B            00076 rxdat7        equ 0x5B ;      |
  0000005C            00077 rxdat8        equ 0x5C ;      |
  0000005D            00078 rxdat9        equ 0x5D ;      |
  0000005E            00079 rxdat10       equ 0x5E ;      |
  0000005F            00080 rxchksum      equ 0x5F ; -----
                      00081 ;
                      00082 ; - Registro para el armado de mensaje saliente antes de transferir al buffer
                      00083 ;   de salida.
                      00084 ; - TX
  00000060            00085 txtyp         equ 0x60 ; -----
  00000061            00086 txdst         equ 0x61 ;      |
  00000062            00087 txsrc         equ 0x62 ;      |
  00000063            00088 txcnt         equ 0x63 ;      |
  00000064            00089 txfcn         equ 0x64 ;      |
  00000065            00090 txdat1        equ 0x65 ;      |
  00000066            00091 txdat2        equ 0x66 ;      |
  00000067            00092 txdat3        equ 0x67 ;      | Para referencia directa
  00000068            00093 txdat4        equ 0x68 ;      |
  00000069            00094 txdat5        equ 0x69 ;      |
  0000006A            00095 txdat6        equ 0x6A ;      |
  0000006B            00096 txdat7        equ 0x6B ;      |
  0000006C            00097 txdat8        equ 0x6C ;      |
  0000006D            00098 txdat9        equ 0x6D ;      |
  0000006E            00099 txdat10       equ 0x6E ;      |
  0000006F            00100 txchksum      equ 0x6F ; -----
                      00101 
                      00102 ; ============================================================================
                      00103 ; BANK-1 (0xA0..0xEF)
  000000A0            00104 ContBtn0      equ 0xA0 ;---
  000000A1            00105 ContBtn1      equ 0xA1 ;   |
  000000A2            00106 ContBtn2      equ 0xA2 ;   | Filtro de ruido para botones
  000000A3            00107 ContBtn3      equ 0xA3 ;   | 0x00      = boton suelto
  000000A4            00108 ContBtn4      equ 0xA4 ;   | BTNFILTER = boton apretado
  000000A5            00109 ContBtn5      equ 0xA5 ;   |
  000000A6            00110 ContBtn6      equ 0xA6 ;   |
  000000A7            00111 ContBtn7      equ 0xA7 ;---
  000000A8            00112 BOTONES       equ 0xA8 ; estado filtrado de los botones
  000000A9            00113 EXT_BOTONES   equ 0xA9 ; estado crudo de los botones
  000000AA            00114 HEXADECIMAL   equ 0xAA
  000000AB            00115 DEC_H         equ 0xAB
  000000AC            00116 DEC_M         equ 0xAC
  000000AD            00117 DEC_L         equ 0xAD
  000000AE            00118 BeepRetry     equ 0xAE
  000000AF            00119 BeepDelay     equ 0xAF
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  000000B0            00120 BeepCount     equ 0xB0
  000000B1            00121 BKSALIDA1     equ 0xB1
  000000B2            00122 BKSALIDA2     equ 0xB2
  000000B3            00123 ADALRM1DELAY  equ 0xB3
  000000B4            00124 ADALRM2DELAY  equ 0xB4
  000000B5            00125 ADALRM3DELAY  equ 0xB5
  000000B6            00126 ADALRM4DELAY  equ 0xB6
  000000B7            00127 IRCodeByte    equ 0xB7 ; Se carga con el byte IR que se está transmitiendo
  000000B8            00128 IRCodeByteI   equ 0xB8 ; Contiene el indice del byte IR que se debe cargar
  000000B9            00129 IRCode1       equ 0xB9
  000000BA            00130 IRCode2       equ 0xBA
  000000BB            00131 IRCode3       equ 0xBB
  000000BC            00132 IRCode4       equ 0xBC
  000000BD            00133 IRCode5       equ 0xBD
                      00134 ;             equ 0xBE
                      00135 ;             equ 0xBF
                      00136 ; ----------------------------------------------------------------------------
                      00137 ; 0xC0 a 0xEF - Datos persistentes fuera del área global (Colita del BANK-1)
                      00138 ; ----------------------------------------------------------------------------
  000000C0            00139 MaskNotifE1   equ 0xC0 ;---
  000000C1            00140 MaskNotifE2   equ 0xC1 ;   |
  000000C2            00141 MaskNotifS1   equ 0xC2 ;   | Mascaras para notificacion de cambios
  000000C3            00142 MaskNotifS2   equ 0xC3 ;   |
  000000C4            00143 MaskNotifAN   equ 0xC4 ;---
  000000C5            00144 LocHora       equ 0xC5
  000000C6            00145 LocMin        equ 0xC6
  000000C7            00146 LocSeg        equ 0xC7
  000000C8            00147 LocDia        equ 0xC8
  000000C9            00148 LocFecha      equ 0xC9
  000000CA            00149 LocMes        equ 0xCA
  000000CB            00150 LocAnio       equ 0xCB
                      00151 ;             equ 0xCC
                      00152 ;             equ 0xCD
                      00153 ;             equ 0xCE
                      00154 ;             equ 0xCF
  000000D0            00155 ContPulseE1B0 equ 0xD0 ;---
  000000D1            00156 ContPulseE1B1 equ 0xD1 ;   |
  000000D2            00157 ContPulseE1B2 equ 0xD2 ;   |
  000000D3            00158 ContPulseE1B3 equ 0xD3 ;   |
  000000D4            00159 ContPulseE1B4 equ 0xD4 ;   |
  000000D5            00160 ContPulseE1B5 equ 0xD5 ;   |
  000000D6            00161 ContPulseE1B6 equ 0xD6 ;   |
  000000D7            00162 ContPulseE1B7 equ 0xD7 ;   | Contadores para el regreso del pulso
  000000D8            00163 ContPulseE2B0 equ 0xD8 ;   |
  000000D9            00164 ContPulseE2B1 equ 0xD9 ;   |
  000000DA            00165 ContPulseE2B2 equ 0xDA ;   |
  000000DB            00166 ContPulseE2B3 equ 0xDB ;   |
  000000DC            00167 ContPulseE2B4 equ 0xDC ;   |
  000000DD            00168 ContPulseE2B5 equ 0xDD ;   |
  000000DE            00169 ContPulseE2B6 equ 0xDE ;   |
  000000DF            00170 ContPulseE2B7 equ 0xDF ;--- 
  000000E0            00171 ANALOG1_MAXH  equ 0xE0
  000000E1            00172 ANALOG1_MAXL  equ 0xE1
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  000000E2            00173 ANALOG1_MINH  equ 0xE2
  000000E3            00174 ANALOG1_MINL  equ 0xE3
  000000E4            00175 ANALOG2_MAXH  equ 0xE4
  000000E5            00176 ANALOG2_MAXL  equ 0xE5
  000000E6            00177 ANALOG2_MINH  equ 0xE6
  000000E7            00178 ANALOG2_MINL  equ 0xE7
  000000E8            00179 ANALOG3_MAXH  equ 0xE8
  000000E9            00180 ANALOG3_MAXL  equ 0xE9
  000000EA            00181 ANALOG3_MINH  equ 0xEA
  000000EB            00182 ANALOG3_MINL  equ 0xEB  
  000000EC            00183 ANALOG4_MAXH  equ 0xEC
  000000ED            00184 ANALOG4_MAXL  equ 0xED
  000000EE            00185 ANALOG4_MINH  equ 0xEE
  000000EF            00186 ANALOG4_MINL  equ 0xEF
                      00187 
                      00188 ; ============================================================================
                      00189 ; BANK-2 (0x110..0x16F)
  00000010            00190 TXINITBUFFER  equ 0x10    ; inicio de cola de transmisión (16 Bytes por msg)
  0000006F            00191 TXMAXBUFFER   equ 0x6F    ; limite superior de la cola de transmisión
                      00192 
                      00193 ; ============================================================================
                      00194 ; BANK-3 (0x190..0x1EF)
                      00195 ; buffer de recepción
  00000090            00196 RXINITBUFFER  equ 0x90    ; inicio de cola de recepción (15 bytes por msg)
  000000E9            00197 RXMAXBUFFER   equ 0xE9    ; limite superior de la cola de recepción
                      00198 
                      00199 ; ============================================================================
                      00200 ; Globales (0x70..0x7F) (0xF0..0xFF) (0x170..0x17F) (0x1F0..0x1FF)
                      00201 ; backup de contexto en INT
  00000070            00202 w_saved       equ 0x70 ; para el salvado de contexto (registro w)
                      00203 ; Configuracion y estados perdurables
  00000071            00204 LocAddr       equ 0x71 ; Dirección local
  00000072            00205 SALIDA1       equ 0x72
  00000073            00206 SALIDA2       equ 0x73
  00000074            00207 ENTRADA1      equ 0x74  ; imagen interna de entrada 1
  00000075            00208 ENTRADA2      equ 0x75  ; imagen interna de entrada 2
  00000076            00209 Mascara_E1S1  equ 0x76  ; Configuracion bit a bit del seguimiento a las entradas 1 por las salidas 1
  00000077            00210 Mascara_E2S2  equ 0x77  ; Configuracion bit a bit del seguimiento a las entradas 2 por las salidas 2
  00000078            00211 Mascara_ANS2  equ 0x78  ; Configuracion bit a bit del seguimiento a las entradas analogicas por las sali
                            das 2
  00000079            00212 ANALOG_FLGS   equ 0x79  ; flags de estados de entradas analogicas
                      00213 #define AN1_UMBRAL ANALOG_FLGS,0    ; 0 = (ANALOG1 <= ANALOG1_MIN)
                      00214                                     ; 1 = (ANALOG1 >= ANALOG1_MAX)
                      00215 #define AN2_UMBRAL ANALOG_FLGS,1    ;
                      00216 #define AN3_UMBRAL ANALOG_FLGS,2    ;
                      00217 #define AN4_UMBRAL ANALOG_FLGS,3    ;
                      00218 #define ADC_READY  ANALOG_FLGS,4    ; Indica que ya fueron escaneados por lo
                      00219                                     ; menos una vez todas las entradas
                      00220 ; Serial Baud Rate
                      00221 ;  0xBF      1200 
                      00222 ;  0x5F      2400
                      00223 ;  0x17      9600 *
                      00224 ;  0x0B     19200
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000007A            00225 BaudRate      equ 0x7A
  0000007B            00226 DISPLAY_FLGS  equ 0x7B
                      00227 #define DISPLAY_OK    DISPLAY_FLGS,0  ; Indica la presencia del display
                      00228 #define DISPLAY_INIT  DISPLAY_FLGS,1  ; Indica que el display ya está inicializado
                      00229 #define DISPLAY_DATA  DISPLAY_FLGS,2  ; Indica que hay datos para mostrar en el display
                      00230 #define DATE_OK       DISPLAY_FLGS,3  ; Indica que ya se obtuvo una fecha y hora valida
                      00231 #define DISPLAY_CLOCK DISPLAY_FLGS,4  ; Indica que hay que refrescar el reloj
                      00232 
  0000007C            00233 ScrnId        equ 0x7C
                      00234 ;             equ 0x7D
                      00235 ; Registros que se acceden de varios bancos
  0000007E            00236 IOFLAGS       equ 0x7E
                      00237 #define CAMBIO_E1 IOFLAGS,0  ;indica cambio en el estado de las entradas o salidas
                      00238 #define CAMBIO_E2 IOFLAGS,1
                      00239 #define CAMBIO_S1 IOFLAGS,2
                      00240 #define CAMBIO_S2 IOFLAGS,3
                      00241 #define CAMBIO_AN IOFLAGS,4
                      00242 #define SEND_IR   IOFLAGS,5  ;indica que se debe transmitir un código infrarrojo
  0000007F            00243 STATFLAGS     equ 0x7F
                      00244 #define HSTONLINE STATFLAGS,0  ; indica que el host está on-line
                      00245 #define SYSREADY  STATFLAGS,1  ; se pone a 1 un par de segundos despues del start
                      00246 #define TXBUFFULL STATFLAGS,2
                      00247 #define RXBUFFULL STATFLAGS,3
                      00248 #define RXCHARERR STATFLAGS,4  ; se utiliza en el control de cada caracter recibido para
                      00249                                ; indicar si sirve o no
                      00250 #define RXCHAREND STATFLAGS,5  ; se utiliza para indicar que se terminó de recibir
                      00251                                ; un mensaje
                      00252 #define SAVETOEE  STATFLAGS,6  ; indica que en el proximo ciclo del loop se graba EE
                      00253 #define DUPMSG    STATFLAGS,7  ; indica que el mensaje recibido está duplicado
                      00081   include "page1.inc"
                      00001 ; gpasm cuando se hace un salto a una posicion que no está en la página 1
                      00002 ;       se queja aunque el destino del salto esté en la misma página que
                      00003 ;       el origen
                      00004  ERRORLEVEL -306
                      00005 ; =.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=
                      00006 ;
                      00007 ;   PAGE 1 - PAGE 1 - PAGE 1 - PAGE 1 - PAGE 1 - PAGE 1 - PAGE 1 - PAGE 1
                      00008 ;
                      00009 ; =.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=
                      00010   org 0x0800    ; cambio de página de memoria de programa (800h-FFFh)
                      00011 ; ============================================================================
                      00012 ; ADCheck - En zona de tablas
                      00013 ; ============================================================================
0800                  00014 ADCheck
                      00015   ; me fijo si estoy en linea
0800   1CFF           00016   btfss   SYSREADY
0801   0008           00017   return
                      00018   ; me fijo si está encendido el conversor
0802   1C1F           00019   btfss   ADCON0,ADON
0803   2???           00020   goto    ADEnable
                      00021   ; me fijo si no estoy esperando para activar el conversor
0804   08C7           00022   movf    ConvertDelay,f
0805   1D03           00023   btfss   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0806   0008           00024   return
                      00025   ; me fijo si no tengo una conversión en curso
0807   189F           00026   btfsc   ADCON0,GO
0808   0008           00027   return                ; todavía está convirtiendo
0809                  00028 ADChanTbl
                      00029   ; hago un salto según el canal que estoy leyendo
0809   081F           00030   movf    ADCON0,w
                      00031  ifdef  __16F887
080A   391C           00032   andlw   0x1C          ; filtro CHS0..CHS2
080B   00C9           00033   movwf   RegTmpI
                      00034   ; borro el carry para que no se me meta en el MSB
080C   1003           00035   bcf     STATUS,C
                      00036  else
                      00037   andlw   0x38          ; filtro CHS0..CHS2
                      00038   movwf   RegTmpI
                      00039   ; borro el carry para que no se me meta en el MSB
                      00040   bcf     STATUS,C
                      00041   rrf     RegTmpI,f
                      00042  endif
080D   1003           00043   bcf     STATUS,C
080E   0CC9           00044   rrf     RegTmpI,f
080F   1003           00045   bcf     STATUS,C
0810   0CC9           00046   rrf     RegTmpI,f
0811   0849           00047   movf    RegTmpI,w
0812   0782           00048   addwf   PCL,f
0813   2???           00049   goto    ADChan1
0814   2???           00050   goto    ADChan2
0815   2???           00051   goto    ADChan3
0816   2???           00052   goto    ADChan4
                      00053 ; ============================================================================
                      00054 ; DEC2ASCII - Convierte el valor numerico en W a su numero ascii
                      00055 ; ============================================================================
0817                  00056 DEC2ASCII
0817   0782           00057   addwf   PCL,f
0818   3430           00058   retlw   '0'
0819   3431           00059   retlw   '1'
081A   3432           00060   retlw   '2'
081B   3433           00061   retlw   '3'
081C   3434           00062   retlw   '4'
081D   3435           00063   retlw   '5'
081E   3436           00064   retlw   '6'
081F   3437           00065   retlw   '7'
0820   3438           00066   retlw   '8'
0821   3439           00067   retlw   '9'
0822   3441           00068   retlw   'A'
0823   3442           00069   retlw   'B'
0824   3443           00070   retlw   'C'
0825   3444           00071   retlw   'D'
0826   3445           00072   retlw   'E'
0827   3446           00073   retlw   'F'
                      00074 ; ============================================================================
0828                  00075 PrintDiaSemana
0828   0782           00076   addwf   PCL,f
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0829   2???           00077   goto    PrintLunes
082A   2???           00078   goto    PrintMartes
082B   2???           00079   goto    PrintMiercoles
082C   2???           00080   goto    PrintJueves
082D   2???           00081   goto    PrintViernes
082E   2???           00082   goto    PrintSabado
082F   2???           00083   goto    PrintDomingo
                      00084 ; ============================================================================
0830                  00085 PrintMes
0830   0782           00086   addwf   PCL,f
0831   2???           00087   goto    PrintEnero
0832   2???           00088   goto    PrintFebrero
0833   2???           00089   goto    PrintMarzo
0834   2???           00090   goto    PrintAbril
0835   2???           00091   goto    PrintMayo
0836   2???           00092   goto    PrintJunio
0837   2???           00093   goto    PrintJulio
0838   2???           00094   goto    PrintAgosto
0839   2???           00095   goto    PrintSeptiembre
083A   2???           00096   goto    PrintOctubre
083B   2???           00097   goto    PrintNoviembre
083C   2???           00098   goto    PrintDiciembre
                      00099 ; ============================================================================
083D                  00100 SelectScreen
083D   0782           00101   addwf   PCL,f
083E   2???           00102   goto    Screen0     ; Offline
083F   2???           00103   goto    Screen1     ; Default
0840   0008           00104   return
0841   0008           00105   return
0842   0008           00106   return
0843   0008           00107   return
0844   0008           00108   return
0845   0008           00109   return
0846   0008           00110   return
                      00111 ; ============================================================================
                      00112 
                      00113 
                      00114 ; ============================================================================
                      00115 ; FIN - Zona de TABLAS
                      00116   org     0x0900
                      00117 ; ============================================================================
                      00118 ; ============================================================================
                      00119 ; Interrupción del timer (cada 278 us)
                      00120 ; ============================================================================
0900                  00121 TimerInt
0900   110B           00122   bcf     INTCON,T0IF     ;borro el flag para que no se redispare
                      00123   ;
0901   0BA3           00124   decfsz  TDIV1,f         ; divido las interrupciones
0902   0008           00125   return
0903   3024           00126   movlw   DIVISOR1
0904   00A3           00127   movwf   TDIV1
                      00128   ; >> cada 10 ms
0905   2???           00129   call    ControlBeep
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0906   2???           00130   call    RxTimeOutCtrl
                      00131   ;call    CheckBtn
0907   2???           00132   call    CtrlStartAD
                      00133   ; decremento el control de timeout del display
0908   08A7           00134   movf    DisplayTO,f
0909   1D03           00135   btfss   STATUS,Z
090A   03A7           00136   decf    DisplayTO,f
                      00137   ; Lecturas analógicas
090B   2???           00138   call    ADCheck
                      00139   ; <<
090C   0BA4           00140   decfsz  TDIV2,f         ; divido las interrupciones
090D   0008           00141   return
090E   3064           00142   movlw   DIVISOR2
090F   00A4           00143   movwf   TDIV2
                      00144   ; >> cada 1s
0910   1CFF           00145   btfss   SYSREADY
0911   2???           00146   call    StartCtrl
0912   187F           00147   btfsc   HSTONLINE
0913   2???           00148   call    CtrlTrafic
0914   2???           00149   call    CheckPulse
                      00150   ; Decremento si es distinto de cero
0915   08B6           00151   movf    DelayResend,f
0916   1D03           00152   btfss   STATUS,Z
0917   03B6           00153   decf    DelayResend,f
                      00154   ; Control para refrescar el display
0918   2???           00155   call    DisplayCtrl
                      00156   ; Control para grabar config
0919   2???           00157   call    SaveEECtrl
                      00158   ; Mantenimiento del reloj local
091A   2???           00159   call    ClockMant
                      00160   ; Control de reset por soft
091B   2???           00161   call    ResetCtrl
                      00162 
                      00163   ; <<
091C   0008           00164   return
                      00165 ; ============================================================================
                      00166 ;  Setea el refresh del display cuando se va por time-out el mensaje que esté
                      00167 ; ============================================================================
091D                  00168 DisplayCtrl
                      00169   ; Decremento si es distinto de cero
091D   08A5           00170   movf    DelayDisplay,f
091E   1D03           00171   btfss   STATUS,Z
091F   0BA5           00172   decfsz  DelayDisplay,f
0920   0008           00173   return
0921   157B           00174   bsf     DISPLAY_DATA
0922   0008           00175   return
                      00176 ; ============================================================================
                      00177 ; Reproducción de códigos infra-rojos
                      00178 ; ============================================================================
0923                  00179 IRCodeInt
0923   108C           00180   bcf     PIR1,TMR2IF   ; Borro el flag de int para que no se redispare
                      00181   ;
0924   1EFE           00182   btfss   SEND_IR
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0925   0008           00183   return
0926   0ACF           00184   incf    IRCount,f
                      00185   ; Controlo el start - 8,5 ms
0927   084F           00186   movf    IRCount,w
0928   3C10           00187   sublw   0x10
0929   1803           00188   btfsc   STATUS,C
092A   2???           00189   goto    IRCodeStart
                      00190   ; Apagado
092B   1205           00191   bcf     IR_OUT
                      00192   ; Pausa de 4 ms
092C   084F           00193   movf    IRCount,w
092D   3C17           00194   sublw   0x17
092E   1803           00195   btfsc   STATUS,C
092F   0008           00196   return
                      00197   ; Se transmite el código en las vueltas pares
0930   184F           00198   btfsc   IRCount,0
0931   0008           00199   return
                      00200   ; Transmisión del código - 40 bits
0932   084F           00201   movf    IRCount,w
0933   3C67           00202   sublw   0x67
0934   1803           00203   btfsc   STATUS,C ; me fijo si pasé los 40
0935   2???           00204   goto    IRCodeSend
0936                  00205 IRCodeStop
0936   12FE           00206   bcf     SEND_IR
0937   01CF           00207   clrf    IRCount
0938   0008           00208   return
                      00209 ; -------------------------------------
0939                  00210 IRCodeStart
0939   1605           00211   bsf     IR_OUT
093A   0008           00212   return
                      00213 ; -------------------------------------
093B                  00214 IRCodeSend ; 24 .. 103
                      00215 ;   inicio
                      00216 ; (0x18) 24, 26, 28, 30, 32, 34,  36,  38
                      00217 ; (0x28) 40, 42, 44, 46, 48, 50,  52,  54
                      00218 ; (0x38) 56, 58, 60, 62, 64, 66,  68,  70
                      00219 ; (0x48) 72, 74, 76, 78, 80, 82,  84,  86
                      00220 ; (0x58) 88, 90, 92, 94, 96, 98, 100, 102
                      00221 ; Si corresponde traigo un byte de código
093B   084F           00222   movf    IRCount,w
093C   3C18           00223   sublw   0x18
093D   1903           00224   btfsc   STATUS,Z
093E   2???           00225   goto    IRCodeLoad1 ; debe cargar el primer byte
093F   084F           00226   movf    IRCount,w
0940   3C28           00227   sublw   0x28
0941   1903           00228   btfsc   STATUS,Z
0942   2???           00229   goto    IRCodeLoad2 ; debe cargar el segundo byte
0943   084F           00230   movf    IRCount,w
0944   3C38           00231   sublw   0x38
0945   1903           00232   btfsc   STATUS,Z
0946   2???           00233   goto    IRCodeLoad3 ; debe cargar el tercer byte
0947   084F           00234   movf    IRCount,w
0948   3C48           00235   sublw   0x48
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0949   1903           00236   btfsc   STATUS,Z
094A   2???           00237   goto    IRCodeLoad4 ; debe cargar el cuarto byte
094B   084F           00238   movf    IRCount,w
094C   3C58           00239   sublw   0x58
094D   1903           00240   btfsc   STATUS,Z
094E   2???           00241   goto    IRCodeLoad5 ; debe cargar el quinto byte
                      00242   ; no tiene que cargar nada, solamente transmitir
094F                  00243 IRCodeSendCont
                      00244  ERRORLEVEL -302
094F   1683           00245   bsf     STATUS,RP0 ; --> BANK1
                      00246   ; muevo el bit mas significativo al carry
0950   0DB7           00247   rlf     IRCodeByte,f
0951   1283           00248   bcf     STATUS,RP0 ; --> BANK0
                      00249  ERRORLEVEL +302
0952   1803           00250   btfsc   STATUS,C
0953   1605           00251   bsf     IR_OUT ; Si era 1 levanto la salida
0954   0008           00252   return
                      00253 ; -------------------------------------
                      00254  ERRORLEVEL -302
0955                  00255 IRCodeLoad1
0955   1683           00256   bsf     STATUS,RP0 ; --> BANK1
0956   0839           00257   movf    IRCode1,w
0957   00B7           00258   movwf   IRCodeByte
0958   2???           00259   goto    IRCodeSendCont
                      00260 ; -------------------------------------
0959                  00261 IRCodeLoad2
0959   1683           00262   bsf     STATUS,RP0 ; --> BANK1
095A   083A           00263   movf    IRCode2,w
095B   00B7           00264   movwf   IRCodeByte
095C   2???           00265   goto    IRCodeSendCont
                      00266 ; -------------------------------------
095D                  00267 IRCodeLoad3 
095D   1683           00268   bsf     STATUS,RP0 ; --> BANK1
095E   083B           00269   movf    IRCode3,w
095F   00B7           00270   movwf   IRCodeByte
0960   2???           00271   goto    IRCodeSendCont
                      00272 ; -------------------------------------
0961                  00273 IRCodeLoad4
0961   1683           00274   bsf     STATUS,RP0 ; --> BANK1
0962   083C           00275   movf    IRCode4,w
0963   00B7           00276   movwf   IRCodeByte
0964   2???           00277   goto    IRCodeSendCont
                      00278 ; -------------------------------------
0965                  00279 IRCodeLoad5
0965   1683           00280   bsf     STATUS,RP0 ; --> BANK1
0966   083D           00281   movf    IRCode5,w
0967   00B7           00282   movwf   IRCodeByte
0968   2???           00283   goto    IRCodeSendCont
                      00284  ERRORLEVEL +302
                      00285 ; ============================================================================
                      00286 ; Interrupción externa (al bajar RB0)
                      00287 ; ============================================================================
0969                  00288 ExternInt
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00289 
                      00290 
0969   0008           00291   return
                      00292 ; ============================================================================
                      00293 ; ControlBeep - Controla el tiempo que suena el Buzzer y lo apaga
                      00294 ; ============================================================================
096A                  00295 ControlBeep
                      00296  ERRORLEVEL -302
096A   1683           00297   bsf     STATUS,RP0 ; --> BANK1
096B   08B0           00298   movf    BeepCount,f
096C   1283           00299   bcf     STATUS,RP0 ; --> BANK0
                      00300  ERRORLEVEL +302
096D   1903           00301   btfsc   STATUS,Z
                      00302   ; si esta en cero me fijo si tiene repeticion
096E   2???           00303   goto    ControlBeep2
                      00304  ERRORLEVEL -302
096F   1683           00305   bsf     STATUS,RP0 ; --> BANK1
0970   03B0           00306   decf    BeepCount,f
0971   1283           00307   bcf     STATUS,RP0 ; --> BANK0
                      00308  ERRORLEVEL +302
0972   1D03           00309   btfss   STATUS,Z
0973   0008           00310   return
                      00311   ; apago el buzzer
0974   1089           00312   bcf     BUZZER
                      00313   ; seteo el silencio entre dos pitidos
0975   300C           00314   movlw   BEEP_DELAY
                      00315  ERRORLEVEL -302
0976   1683           00316   bsf     STATUS,RP0 ; --> BANK1
0977   00AF           00317   movwf   BeepDelay
0978   1283           00318   bcf     STATUS,RP0 ; --> BANK0
                      00319  ERRORLEVEL +302
0979   0008           00320   return
097A                  00321 ControlBeep2
                      00322  ERRORLEVEL -302
097A   1683           00323   bsf     STATUS,RP0 ; --> BANK1
097B   08AE           00324   movf    BeepRetry,f
097C   1283           00325   bcf     STATUS,RP0 ; --> BANK0
                      00326  ERRORLEVEL +302
097D   1903           00327   btfsc   STATUS,Z
097E   0008           00328   return              ; no hay repeticiones
                      00329  ERRORLEVEL -302
097F   1683           00330   bsf     STATUS,RP0 ; --> BANK1
0980   08AF           00331   movf    BeepDelay,f
0981   1283           00332   bcf     STATUS,RP0 ; --> BANK0
                      00333  ERRORLEVEL +302
0982   1903           00334   btfsc   STATUS,Z
0983   0008           00335   return              ; no hay delay, no hay nada
                      00336  ERRORLEVEL -302
0984   1683           00337   bsf     STATUS,RP0 ; --> BANK1
0985   03AF           00338   decf    BeepDelay,f
0986   1283           00339   bcf     STATUS,RP0 ; --> BANK0
                      00340  ERRORLEVEL +302
0987   1D03           00341   btfss   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0988   0008           00342   return              ; hay delay, tengo que esperar
                      00343   ; terminó el delay, ahora va otro beep
                      00344  ERRORLEVEL -302
0989   1683           00345   bsf     STATUS,RP0 ; --> BANK1
098A   03AE           00346   decf    BeepRetry,f ; le resto una repeticion
098B   1283           00347   bcf     STATUS,RP0 ; --> BANK0
                      00348  ERRORLEVEL +302
                      00349   ; arranco otro pitido
098C   1489           00350   bsf     BUZZER
098D   3006           00351   movlw   SHORT_BEEP
                      00352  ERRORLEVEL -302
098E   1683           00353   bsf     STATUS,RP0 ; --> BANK1
098F   00B0           00354   movwf   BeepCount
0990   1283           00355   bcf     STATUS,RP0 ; --> BANK0
                      00356  ERRORLEVEL +302
0991   0008           00357   return
                      00358 ; ============================================================================
                      00359 ; RxTimeOutCtrl
                      00360 ; ============================================================================
0992                  00361 RxTimeOutCtrl
0992   08B1           00362   movf    RxTimeOut,f
0993   1D03           00363   btfss   STATUS,Z
0994   0BB1           00364   decfsz  RxTimeOut,f
0995   0008           00365   return
                      00366   ; en caso de error de recepción tiro todo lo recibido como mensaje
0996   082B           00367   movf    RxPtrAdd,w
0997   00AC           00368   movwf   RxPtrAddTmp
0998   01AF           00369   clrf    RxCharCount
0999   0008           00370   return
                      00371 ; ============================================================================
                      00372 ; CheckBtn - maneja los contadores de filtro de ruido de los botones y cambia
                      00373 ;            los estados BOTONES al llegar a los extremos
                      00374 ;           Trabaja en BANK1
                      00375 ; ============================================================================
                      00376  ERRORLEVEL -302
099A                  00377 CheckBtn
099A   1683           00378   bsf     STATUS,RP0    ; --> BANK1
099B                  00379 Btn0      ; boton 0
099B   1C29           00380   btfss   EXT_BOTONES,0
099C   2???           00381   goto    Btn0Off
099D                  00382 Btn0On
099D   0820           00383   movf    ContBtn0,w    ; me fijo si llegó al maximo
099E   3C32           00384   sublw   BTNFILTER
099F   1903           00385   btfsc   STATUS,Z
09A0   2???           00386   goto    Btn1          ; si, llegó
09A1   0AA0           00387   incf    ContBtn0,f    ; no llegó todavía
09A2   0820           00388   movf    ContBtn0,w    ; me fijo si llegó al maximo nuevamente
09A3   3C32           00389   sublw   BTNFILTER
09A4   1903           00390   btfsc   STATUS,Z
                      00391 
09A5   2???           00392   call    SetBtn0On     ; lo prendo
09A6   2???           00393   goto    Btn1
09A7                  00394 Btn0Off
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09A7   08A0           00395   movf    ContBtn0,f    ; me fijo si llegó a cero
09A8   1903           00396   btfsc   STATUS,Z
09A9   2???           00397   goto    Btn1          ; si, llegó
09AA   0BA0           00398   decfsz  ContBtn0,f
09AB   2???           00399   goto    Btn1          ; sigue sin llegar
09AC   2???           00400   call    SetBtn0Off    ; lo apago
09AD                  00401 Btn1      ; boton 1
09AD   1CA9           00402   btfss   EXT_BOTONES,1
09AE   2???           00403   goto    Btn1Off
09AF                  00404 Btn1On
09AF   0821           00405   movf    ContBtn1,w    ; me fijo si llegó al maximo
09B0   3C32           00406   sublw   BTNFILTER
09B1   1903           00407   btfsc   STATUS,Z
09B2   2???           00408   goto    Btn2          ; si, llegó
09B3   0AA1           00409   incf    ContBtn1,f    ; no llegó todavía
09B4   0821           00410   movf    ContBtn1,w    ; me fijo si llegó al maximo nuevamente
09B5   3C32           00411   sublw   BTNFILTER
09B6   1903           00412   btfsc   STATUS,Z
09B7   2???           00413   call    SetBtn1On     ; lo prendo
09B8   2???           00414   goto    Btn2
09B9                  00415 Btn1Off
09B9   08A1           00416   movf    ContBtn1,f    ; me fijo si llegó a cero
09BA   1903           00417   btfsc   STATUS,Z
09BB   2???           00418   goto    Btn2          ; si, llegó
09BC   0BA1           00419   decfsz  ContBtn1,f
09BD   2???           00420   goto    Btn2          ; sigue sin llegar
09BE   2???           00421   call    SetBtn1Off    ; lo apago
09BF                  00422 Btn2      ; boton 2
09BF   1D29           00423   btfss   EXT_BOTONES,2
09C0   2???           00424   goto    Btn2Off
09C1                  00425 Btn2On
09C1   0822           00426   movf    ContBtn2,w    ; me fijo si llegó al maximo
09C2   3C32           00427   sublw   BTNFILTER
09C3   1903           00428   btfsc   STATUS,Z
09C4   2???           00429   goto    Btn3          ; si, llegó
09C5   0AA2           00430   incf    ContBtn2,f    ; no llegó todavía
09C6   0822           00431   movf    ContBtn2,w    ; me fijo si llegó al maximo nuevamente
09C7   3C32           00432   sublw   BTNFILTER
09C8   1903           00433   btfsc   STATUS,Z
09C9   2???           00434   call    SetBtn2On     ; lo prendo
09CA   2???           00435   goto    Btn3
09CB                  00436 Btn2Off
09CB   08A2           00437   movf    ContBtn2,f    ; me fijo si llegó a cero
09CC   1903           00438   btfsc   STATUS,Z
09CD   2???           00439   goto    Btn3          ; si, llegó
09CE   0BA2           00440   decfsz  ContBtn2,f
09CF   2???           00441   goto    Btn2          ; sigue sin llegar
09D0   2???           00442   call    SetBtn2Off    ; lo apago
09D1                  00443 Btn3      ; boton 3
09D1   1DA9           00444   btfss   EXT_BOTONES,3
09D2   2???           00445   goto    Btn3Off
09D3                  00446 Btn3On
09D3   0823           00447   movf    ContBtn3,w    ; me fijo si llegó al maximo
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

09D4   3C32           00448   sublw   BTNFILTER
09D5   1903           00449   btfsc   STATUS,Z
09D6   2???           00450   goto    Btn4          ; si, llegó
09D7   0AA3           00451   incf    ContBtn3,f    ; no llegó todavía
09D8   0823           00452   movf    ContBtn3,w    ; me fijo si llegó al maximo nuevamente
09D9   3C32           00453   sublw   BTNFILTER
09DA   1903           00454   btfsc   STATUS,Z
09DB   2???           00455   call    SetBtn3On     ; lo prendo
09DC   2???           00456   goto    Btn4
09DD                  00457 Btn3Off
09DD   08A3           00458   movf    ContBtn3,f    ; me fijo si llegó a cero
09DE   1903           00459   btfsc   STATUS,Z
09DF   2???           00460   goto    Btn4          ; si, llegó
09E0   0BA3           00461   decfsz  ContBtn3,f
09E1   2???           00462   goto    Btn4          ; sigue sin llegar
09E2   2???           00463   call    SetBtn3Off    ; lo apago
09E3                  00464 Btn4      ; boton 4
09E3   1E29           00465   btfss   EXT_BOTONES,4
09E4   2???           00466   goto    Btn4Off
09E5                  00467 Btn4On
09E5   0824           00468   movf    ContBtn4,w    ; me fijo si llegó al maximo
09E6   3C32           00469   sublw   BTNFILTER
09E7   1903           00470   btfsc   STATUS,Z
09E8   2???           00471   goto    Btn5          ; si, llegó
09E9   0AA4           00472   incf    ContBtn4,f    ; no llegó todavía
09EA   0824           00473   movf    ContBtn4,w    ; me fijo si llegó al maximo nuevamente
09EB   3C32           00474   sublw   BTNFILTER
09EC   1903           00475   btfsc   STATUS,Z
09ED   2???           00476   call    SetBtn4On     ; lo prendo
09EE   2???           00477   goto    Btn5
09EF                  00478 Btn4Off
09EF   08A4           00479   movf    ContBtn4,f    ; me fijo si llegó a cero
09F0   1903           00480   btfsc   STATUS,Z
09F1   2???           00481   goto    Btn5          ; si, llegó
09F2   0BA4           00482   decfsz  ContBtn4,f
09F3   2???           00483   goto    Btn5          ; sigue sin llegar
09F4   2???           00484   call    SetBtn4Off    ; lo apago
09F5                  00485 Btn5      ; boton 5
09F5   1EA9           00486   btfss   EXT_BOTONES,5
09F6   2???           00487   goto    Btn5Off
09F7                  00488 Btn5On
09F7   0825           00489   movf    ContBtn5,w    ; me fijo si llegó al maximo
09F8   3C32           00490   sublw   BTNFILTER
09F9   1903           00491   btfsc   STATUS,Z
09FA   2???           00492   goto    Btn6          ; si, llegó
09FB   0AA5           00493   incf    ContBtn5,f    ; no llegó todavía
09FC   0825           00494   movf    ContBtn5,w    ; me fijo si llegó al maximo nuevamente
09FD   3C32           00495   sublw   BTNFILTER
09FE   1903           00496   btfsc   STATUS,Z
09FF   2???           00497   call    SetBtn5On     ; lo prendo
0A00   2???           00498   goto    Btn6
0A01                  00499 Btn5Off
0A01   08A5           00500   movf    ContBtn5,f    ; me fijo si llegó a cero
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A02   1903           00501   btfsc   STATUS,Z
0A03   2???           00502   goto    Btn6          ; si, llegó
0A04   0BA5           00503   decfsz  ContBtn5,f
0A05   2???           00504   goto    Btn6          ; sigue sin llegar
0A06   2???           00505   call    SetBtn5Off    ; lo apago
0A07                  00506 Btn6      ; boton 6
0A07   1F29           00507   btfss   EXT_BOTONES,6
0A08   2???           00508   goto    Btn6Off
0A09                  00509 Btn6On
0A09   0826           00510   movf    ContBtn6,w    ; me fijo si llegó al maximo
0A0A   3C32           00511   sublw   BTNFILTER
0A0B   1903           00512   btfsc   STATUS,Z
0A0C   2???           00513   goto    Btn7          ; si, llegó
0A0D   0AA6           00514   incf    ContBtn6,f    ; no llegó todavía
0A0E   0826           00515   movf    ContBtn6,w    ; me fijo si llegó al maximo nuevamente
0A0F   3C32           00516   sublw   BTNFILTER
0A10   1903           00517   btfsc   STATUS,Z
0A11   2???           00518   call    SetBtn6On     ; lo prendo
0A12   2???           00519   goto    Btn7
0A13                  00520 Btn6Off
0A13   08A6           00521   movf    ContBtn6,f    ; me fijo si llegó a cero
0A14   1903           00522   btfsc   STATUS,Z
0A15   2???           00523   goto    Btn7          ; si, llegó
0A16   0BA6           00524   decfsz  ContBtn6,f
0A17   2???           00525   goto    Btn7          ; sigue sin llegar
0A18   2???           00526   call    SetBtn6Off    ; lo apago
0A19                  00527 Btn7      ; boton 7
0A19   1FA9           00528   btfss   EXT_BOTONES,7
0A1A   2???           00529   goto    Btn7Off
0A1B                  00530 Btn7On
0A1B   0827           00531   movf    ContBtn7,w    ; me fijo si llegó al maximo
0A1C   3C32           00532   sublw   BTNFILTER
0A1D   1903           00533   btfsc   STATUS,Z
0A1E   2???           00534   goto    BtnExit       ; si, llegó
0A1F   0AA7           00535   incf    ContBtn7,f    ; no llegó todavía
0A20   0827           00536   movf    ContBtn7,w    ; me fijo si llegó al maximo nuevamente
0A21   3C32           00537   sublw   BTNFILTER
0A22   1903           00538   btfsc   STATUS,Z
0A23   2???           00539   call    SetBtn7On     ; lo prendo
0A24   2???           00540   goto    BtnExit
0A25                  00541 Btn7Off
0A25   08A7           00542   movf    ContBtn7,f    ; me fijo si llegó a cero
0A26   1903           00543   btfsc   STATUS,Z
0A27   2???           00544   goto    BtnExit       ; si, llegó
0A28   0BA7           00545   decfsz  ContBtn7,f
0A29   2???           00546   goto    BtnExit       ; sigue sin llegar
0A2A   2???           00547   call    SetBtn7Off    ; lo apago
0A2B                  00548 BtnExit
0A2B   1283           00549   bcf     STATUS,RP0    ; --> BANK0
0A2C   0008           00550   return
                      00551  ERRORLEVEL +302
                      00552 
                      00553 ; ============================================================================
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00554 ; SetBtn#On/Off - eventos de botones
                      00555 ; ============================================================================
                      00556  ERRORLEVEL -302
0A2D                  00557 SetBtn0On
0A2D   1428           00558   bsf     BOTONES,0
                      00559 
0A2E   0008           00560   return
0A2F                  00561 SetBtn0Off
0A2F   1028           00562   bcf     BOTONES,0
                      00563 
0A30   0008           00564   return
0A31                  00565 SetBtn1On
0A31   14A8           00566   bsf     BOTONES,1
                      00567 
0A32   0008           00568   return
0A33                  00569 SetBtn1Off
0A33   10A8           00570   bcf     BOTONES,1
                      00571 
0A34   0008           00572   return
0A35                  00573 SetBtn2On
0A35   1528           00574   bsf     BOTONES,2
                      00575 
0A36   0008           00576   return
0A37                  00577 SetBtn2Off
0A37   1128           00578   bcf     BOTONES,2
                      00579 
0A38   0008           00580   return
0A39                  00581 SetBtn3On
0A39   15A8           00582   bsf     BOTONES,3
                      00583 
0A3A   0008           00584   return
0A3B                  00585 SetBtn3Off
0A3B   11A8           00586   bcf     BOTONES,3
                      00587 
0A3C   0008           00588   return
0A3D                  00589 SetBtn4On
0A3D   1628           00590   bsf     BOTONES,4
                      00591 
0A3E   0008           00592   return
0A3F                  00593 SetBtn4Off
0A3F   1228           00594   bcf     BOTONES,4
                      00595 
0A40   0008           00596   return
0A41                  00597 SetBtn5On
0A41   16A8           00598   bsf     BOTONES,5
                      00599 
0A42   0008           00600   return
0A43                  00601 SetBtn5Off
0A43   12A8           00602   bcf     BOTONES,5
                      00603 
0A44   0008           00604   return
0A45                  00605 SetBtn6On
0A45   1728           00606   bsf     BOTONES,6
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00607 
0A46   0008           00608   return
0A47                  00609 SetBtn6Off
0A47   1328           00610   bcf     BOTONES,6
                      00611 
0A48   0008           00612   return
0A49                  00613 SetBtn7On
0A49   17A8           00614   bsf     BOTONES,7
                      00615 
0A4A   0008           00616   return
0A4B                  00617 SetBtn7Off
0A4B   13A8           00618   bcf     BOTONES,7
                      00619 
0A4C   0008           00620   return
                      00621  ERRORLEVEL +302
                      00622 ; ============================================================================
                      00623 ; CtrlStartAD
                      00624 ; ============================================================================
0A4D                  00625 CtrlStartAD
0A4D   08C7           00626   movf    ConvertDelay,f
0A4E   1D03           00627   btfss   STATUS,Z
0A4F   0BC7           00628   decfsz  ConvertDelay,f
0A50   0008           00629   return
0A51   149F           00630   bsf     ADCON0,GO
0A52   0008           00631   return
                      00632 ; ============================================================================
                      00633 ; StartCtrl - Controla el tiempo de arranque
                      00634 ; ============================================================================
0A53                  00635 StartCtrl
0A53   0BB5           00636   decfsz    DelayStart,f
0A54   0008           00637   return
0A55   14FF           00638   bsf       SYSREADY
0A56   0008           00639   return
                      00640 ; ============================================================================
                      00641 ;  CtrlTrafic - Funcion de WFT
                      00642 ; ============================================================================
0A57                  00643 CtrlTrafic
                      00644   ; si el contador está en cero no hago nada
0A57   08C8           00645   movf    CntTrafic,f
0A58   1903           00646   btfsc   STATUS,Z
0A59   0008           00647   return
                      00648   ; si al decrementar llega a cero mando el ping
0A5A   0BC8           00649   decfsz  CntTrafic,f
0A5B   0008           00650   return
                      00651   ; Reintento cada 30 Seg
0A5C   301E           00652   movlw   0x1E
0A5D   00B6           00653   movwf   DelayResend
                      00654   ; Inicializo el ensaje
0A5E   ???? ????      00655   PAGESEL ClrTx
0A60   2???           00656   call    ClrTx
0A61   ???? ????      00657   PAGESEL $
                      00658   ; >>>> mensaje de presencia >>>>
0A63   3051           00659   movlw   'Q'        ; start char
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A64   00E0           00660   movwf   txtyp
0A65   3000           00661   movlw   HSTADDR    ; dest addr
0A66   00E1           00662   movwf   txdst
0A67   0871           00663   movf    LocAddr,w  ; local addr
0A68   00E2           00664   movwf   txsrc
0A69   0828           00665   movf    Variant,w  ; contador
0A6A   00E3           00666   movwf   txcnt
0A6B   3050           00667   movlw   'P'        ; comando - 'P' = Aviso de presencia o ping
0A6C   00E4           00668   movwf   txfcn
0A6D   3002           00669   movlw   HARTYPE    ; tipo de dispositivo
0A6E   00E5           00670   movwf   txdat1
0A6F   3001           00671   movlw   HARDVER    ; version de dispositivo
0A70   00E6           00672   movwf   txdat2
0A71   3001           00673   movlw   SOFTVER    ; version de software
0A72   00E7           00674   movwf   txdat3
0A73   3003           00675   movlw   PROCESSOR_VER ; micro procesador
0A74   00E8           00676   movwf   txdat4
0A75   3000           00677   movlw   0             ; presencia de display
0A76   187B           00678   btfsc   DISPLAY_OK
0A77   3050           00679   movlw   0x50 ; display de 80 caracteres
0A78   00E9           00680   movwf   txdat5
                      00681   ; <<<< mensaje de presencia <<<<
                      00682   ; lo encola y termina
0A79   ???? ????      00683   PAGESEL TxEnqueue
0A7B   2???           00684   call    TxEnqueue
0A7C   ???? ????      00685   PAGESEL $
0A7E   0008           00686   return
                      00687 ; ============================================================================
                      00688 ; CheckPulse - decrementa los timers de pulso y resetea el bit al llegar a 0
                      00689 ; ============================================================================
                      00690  ERRORLEVEL -302
0A7F                  00691 CheckPulse
0A7F   1683           00692   bsf     STATUS,RP0    ; --> BANK1
0A80                  00693 pb0s1
0A80   08D0           00694   movf    ContPulseE1B0,f
0A81   1903           00695   btfsc   STATUS,Z
0A82   2???           00696   goto    pb1s1
0A83   0BD0           00697   decfsz  ContPulseE1B0,f
0A84   2???           00698   goto    pb1s1
0A85   1072           00699   bcf     SALIDA1,0
0A86   157E           00700   bsf     CAMBIO_S1
                      00701   ; grabo en EE
0A87   177F           00702   bsf     SAVETOEE
0A88                  00703 pb1s1
0A88   08D1           00704   movf    ContPulseE1B1,f
0A89   1903           00705   btfsc   STATUS,Z
0A8A   2???           00706   goto    pb2s1
0A8B   0BD1           00707   decfsz  ContPulseE1B1,f
0A8C   2???           00708   goto    pb2s1
0A8D   10F2           00709   bcf     SALIDA1,1
0A8E   157E           00710   bsf     CAMBIO_S1
                      00711   ; grabo en EE
0A8F   177F           00712   bsf     SAVETOEE
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0A90                  00713 pb2s1
0A90   08D2           00714   movf    ContPulseE1B2,f
0A91   1903           00715   btfsc   STATUS,Z
0A92   2???           00716   goto    pb3s1
0A93   0BD2           00717   decfsz  ContPulseE1B2,f
0A94   2???           00718   goto    pb3s1
0A95   1172           00719   bcf     SALIDA1,2
0A96   157E           00720   bsf     CAMBIO_S1
                      00721   ; grabo en EE
0A97   177F           00722   bsf     SAVETOEE
0A98                  00723 pb3s1
0A98   08D3           00724   movf    ContPulseE1B3,f
0A99   1903           00725   btfsc   STATUS,Z
0A9A   2???           00726   goto    pb4s1
0A9B   0BD3           00727   decfsz  ContPulseE1B3,f
0A9C   2???           00728   goto    pb4s1
0A9D   11F2           00729   bcf     SALIDA1,3
0A9E   157E           00730   bsf     CAMBIO_S1
                      00731   ; grabo en EE
0A9F   177F           00732   bsf     SAVETOEE
0AA0                  00733 pb4s1
0AA0   08D4           00734   movf    ContPulseE1B4,f
0AA1   1903           00735   btfsc   STATUS,Z
0AA2   2???           00736   goto    pb5s1
0AA3   0BD4           00737   decfsz  ContPulseE1B4,f
0AA4   2???           00738   goto    pb5s1
0AA5   1272           00739   bcf     SALIDA1,4
0AA6   157E           00740   bsf     CAMBIO_S1
                      00741   ; grabo en EE
0AA7   177F           00742   bsf     SAVETOEE
0AA8                  00743 pb5s1
0AA8   08D5           00744   movf    ContPulseE1B5,f
0AA9   1903           00745   btfsc   STATUS,Z
0AAA   2???           00746   goto    pb6s1
0AAB   0BD5           00747   decfsz  ContPulseE1B5,f
0AAC   2???           00748   goto    pb6s1
0AAD   12F2           00749   bcf     SALIDA1,5
0AAE   157E           00750   bsf     CAMBIO_S1
                      00751   ; grabo en EE
0AAF   177F           00752   bsf     SAVETOEE
0AB0                  00753 pb6s1
0AB0   08D6           00754   movf    ContPulseE1B6,f
0AB1   1903           00755   btfsc   STATUS,Z
0AB2   2???           00756   goto    pb7s1
0AB3   0BD6           00757   decfsz  ContPulseE1B6,f
0AB4   2???           00758   goto    pb7s1
0AB5   1372           00759   bcf     SALIDA1,6
0AB6   157E           00760   bsf     CAMBIO_S1
                      00761   ; grabo en EE
0AB7   177F           00762   bsf     SAVETOEE
0AB8                  00763 pb7s1
0AB8   08D7           00764   movf    ContPulseE1B7,f
0AB9   1903           00765   btfsc   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0ABA   2???           00766   goto    pb0s2
0ABB   0BD7           00767   decfsz  ContPulseE1B7,f
0ABC   2???           00768   goto    pb0s2
0ABD   13F2           00769   bcf     SALIDA1,7
0ABE   157E           00770   bsf     CAMBIO_S1
                      00771   ; grabo en EE
0ABF   177F           00772   bsf     SAVETOEE
0AC0                  00773 pb0s2
0AC0   08D8           00774   movf    ContPulseE2B0,f
0AC1   1903           00775   btfsc   STATUS,Z
0AC2   2???           00776   goto    pb1s2
0AC3   0BD8           00777   decfsz  ContPulseE2B0,f
0AC4   2???           00778   goto    pb1s2
0AC5   1073           00779   bcf     SALIDA2,0
0AC6   15FE           00780   bsf     CAMBIO_S2
                      00781   ; grabo en EE
0AC7   177F           00782   bsf     SAVETOEE
0AC8                  00783 pb1s2
0AC8   08D9           00784   movf    ContPulseE2B1,f
0AC9   1903           00785   btfsc   STATUS,Z
0ACA   2???           00786   goto    pb2s2
0ACB   0BD9           00787   decfsz  ContPulseE2B1,f
0ACC   2???           00788   goto    pb2s2
0ACD   10F3           00789   bcf     SALIDA2,1
0ACE   15FE           00790   bsf     CAMBIO_S2
                      00791   ; grabo en EE
0ACF   177F           00792   bsf     SAVETOEE
0AD0                  00793 pb2s2
0AD0   08DA           00794   movf    ContPulseE2B2,f
0AD1   1903           00795   btfsc   STATUS,Z
0AD2   2???           00796   goto    pb3s2
0AD3   0BDA           00797   decfsz  ContPulseE2B2,f
0AD4   2???           00798   goto    pb3s2
0AD5   1173           00799   bcf     SALIDA2,2
0AD6   15FE           00800   bsf     CAMBIO_S2
                      00801   ; grabo en EE
0AD7   177F           00802   bsf     SAVETOEE
0AD8                  00803 pb3s2
0AD8   08DB           00804   movf    ContPulseE2B3,f
0AD9   1903           00805   btfsc   STATUS,Z
0ADA   2???           00806   goto    pb4s2
0ADB   0BDB           00807   decfsz  ContPulseE2B3,f
0ADC   2???           00808   goto    pb4s2
0ADD   11F3           00809   bcf     SALIDA2,3
0ADE   15FE           00810   bsf     CAMBIO_S2
                      00811   ; grabo en EE
0ADF   177F           00812   bsf     SAVETOEE
0AE0                  00813 pb4s2
0AE0   08DC           00814   movf    ContPulseE2B4,f
0AE1   1903           00815   btfsc   STATUS,Z
0AE2   2???           00816   goto    pb5s2
0AE3   0BDC           00817   decfsz  ContPulseE2B4,f
0AE4   2???           00818   goto    pb5s2
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0AE5   1273           00819   bcf     SALIDA2,4
0AE6   15FE           00820   bsf     CAMBIO_S2
                      00821   ; grabo en EE
0AE7   177F           00822   bsf     SAVETOEE
0AE8                  00823 pb5s2
0AE8   08DD           00824   movf    ContPulseE2B5,f
0AE9   1903           00825   btfsc   STATUS,Z
0AEA   2???           00826   goto    pb6s2
0AEB   0BDD           00827   decfsz  ContPulseE2B5,f
0AEC   2???           00828   goto    pb6s2
0AED   12F3           00829   bcf     SALIDA2,5
0AEE   15FE           00830   bsf     CAMBIO_S2
                      00831   ; grabo en EE
0AEF   177F           00832   bsf     SAVETOEE
0AF0                  00833 pb6s2
0AF0   08DE           00834   movf    ContPulseE2B6,f
0AF1   1903           00835   btfsc   STATUS,Z
0AF2   2???           00836   goto    pb7s2
0AF3   0BDE           00837   decfsz  ContPulseE2B6,f
0AF4   2???           00838   goto    pb7s2
0AF5   1373           00839   bcf     SALIDA2,6
0AF6   15FE           00840   bsf     CAMBIO_S2
                      00841   ; grabo en EE
0AF7   177F           00842   bsf     SAVETOEE
0AF8                  00843 pb7s2
0AF8   08DF           00844   movf    ContPulseE2B7,f
0AF9   1903           00845   btfsc   STATUS,Z
0AFA   2???           00846   goto    CheckPulseExit
0AFB   0BDF           00847   decfsz  ContPulseE2B7,f
0AFC   2???           00848   goto    CheckPulseExit
0AFD   13F3           00849   bcf     SALIDA2,7
0AFE   15FE           00850   bsf     CAMBIO_S2
                      00851   ; grabo en EE
0AFF   177F           00852   bsf     SAVETOEE
0B00                  00853 CheckPulseExit
0B00   1283           00854   bcf     STATUS,RP0    ; --> BANK0
0B01   0008           00855   return
                      00856  ERRORLEVEL +302
                      00857 ; ============================================================================
                      00858 ; SaveEECtrl
                      00859 ; ============================================================================
0B02                  00860 SaveEECtrl
                      00861   ; si ya está en cero no hago nada
0B02   08B3           00862   movf    SaveEECount,f
0B03   1903           00863   btfsc   STATUS,Z
0B04   0008           00864   return
0B05   0BB3           00865   decfsz  SaveEECount,f
0B06   0008           00866   return
                      00867   ; hora de grabar
0B07   177F           00868   bsf     SAVETOEE
0B08   0008           00869   return
                      00870 ; ============================================================================
                      00871 ; ClockMant - mantiene el reloj local de la placa (OJO, no hay RTC)
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00872 ; ============================================================================
0B09                  00873 ClockMant
0B09   1DFB           00874   btfss   DATE_OK
0B0A   2???           00875   goto    GetDateTime
                      00876 ; Todas las variables estan en BANK1
                      00877  ERRORLEVEL -302
0B0B   1683           00878   bsf     STATUS,RP0    ; --> BANK1
                      00879   ; SEGUNDOS
0B0C   0AC7           00880   incf    LocSeg,f
0B0D   0847           00881   movf    LocSeg,w
                      00882   ; si llega a 60 sigue el laburito
0B0E   3C3C           00883   sublw   0x3C
0B0F   1D03           00884   btfss   STATUS,Z
0B10   2???           00885   goto    ClockMant_End
                      00886   ; MINUTOS
                      00887   ; para que actualice el display cuando pueda
0B11   167B           00888   bsf     DISPLAY_CLOCK
0B12   01C7           00889   clrf    LocSeg
0B13   0AC6           00890   incf    LocMin,f
0B14   0846           00891   movf    LocMin,w
                      00892   ; si llega a 60 sigue el laburito
0B15   3C3C           00893   sublw   0x3C
0B16   1D03           00894   btfss   STATUS,Z
0B17   2???           00895   goto    ClockMant_End
                      00896   ; HORAS
0B18   01C6           00897   clrf    LocMin
0B19   0AC5           00898   incf    LocHora,f
0B1A   0845           00899   movf    LocHora,w
                      00900   ; si llega a 24 vuelvo a 0
0B1B   3C18           00901   sublw   0x18
0B1C   1903           00902   btfsc   STATUS,Z
0B1D   01C5           00903   clrf    LocHora
0B1E                  00904 ClockMant_End
0B1E   1283           00905   bcf     STATUS,RP0    ; --> BANK0
                      00906  ERRORLEVEL +302
0B1F   0008           00907   return
                      00908 ; ============================================================================
                      00909 ; GetDateTime - Genera un mensaje de petición de actualizacion de fecha
                      00910 ; ============================================================================
0B20                  00911 GetDateTime
0B20   1C7F           00912   btfss     HSTONLINE
0B21   0008           00913   return
                      00914   ; Inicializo el ensaje
0B22   ???? ????      00915   PAGESEL ClrTx
0B24   2???           00916   call    ClrTx
0B25   ???? ????      00917   PAGESEL $
                      00918   ; >>>> mensaje get-datetime >>>>
0B27   3051           00919   movlw   'Q'        ; start char
0B28   00E0           00920   movwf   txtyp
0B29   3000           00921   movlw   HSTADDR    ; dest addr
0B2A   00E1           00922   movwf   txdst
0B2B   0871           00923   movf    LocAddr,w  ; local addr
0B2C   00E2           00924   movwf   txsrc
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0B2D   0828           00925   movf    Variant,w  ; contador
0B2E   00E3           00926   movwf   txcnt
0B2F   3054           00927   movlw   'T'        ; comando - 'T'
0B30   00E4           00928   movwf   txfcn
                      00929   ; <<<< mensaje get-datetime <<<<
                      00930   ; lo encola y termina
0B31   ???? ????      00931   PAGESEL TxEnqueue
0B33   2???           00932   call    TxEnqueue
0B34   ???? ????      00933   PAGESEL $
0B36   0008           00934   return
                      00935 ; ============================================================================
                      00936 ; ADCheck - El resto de las funciones fuera de zona de tablas
                      00937 ; ============================================================================
0B37                  00938 ADEnable
0B37   019F           00939   clrf    ADCON0
                      00940   ; elijo clock RC
0B38   171F           00941   bsf     ADCON0,ADCS0
0B39   179F           00942   bsf     ADCON0,ADCS1
                      00943   ; marco desactualizadas las conversiones
0B3A   1279           00944   bcf     ADC_READY
                      00945   ; enciendo el conversor
0B3B   141F           00946   bsf     ADCON0,ADON
                      00947   ; selecciono la entrada AN0
                      00948   ;bcf     ADCON0,CHS0 ; -
                      00949   ;bcf     ADCON0,CHS1 ;  | No es nesario, recién borró ADCON0
                      00950   ;bcf     ADCON0,CHS2 ; -
                      00951   ; cargo el delay para iniciar la conversión
0B3C   3005           00952   movlw   CONV_DELAY
0B3D   00C7           00953   movwf   ConvertDelay
0B3E   0008           00954   return
                      00955 ; ----------------------------------------------------------------------------
0B3F                  00956 ADChan1
0B3F   081E           00957   movf    ADRESH,w
0B40   00BF           00958   movwf   ANALOG1H
                      00959  ERRORLEVEL -302
0B41   1683           00960   bsf     STATUS,RP0  ; --> BANK1
0B42   081E           00961   movf    ADRESL,w
0B43   1283           00962   bcf     STATUS,RP0  ; --> BANK0
                      00963  ERRORLEVEL +302
0B44   00C0           00964   movwf   ANALOG1L
                      00965   ; selecciono la entrada AN1
0B45   151F           00966   bsf     ADCON0,CHS0
0B46   119F           00967   bcf     ADCON0,CHS1
0B47   121F           00968   bcf     ADCON0,CHS2
                      00969   ; cargo el delay para iniciar la conversión
0B48   3005           00970   movlw   CONV_DELAY
0B49   00C7           00971   movwf   ConvertDelay
0B4A   2???           00972   goto    ADControl
                      00973 ; ----------------------------------------------------------------------------
0B4B                  00974 ADChan2
0B4B   081E           00975   movf    ADRESH,w
0B4C   00C1           00976   movwf   ANALOG2H
                      00977  ERRORLEVEL -302
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0B4D   1683           00978   bsf     STATUS,RP0  ; --> BANK1
0B4E   081E           00979   movf    ADRESL,w
0B4F   1283           00980   bcf     STATUS,RP0  ; --> BANK0
                      00981  ERRORLEVEL +302
0B50   00C2           00982   movwf   ANALOG2L
                      00983   ; selecciono la entrada AN2
0B51   111F           00984   bcf     ADCON0,CHS0
0B52   159F           00985   bsf     ADCON0,CHS1
0B53   121F           00986   bcf     ADCON0,CHS2
                      00987   ; cargo el delay para iniciar la conversión
0B54   3005           00988   movlw   CONV_DELAY
0B55   00C7           00989   movwf   ConvertDelay
0B56   2???           00990   goto    ADControl
                      00991 ; ----------------------------------------------------------------------------
0B57                  00992 ADChan3
0B57   081E           00993   movf    ADRESH,w
0B58   00C3           00994   movwf   ANALOG3H
                      00995  ERRORLEVEL -302
0B59   1683           00996   bsf     STATUS,RP0  ; --> BANK1
0B5A   081E           00997   movf    ADRESL,w
0B5B   1283           00998   bcf     STATUS,RP0  ; --> BANK0
                      00999  ERRORLEVEL +302
0B5C   00C4           01000   movwf   ANALOG3L
                      01001   ; selecciono la entrada AN3
0B5D   151F           01002   bsf     ADCON0,CHS0
0B5E   159F           01003   bsf     ADCON0,CHS1
0B5F   121F           01004   bcf     ADCON0,CHS2
                      01005   ; cargo el delay para iniciar la conversión
0B60   3005           01006   movlw   CONV_DELAY
0B61   00C7           01007   movwf   ConvertDelay
0B62   2???           01008   goto    ADControl
                      01009 ; ----------------------------------------------------------------------------
0B63                  01010 ADChan4
0B63   081E           01011   movf    ADRESH,w
0B64   00C5           01012   movwf   ANALOG4H
                      01013  ERRORLEVEL -302
0B65   1683           01014   bsf     STATUS,RP0  ; --> BANK1
0B66   081E           01015   movf    ADRESL,w
0B67   1283           01016   bcf     STATUS,RP0  ; --> BANK0
                      01017  ERRORLEVEL +302
0B68   00C6           01018   movwf   ANALOG4L
                      01019   ; selecciono la entrada AN0
0B69   111F           01020   bcf     ADCON0,CHS0
0B6A   119F           01021   bcf     ADCON0,CHS1
0B6B   121F           01022   bcf     ADCON0,CHS2
                      01023   ; cargo el delay para iniciar la conversión
0B6C   3005           01024   movlw   CONV_DELAY
0B6D   00C7           01025   movwf   ConvertDelay
                      01026   ; marco actualizadas las conversiones
0B6E   1679           01027   bsf     ADC_READY
0B6F   2???           01028   goto    ADControl
                      01029 ; ----------------------------------------------------------------------------
                      01030  ERRORLEVEL -302
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0B70                  01031 ADControl
                      01032   ; me fijo si todas las entradas fueron escaneadas
0B70   1E79           01033   btfss   ADC_READY
0B71   0008           01034   return  ; no!
                      01035 ; ----------------------------------------------------------------------------
0B72                  01036 ADCtrl1
                      01037   ; si el byte mas significativo del maximo está en FFs el control está desactivado
0B72   1683           01038   bsf     STATUS,RP0  ; --> BANK1
0B73   0860           01039   movf    ANALOG1_MAXH,w
0B74   3904           01040   andlw   0x04
0B75   1D03           01041   btfss   STATUS,Z
0B76   2???           01042   goto    ADCtrl2
                      01043   ; me fijo en qué estado estaba
0B77   1C79           01044   btfss   AN1_UMBRAL
0B78   2???           01045   goto    ADCtrl1_off
0B79                  01046 ADCtrl1_on
                      01047   ; estaba ON, me fijo si ahora tiene que estar OFF
                      01048   ;   comparo primero el byte mas significativo
0B79   0862           01049   movf    ANALOG1_MINH,w
0B7A   1283           01050   bcf     STATUS,RP0  ; --> BANK0
0B7B   023F           01051   subwf   ANALOG1H,w
0B7C   1903           01052   btfsc   STATUS,Z
0B7D   2???           01053   goto    ADCtrl1_on_l      ; ANALOG?H = ANALOG?_MINH
0B7E   1C03           01054   btfss   STATUS,C
0B7F   2???           01055   goto    ADCtrl1_on2off    ; ANALOG?H < ANALOG?_MINH
                      01056   ; ANALOG?H > ANALOG?_MINH --> paso al siguiente
0B80   2???           01057   goto    ADCtrl2
0B81                  01058 ADCtrl1_on_l
                      01059   ; ahora comparo la parte baja del conversor
0B81   1683           01060   bsf     STATUS,RP0  ; --> BANK1
0B82   0863           01061   movf    ANALOG1_MINL,w
0B83   1283           01062   bcf     STATUS,RP0  ; --> BANK0
0B84   0240           01063   subwf   ANALOG1L,w
0B85   1903           01064   btfsc   STATUS,Z
0B86   2???           01065   goto    ADCtrl1_on2off    ; ANALOG?H = ANALOG1_MINL
0B87   1C03           01066   btfss   STATUS,C
0B88   2???           01067   goto    ADCtrl1_on2off    ; ANALOG?H < ANALOG1_MINL
0B89   2???           01068   goto    ADCtrl2
0B8A                  01069 ADCtrl1_off
                      01070   ; estaba OFF, me fijo si ahora tiene que estar ON
                      01071   ;   comparo primero el byte mas significativo
0B8A   1683           01072   bsf     STATUS,RP0  ; --> BANK1
0B8B   0860           01073   movf    ANALOG1_MAXH,w
0B8C   1283           01074   bcf     STATUS,RP0  ; --> BANK0
0B8D   023F           01075   subwf   ANALOG1H,w
0B8E   1903           01076   btfsc   STATUS,Z
0B8F   2???           01077   goto    ADCtrl1_off_l     ; ANALOG?H = ANALOG?_MAXH
0B90   1803           01078   btfsc   STATUS,C
0B91   2???           01079   goto    ADCtrl1_off2on    ; ANALOG?H > ANALOG?_MAXH
                      01080   ; ANALOG?H < ANALOG?_MAXH --> paso al siguiente
0B92   2???           01081   goto    ADCtrl2
0B93                  01082 ADCtrl1_off_l
                      01083   ; ahora comparo el byte menos significatico
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0B93   1683           01084   bsf     STATUS,RP0  ; --> BANK1
0B94   0861           01085   movf    ANALOG1_MAXL,w
0B95   1283           01086   bcf     STATUS,RP0  ; --> BANK0
0B96   0240           01087   subwf   ANALOG1L,w
0B97   1903           01088   btfsc   STATUS,Z
0B98   2???           01089   goto    ADCtrl1_off2on    ; ANALOG?L = ANALOG?_MAXL
0B99   1803           01090   btfsc   STATUS,C
0B9A   2???           01091   goto    ADCtrl1_off2on    ; ANALOG?L > ANALOG?_MAXL
0B9B   2???           01092   goto    ADCtrl2
0B9C                  01093 ADCtrl1_on2off
                      01094   ; implemento un filtro de ruido por delay
0B9C   1683           01095   bsf     STATUS,RP0  ; --> BANK1
0B9D   0BB3           01096   decfsz  ADALRM1DELAY,f
0B9E   2???           01097   goto    ADCtrl2   ; -> todavía no es momento
0B9F   1079           01098   bcf     AN1_UMBRAL
0BA0   167E           01099   bsf     CAMBIO_AN
0BA1   1C44           01100   btfss   MaskNotifAN,0
0BA2   2???           01101   goto    ADCtrl2
0BA3   300A           01102   movlw   REINTENTOS
0BA4   1283           01103   bcf     STATUS,RP0  ; --> BANK0
0BA5   00B9           01104   movwf   CountNotifA1
0BA6   2???           01105   goto    ADCtrl2
0BA7                  01106 ADCtrl1_off2on
                      01107   ; implemento un filtro de ruido por delay
0BA7   1683           01108   bsf     STATUS,RP0  ; --> BANK1
0BA8   0FB3           01109   incfsz  ADALRM1DELAY,f
0BA9   2???           01110   goto    ADCtrl2   ; -> todavía no es momento
0BAA   1479           01111   bsf     AN1_UMBRAL
0BAB   167E           01112   bsf     CAMBIO_AN
0BAC   1C44           01113   btfss   MaskNotifAN,0
0BAD   2???           01114   goto    ADCtrl2
0BAE   300A           01115   movlw   REINTENTOS
0BAF   1283           01116   bcf     STATUS,RP0  ; --> BANK0
0BB0   00B9           01117   movwf   CountNotifA1
                      01118 ; ----------------------------------------------------------------------------
0BB1                  01119 ADCtrl2
                      01120   ; si el byte mas significativo del maximo está en FFs el control está desactivado
0BB1   1683           01121   bsf     STATUS,RP0  ; --> BANK1
0BB2   0864           01122   movf    ANALOG2_MAXH,w
0BB3   3904           01123   andlw   0x04
0BB4   1D03           01124   btfss   STATUS,Z
0BB5   2???           01125   goto    ADCtrl3
                      01126   ; me fijo en qué estado estaba
0BB6   1CF9           01127   btfss   AN2_UMBRAL
0BB7   2???           01128   goto    ADCtrl2_off
0BB8                  01129 ADCtrl2_on
                      01130   ; estaba ON, me fijo si ahora tiene que estar OFF
                      01131   ;   comparo primero el byte mas significativo
0BB8   0866           01132   movf    ANALOG2_MINH,w
0BB9   1283           01133   bcf     STATUS,RP0  ; --> BANK0
0BBA   0241           01134   subwf   ANALOG2H,w
0BBB   1903           01135   btfsc   STATUS,Z
0BBC   2???           01136   goto    ADCtrl2_on_1      ; ANALOG?H = ANALOG?_MINH
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0BBD   1C03           01137   btfss   STATUS,C
0BBE   2???           01138   goto    ADCtrl2_on2off    ; ANALOG?H < ANALOG?_MINH
                      01139   ; ANALOG?H > ANALOG?_MINH --> paso al siguiente
0BBF   2???           01140   goto    ADCtrl3
0BC0                  01141 ADCtrl2_on_1
                      01142   ; ahora comparo la parte baja del conversor
0BC0   1683           01143   bsf     STATUS,RP0  ; --> BANK1
0BC1   0867           01144   movf    ANALOG2_MINL,w
0BC2   1283           01145   bcf     STATUS,RP0  ; --> BANK0
0BC3   0242           01146   subwf   ANALOG2L,w
0BC4   1903           01147   btfsc   STATUS,Z
0BC5   2???           01148   goto    ADCtrl2_on2off    ; ANALOG?H = ANALOG1_MINL
0BC6   1C03           01149   btfss   STATUS,C
0BC7   2???           01150   goto    ADCtrl2_on2off    ; ANALOG?H < ANALOG1_MINL
0BC8   2???           01151   goto    ADCtrl3
0BC9                  01152 ADCtrl2_off
                      01153   ; estaba OFF, me fijo si ahora tiene que estar ON
                      01154   ;   comparo primero el byte mas significativo
0BC9   1683           01155   bsf     STATUS,RP0  ; --> BANK1
0BCA   0864           01156   movf    ANALOG2_MAXH,w
0BCB   1283           01157   bcf     STATUS,RP0  ; --> BANK0
0BCC   0241           01158   subwf   ANALOG2H,w
0BCD   1903           01159   btfsc   STATUS,Z
0BCE   2???           01160   goto    ADCtrl2_off_l     ; ANALOG?H = ANALOG?_MAXH
0BCF   1803           01161   btfsc   STATUS,C
0BD0   2???           01162   goto    ADCtrl2_off2on    ; ANALOG?H > ANALOG?_MAXH
                      01163   ; ANALOG?H < ANALOG?_MAXH --> paso al siguiente
0BD1   2???           01164   goto    ADCtrl3
0BD2                  01165 ADCtrl2_off_l
                      01166   ; ahora comparo el byte menos significatico
0BD2   1683           01167   bsf     STATUS,RP0  ; --> BANK1
0BD3   0865           01168   movf    ANALOG2_MAXL,w
0BD4   1283           01169   bcf     STATUS,RP0  ; --> BANK0
0BD5   0242           01170   subwf   ANALOG2L,w
0BD6   1903           01171   btfsc   STATUS,Z
0BD7   2???           01172   goto    ADCtrl2_off2on    ; ANALOG?L = ANALOG?_MAXL
0BD8   1803           01173   btfsc   STATUS,C
0BD9   2???           01174   goto    ADCtrl2_off2on    ; ANALOG?L > ANALOG?_MAXL
0BDA   2???           01175   goto    ADCtrl3
0BDB                  01176 ADCtrl2_on2off
                      01177   ; implemento un filtro de ruido por delay
0BDB   1683           01178   bsf     STATUS,RP0  ; --> BANK1
0BDC   0BB4           01179   decfsz  ADALRM2DELAY,f
0BDD   2???           01180   goto    ADCtrl3   ; -> todavía no es momento
0BDE   10F9           01181   bcf     AN2_UMBRAL
0BDF   167E           01182   bsf     CAMBIO_AN
0BE0   1CC4           01183   btfss   MaskNotifAN,1
0BE1   2???           01184   goto    ADCtrl3
0BE2   300A           01185   movlw   REINTENTOS
0BE3   1283           01186   bcf     STATUS,RP0  ; --> BANK0
0BE4   00BA           01187   movwf   CountNotifA2
0BE5   2???           01188   goto    ADCtrl3
0BE6                  01189 ADCtrl2_off2on
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01190   ; implemento un filtro de ruido por delay
0BE6   1683           01191   bsf     STATUS,RP0  ; --> BANK1
0BE7   0FB4           01192   incfsz  ADALRM2DELAY,f
0BE8   2???           01193   goto    ADCtrl3   ; -> todavía no es momento
0BE9   14F9           01194   bsf     AN2_UMBRAL
0BEA   167E           01195   bsf     CAMBIO_AN
0BEB   1CC4           01196   btfss   MaskNotifAN,1
0BEC   2???           01197   goto    ADCtrl3
0BED   300A           01198   movlw   REINTENTOS
0BEE   1283           01199   bcf     STATUS,RP0  ; --> BANK0
0BEF   00BA           01200   movwf   CountNotifA2
                      01201 ; ----------------------------------------------------------------------------
0BF0                  01202 ADCtrl3
                      01203   ; si el byte mas significativo del maximo está en FFs el control está desactivado
0BF0   1683           01204   bsf     STATUS,RP0  ; --> BANK1
0BF1   0868           01205   movf    ANALOG3_MAXH,w
0BF2   3904           01206   andlw   0x04
0BF3   1D03           01207   btfss   STATUS,Z
0BF4   2???           01208   goto    ADCtrl4
                      01209   ; me fijo en qué estado estaba
0BF5   1D79           01210   btfss   AN3_UMBRAL
0BF6   2???           01211   goto    ADCtrl3_off
0BF7                  01212 ADCtrl3_on
                      01213   ; estaba ON, me fijo si ahora tiene que estar OFF
                      01214   ;   comparo primero el byte mas significativo
0BF7   086A           01215   movf    ANALOG3_MINH,w
0BF8   1283           01216   bcf     STATUS,RP0  ; --> BANK0
0BF9   0243           01217   subwf   ANALOG3H,w
0BFA   1903           01218   btfsc   STATUS,Z
0BFB   2???           01219   goto    ADCtrl3_on_l      ; ANALOG?H = ANALOG?_MINH
0BFC   1C03           01220   btfss   STATUS,C
0BFD   2???           01221   goto    ADCtrl3_on2off    ; ANALOG?H < ANALOG?_MINH
                      01222   ; ANALOG?H > ANALOG?_MINH --> paso al siguiente
0BFE   2???           01223   goto    ADCtrl4
0BFF                  01224 ADCtrl3_on_l
                      01225   ; ahora comparo la parte baja del conversor
0BFF   1683           01226   bsf     STATUS,RP0  ; --> BANK1
0C00   086B           01227   movf    ANALOG3_MINL,w
0C01   1283           01228   bcf     STATUS,RP0  ; --> BANK0
0C02   0244           01229   subwf   ANALOG3L,w
0C03   1903           01230   btfsc   STATUS,Z
0C04   2???           01231   goto    ADCtrl3_on2off    ; ANALOG?H = ANALOG1_MINL
0C05   1C03           01232   btfss   STATUS,C
0C06   2???           01233   goto    ADCtrl3_on2off    ; ANALOG?H < ANALOG1_MINL
0C07   2???           01234   goto    ADCtrl4
0C08                  01235 ADCtrl3_off
                      01236   ; estaba OFF, me fijo si ahora tiene que estar ON
                      01237   ;   comparo primero el byte mas significativo
0C08   1683           01238   bsf     STATUS,RP0  ; --> BANK1
0C09   0868           01239   movf    ANALOG3_MAXH,w
0C0A   1283           01240   bcf     STATUS,RP0  ; --> BANK0
0C0B   0243           01241   subwf   ANALOG3H,w
0C0C   1903           01242   btfsc   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C0D   2???           01243   goto    ADCtrl3_off_l     ; ANALOG?H = ANALOG?_MAXH
0C0E   1803           01244   btfsc   STATUS,C
0C0F   2???           01245   goto    ADCtrl3_off2on    ; ANALOG?H > ANALOG?_MAXH
                      01246   ; ANALOG?H < ANALOG?_MAXH --> paso al siguiente
0C10   2???           01247   goto    ADCtrl4
0C11                  01248 ADCtrl3_off_l
                      01249   ; ahora comparo el byte menos significatico
0C11   1683           01250   bsf     STATUS,RP0  ; --> BANK1
0C12   0869           01251   movf    ANALOG3_MAXL,w
0C13   1283           01252   bcf     STATUS,RP0  ; --> BANK0
0C14   0244           01253   subwf   ANALOG3L,w
0C15   1903           01254   btfsc   STATUS,Z
0C16   2???           01255   goto    ADCtrl3_off2on    ; ANALOG?L = ANALOG?_MAXL
0C17   1803           01256   btfsc   STATUS,C
0C18   2???           01257   goto    ADCtrl3_off2on    ; ANALOG?L > ANALOG?_MAXL
0C19   2???           01258   goto    ADCtrl4
0C1A                  01259 ADCtrl3_on2off
                      01260   ; implemento un filtro de ruido por delay
0C1A   1683           01261   bsf     STATUS,RP0  ; --> BANK1
0C1B   0BB5           01262   decfsz  ADALRM3DELAY,f
0C1C   2???           01263   goto    ADCtrl4   ; -> todavía no es momento
0C1D   1179           01264   bcf     AN3_UMBRAL
0C1E   167E           01265   bsf     CAMBIO_AN
0C1F   1D44           01266   btfss   MaskNotifAN,2
0C20   2???           01267   goto    ADCtrl4
0C21   300A           01268   movlw   REINTENTOS
0C22   1283           01269   bcf     STATUS,RP0  ; --> BANK0
0C23   00BB           01270   movwf   CountNotifA3
0C24   2???           01271   goto    ADCtrl4
0C25                  01272 ADCtrl3_off2on
                      01273   ; implemento un filtro de ruido por delay
0C25   1683           01274   bsf     STATUS,RP0  ; --> BANK1
0C26   0FB5           01275   incfsz  ADALRM3DELAY,f
0C27   2???           01276   goto    ADCtrl4   ; -> todavía no es momento
0C28   1579           01277   bsf     AN3_UMBRAL
0C29   167E           01278   bsf     CAMBIO_AN
0C2A   1D44           01279   btfss   MaskNotifAN,2
0C2B   2???           01280   goto    ADCtrl4
0C2C   300A           01281   movlw   REINTENTOS
0C2D   1283           01282   bcf     STATUS,RP0  ; --> BANK0
0C2E   00BB           01283   movwf   CountNotifA3
                      01284 ; ----------------------------------------------------------------------------
0C2F                  01285 ADCtrl4
                      01286   ; si el byte mas significativo del maximo está en FFs el control está desactivado
0C2F   1683           01287   bsf     STATUS,RP0  ; --> BANK1
0C30   086C           01288   movf    ANALOG4_MAXH,w
0C31   3904           01289   andlw   0x04
0C32   1D03           01290   btfss   STATUS,Z
0C33   2???           01291   goto    ADCtrlFin
                      01292   ; me fijo en qué estado estaba
0C34   1DF9           01293   btfss   AN4_UMBRAL
0C35   2???           01294   goto    ADCtrl4_off
0C36                  01295 ADCtrl4_on
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01296   ; estaba ON, me fijo si ahora tiene que estar OFF
                      01297   ;   comparo primero el byte mas significativo
0C36   086E           01298   movf    ANALOG4_MINH,w
0C37   1283           01299   bcf     STATUS,RP0  ; --> BANK0
0C38   0245           01300   subwf   ANALOG4H,w
0C39   1903           01301   btfsc   STATUS,Z
0C3A   2???           01302   goto    ADCtrl4_on_l      ; ANALOG?H = ANALOG?_MINH
0C3B   1C03           01303   btfss   STATUS,C
0C3C   2???           01304   goto    ADCtrl4_on2off    ; ANALOG?H < ANALOG?_MINH
                      01305   ; ANALOG?H > ANALOG?_MINH --> paso al siguiente
0C3D   2???           01306   goto    ADCtrlFin
0C3E                  01307 ADCtrl4_on_l
                      01308   ; ahora comparo la parte baja del conversor
0C3E   1683           01309   bsf     STATUS,RP0  ; --> BANK1
0C3F   086F           01310   movf    ANALOG4_MINL,w
0C40   1283           01311   bcf     STATUS,RP0  ; --> BANK0
0C41   0246           01312   subwf   ANALOG4L,w
0C42   1903           01313   btfsc   STATUS,Z
0C43   2???           01314   goto    ADCtrl4_on2off    ; ANALOG?H = ANALOG1_MINL
0C44   1C03           01315   btfss   STATUS,C
0C45   2???           01316   goto    ADCtrl4_on2off    ; ANALOG?H < ANALOG1_MINL
0C46   2???           01317   goto    ADCtrlFin
0C47                  01318 ADCtrl4_off
                      01319   ; estaba OFF, me fijo si ahora tiene que estar ON
                      01320   ;   comparo primero el byte mas significativo
0C47   1683           01321   bsf     STATUS,RP0  ; --> BANK1
0C48   086C           01322   movf    ANALOG4_MAXH,w
0C49   1283           01323   bcf     STATUS,RP0  ; --> BANK0
0C4A   0245           01324   subwf   ANALOG4H,w
0C4B   1903           01325   btfsc   STATUS,Z
0C4C   2???           01326   goto    ADCtrl4_off_l     ; ANALOG?H = ANALOG?_MAXH
0C4D   1803           01327   btfsc   STATUS,C
0C4E   2???           01328   goto    ADCtrl4_off2on    ; ANALOG?H > ANALOG?_MAXH
                      01329   ; ANALOG?H < ANALOG?_MAXH --> me voy
0C4F   2???           01330   goto    ADCtrlFin
0C50                  01331 ADCtrl4_off_l
                      01332   ; ahora comparo el byte menos significatico
0C50   1683           01333   bsf     STATUS,RP0  ; --> BANK1
0C51   086D           01334   movf    ANALOG4_MAXL,w
0C52   1283           01335   bcf     STATUS,RP0  ; --> BANK0
0C53   0246           01336   subwf   ANALOG4L,w
0C54   1903           01337   btfsc   STATUS,Z
0C55   2???           01338   goto    ADCtrl4_off2on    ; ANALOG?L = ANALOG?_MAXL
0C56   1803           01339   btfsc   STATUS,C
0C57   2???           01340   goto    ADCtrl4_off2on    ; ANALOG?L > ANALOG?_MAXL
0C58   2???           01341   goto    ADCtrlFin
0C59                  01342 ADCtrl4_on2off
                      01343   ; implemento un filtro de ruido por delay
0C59   1683           01344   bsf     STATUS,RP0  ; --> BANK1
0C5A   0BB6           01345   decfsz  ADALRM4DELAY,f
0C5B   2???           01346   goto    ADCtrlFin   ; -> todavía no es momento
0C5C   11F9           01347   bcf     AN4_UMBRAL
0C5D   167E           01348   bsf     CAMBIO_AN
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C5E   1DC4           01349   btfss   MaskNotifAN,3
0C5F   2???           01350   goto    ADCtrlFin
0C60   300A           01351   movlw   REINTENTOS
0C61   1283           01352   bcf     STATUS,RP0  ; --> BANK0
0C62   00BC           01353   movwf   CountNotifA4
0C63   2???           01354   goto    ADCtrlFin
0C64                  01355 ADCtrl4_off2on
                      01356   ; implemento un filtro de ruido por delay
0C64   1683           01357   bsf     STATUS,RP0  ; --> BANK1
0C65   0FB6           01358   incfsz  ADALRM4DELAY,f
0C66   2???           01359   goto    ADCtrlFin   ; -> todavía no es momento
0C67   15F9           01360   bsf     AN4_UMBRAL
0C68   167E           01361   bsf     CAMBIO_AN
0C69   1DC4           01362   btfss   MaskNotifAN,3
0C6A   2???           01363   goto    ADCtrlFin
0C6B   300A           01364   movlw   REINTENTOS
0C6C   1283           01365   bcf     STATUS,RP0  ; --> BANK0
0C6D   00BC           01366   movwf   CountNotifA4
0C6E                  01367 ADCtrlFin
0C6E   1283           01368   bcf     STATUS,RP0  ; --> BANK0
0C6F   0008           01369   return
                      01370  ERRORLEVEL +302
                      01371 ; ============================================================================
                      01372 ; ResetCtrl - Controla si hay que resetear el dispositivo
                      01373 ; ============================================================================
0C70                  01374 ResetCtrl
                      01375   ; si ya está en cero no hago nada
0C70   08B4           01376   movf    ResetCount,f
0C71   1903           01377   btfsc   STATUS,Z
0C72   0008           01378   return
                      01379   ; sino decremento, ero no hago nada hasta que llegue solo a cero
0C73   0BB4           01380   decfsz  ResetCount,f
0C74   0008           01381   return
0C75                  01382 ResetLoop
0C75   0000           01383   nop
0C76   2???           01384   goto ResetLoop
                      01385 ; ============================================================================
                      01386 ; Delay_x5us - produce tantos delay de 5 microsegundos como indique W
                      01387 ;            - se usa para el multiple sondeo de las entradas digitales
                      01388 ; ============================================================================
0C77                  01389 Delay_x5us
0C77   00CC           01390   movwf   RegTmpD
0C78                  01391 Delay_x5us_Loop
0C78   0000           01392   nop
0C79   0000           01393   nop
0C7A   0BCC           01394   decfsz  RegTmpD,f
0C7B   2???           01395   goto    Delay_x5us_Loop
0C7C   0008           01396   return
                      01397 ; ============================================================================
                      01398 ; Delay_1ms - produce un delay de un milisegundo
                      01399 ; ============================================================================
0C7D                  01400 Delay_1ms
0C7D   30FA           01401   movlw   0xFA      ; 250
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C7E   00CC           01402   movwf   RegTmpD
0C7F                  01403 Delay_1ms_Loop
0C7F   0000           01404   nop
0C80   0000           01405   nop
0C81   0BCC           01406   decfsz  RegTmpD,f
0C82   2???           01407   goto    Delay_1ms_Loop
0C83   0008           01408   return
                      01409 ; ============================================================================
                      01410 ; Delay_x1ms - produce un delay de tantos milisegundos como indique W
                      01411 ; ============================================================================
0C84                  01412 Delay_x1ms
0C84   00CD           01413   movwf   RegTmpL
0C85                  01414 Delay_x1ms_Loop
0C85   2???           01415   call    Delay_1ms
0C86   0BCD           01416   decfsz  RegTmpL,f
0C87   2???           01417   goto    Delay_x1ms_Loop
0C88   0008           01418   return
                      01419 ; ============================================================================
                      01420 ;  CLOCK_Refresh
                      01421 ;
                      01422 ; _Vie_01_May___15:23_
                      01423 ; ============================================================================
0C89                  01424 CLOCK_Refresh
                      01425   ; controlo que el display este presente
0C89   1C7B           01426   btfss   DISPLAY_OK
0C8A   0008           01427   return
                      01428   ; me fijo si ya hice la inicializacion
0C8B   1CFB           01429   btfss   DISPLAY_INIT
0C8C   0008           01430   return
                      01431   ; me fijo si hay que refrescar el reloj
0C8D   1E7B           01432   btfss   DISPLAY_CLOCK
0C8E   0008           01433   return
                      01434   ;
0C8F   2???           01435   call    LCD_LINE1
0C90   3020           01436   movlw   ' '
0C91   2???           01437   call    LCD_DATOS
                      01438   ; El dia de la semama
                      01439  ERRORLEVEL -302
0C92   1683           01440   bsf     STATUS,RP0    ; --> BANK1
0C93   0848           01441   movf    LocDia,w
0C94   1283           01442   bcf     STATUS,RP0    ; --> BANK0
                      01443  ERRORLEVEL +302
0C95   2???           01444   call    PrintDiaSemana
                      01445   ; un espacio
0C96   3020           01446   movlw   ' '
0C97   2???           01447   call    LCD_DATOS
                      01448   ; La fecha (dos digitos)
                      01449  ERRORLEVEL -302
0C98   1683           01450   bsf     STATUS,RP0    ; --> BANK1
0C99   0849           01451   movf    LocFecha,w
0C9A   1283           01452   bcf     STATUS,RP0    ; --> BANK0
                      01453  ERRORLEVEL +302
                      01454   ; separo en digitos lo que hay en el byte
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0C9B   2???           01455   call    HEX2DEC
                      01456   ; paso las decenas a string
                      01457  ERRORLEVEL -302
0C9C   1683           01458   bsf     STATUS,RP0    ; --> BANK1
0C9D   082C           01459   movf    DEC_M,w
0C9E   1283           01460   bcf     STATUS,RP0    ; --> BANK0
                      01461  ERRORLEVEL +302
0C9F   2???           01462   call    DEC2ASCII
                      01463   ; lo mando al display
0CA0   2???           01464   call    LCD_DATOS
                      01465   ; paso las unidades a string
                      01466  ERRORLEVEL -302
0CA1   1683           01467   bsf     STATUS,RP0    ; --> BANK1
0CA2   082D           01468   movf    DEC_L,w
0CA3   1283           01469   bcf     STATUS,RP0    ; --> BANK0
                      01470  ERRORLEVEL +302
0CA4   2???           01471   call    DEC2ASCII
                      01472   ; lo mando al display
0CA5   2???           01473   call    LCD_DATOS
                      01474   ; un espacio
0CA6   3020           01475   movlw   ' '
0CA7   2???           01476   call    LCD_DATOS
                      01477   ; El mes
                      01478  ERRORLEVEL -302
0CA8   1683           01479   bsf     STATUS,RP0    ; --> BANK1
0CA9   084A           01480   movf    LocMes,w
0CAA   1283           01481   bcf     STATUS,RP0    ; --> BANK0
                      01482  ERRORLEVEL +302
0CAB   2???           01483   call    PrintMes
                      01484   ; tres espacion
0CAC   3020           01485   movlw   ' '
0CAD   2???           01486   call    LCD_DATOS
0CAE   3020           01487   movlw   ' '
0CAF   2???           01488   call    LCD_DATOS
0CB0   3020           01489   movlw   ' '
0CB1   2???           01490   call    LCD_DATOS
                      01491   ; la hora
                      01492  ERRORLEVEL -302
0CB2   1683           01493   bsf     STATUS,RP0    ; --> BANK1
0CB3   0845           01494   movf    LocHora,w
0CB4   1283           01495   bcf     STATUS,RP0    ; --> BANK0
                      01496  ERRORLEVEL +302
                      01497   ; separo en digitos lo que hay en el byte
0CB5   2???           01498   call    HEX2DEC
                      01499   ; paso las decenas a string
                      01500  ERRORLEVEL -302
0CB6   1683           01501   bsf     STATUS,RP0    ; --> BANK1
0CB7   082C           01502   movf    DEC_M,w
0CB8   1283           01503   bcf     STATUS,RP0    ; --> BANK0
                      01504  ERRORLEVEL +302
0CB9   2???           01505   call    DEC2ASCII
                      01506   ; lo mando al display
0CBA   2???           01507   call    LCD_DATOS
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01508   ; paso las unidades a string
                      01509  ERRORLEVEL -302
0CBB   1683           01510   bsf     STATUS,RP0    ; --> BANK1
0CBC   082D           01511   movf    DEC_L,w
0CBD   1283           01512   bcf     STATUS,RP0    ; --> BANK0
                      01513  ERRORLEVEL +302
0CBE   2???           01514   call    DEC2ASCII
                      01515   ; lo mando al display
0CBF   2???           01516   call    LCD_DATOS
                      01517   ; dos puntitos
0CC0   303A           01518   movlw   ':'
0CC1   2???           01519   call    LCD_DATOS
                      01520   ; los minutos
                      01521  ERRORLEVEL -302
0CC2   1683           01522   bsf     STATUS,RP0    ; --> BANK1
0CC3   0846           01523   movf    LocMin,w
0CC4   1283           01524   bcf     STATUS,RP0    ; --> BANK0
                      01525  ERRORLEVEL +302
                      01526   ; separo en digitos lo que hay en el byte
0CC5   2???           01527   call    HEX2DEC
                      01528   ; paso las decenas a string
                      01529  ERRORLEVEL -302
0CC6   1683           01530   bsf     STATUS,RP0    ; --> BANK1
0CC7   082C           01531   movf    DEC_M,w
0CC8   1283           01532   bcf     STATUS,RP0    ; --> BANK0
                      01533  ERRORLEVEL +302
0CC9   2???           01534   call    DEC2ASCII
                      01535   ; lo mando al display
0CCA   2???           01536   call    LCD_DATOS
                      01537   ; paso las unidades a string
                      01538  ERRORLEVEL -302
0CCB   1683           01539   bsf     STATUS,RP0    ; --> BANK1
0CCC   082D           01540   movf    DEC_L,w
0CCD   1283           01541   bcf     STATUS,RP0    ; --> BANK0
                      01542  ERRORLEVEL +302
0CCE   2???           01543   call    DEC2ASCII
                      01544   ; lo mando al display
0CCF   2???           01545   call    LCD_DATOS
0CD0   0008           01546   return
                      01547 ; ============================================================================
                      01548 ; DISPLAY     DISPLAY_EN
                      01549 ;             DISPLAY_RS
                      01550 ;             DISPLAY_RW
                      01551 ;
                      01552 ; ============================================================================
0CD1                  01553 DISPLAY_Refresh
                      01554   ; controlo que el display este presente
0CD1   1C7B           01555   btfss   DISPLAY_OK
0CD2   0008           01556   return
                      01557   ; miro si hay algo para hacer
0CD3   1D7B           01558   btfss   DISPLAY_DATA
0CD4   0008           01559   return
                      01560   ; me fijo si ya hice la inicializacion
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0CD5   1CFB           01561   btfss   DISPLAY_INIT
0CD6   2???           01562   goto    LCD_INI
                      01563   ; me fijo si tengo que esperar
0CD7   08A5           01564   movf    DelayDisplay,f
0CD8   1D03           01565   btfss   STATUS,Z
0CD9   0008           01566   return
                      01567   ; despues sigo con el resto
0CDA   117B           01568   bcf     DISPLAY_DATA
0CDB   087C           01569   movf    ScrnId,w
0CDC   2???           01570   goto    SelectScreen
                      01571 ; ############################################################################
                      01572 ; Funciones LCD
                      01573 ; ############################################################################
0CDD                  01574 LCD_E
0CDD   1486           01575   bsf     DISPLAY_EN      ;Activa señal E
0CDE   0000           01576   nop
0CDF   0000           01577   nop
0CE0   0000           01578   nop                     ;Espera 1uS
0CE1   1086           01579   bcf     DISPLAY_EN      ;Desactiva señal E
0CE2   0008           01580   return
                      01581 ; -----------------------------------------------------------------------------
0CE3                  01582 LCD_BUSY
0CE3   1586           01583   bsf     DISPLAY_RW      ;Pone el LCD en modo lectura
                      01584  ERRORLEVEL -302
0CE4   1683           01585   bsf     STATUS,RP0  ; page1
0CE5   30FF           01586   movlw   0xFF            ;Seteo el port como entrada
0CE6   0088           01587   movwf   TRISBUS
0CE7   1283           01588   bcf     STATUS,RP0  ; page0
                      01589  ERRORLEVEL +302
0CE8   1486           01590   bsf     DISPLAY_EN      ;Activa el LCD (Señal E)
0CE9   30FF           01591   movlw   0xFF            ; cargo un contador para llevar un time-out para el display
0CEA   00A7           01592   movwf   DisplayTO
0CEB                  01593 L_BUSY
0CEB   0064           01594   clrwdt
                      01595   ; Control de presencia del display >-->
0CEC   08A7           01596   movf    DisplayTO,f       ; este contador se decrementa en el timer
0CED   1903           01597   btfsc   STATUS,Z          ; si se va por time-out es porque el display no esta
0CEE   2???           01598   goto    LCD_NO_PRESENT
                      01599   ; Control de presencia del display <--<
0CEF   1B88           01600   btfsc   DATABUS,7       ;Chequea el bit BUSY
0CF0   2???           01601   goto    L_BUSY          ;Est  a "1" (Ocupado)
0CF1   1086           01602   bcf     DISPLAY_EN      ;Desactiva el LCD (Señal E)
                      01603  ERRORLEVEL -302
0CF2   1683           01604   bsf     STATUS,RP0  ; page1
0CF3   3000           01605   movlw   0x00            ;Seteo el port como salida
0CF4   0088           01606   movwf   TRISBUS
0CF5   1283           01607   bcf     STATUS,RP0  ; page0
                      01608  ERRORLEVEL +302
0CF6   1186           01609   bcf     DISPLAY_RW      ;Pone el LCD en modo escritura
0CF7   0008           01610   return
0CF8                  01611 LCD_NO_PRESENT
0CF8   107B           01612   bcf     DISPLAY_OK
0CF9   0008           01613   return
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01614 ; -----------------------------------------------------------------------------
                      01615 ; LCD_REG: Envía una instrucción al display
0CFA                  01616 LCD_REG
0CFA   1106           01617   bcf     DISPLAY_RS      ;Desactiva RS (Modo instruccion)
0CFB   0088           01618   movwf   DATABUS         ;Saca el codigo de instruccion
0CFC   2???           01619   call    LCD_BUSY        ;Espera a que se libere el LCD
0CFD   2???           01620   goto    LCD_E           ;Genera pulso en señal E
                      01621 ; -----------------------------------------------------------------------------
                      01622 ; LCD_DATOS: Envía un dato al display
0CFE                  01623 LCD_DATOS
0CFE   1106           01624   bcf     DISPLAY_RS      ;Desactiva RS (Modo instrucci¢n)
0CFF   0088           01625   movwf   DATABUS         ;Valor ASCII a sacar por PORTB
0D00   2???           01626   call    LCD_BUSY        ;Espera a que se libere el LCD
0D01   1506           01627   bsf     DISPLAY_RS      ;Activa RS (Modo dato)
0D02   2???           01628   goto    LCD_E           ;Genera pulso en señal E
                      01629 ; -----------------------------------------------------------------------------
0D03                  01630 LCD_LINE1
0D03   3080           01631   movlw   b'10000000'
0D04   2???           01632   goto    LCD_REG
0D05                  01633 LCD_LINE1R
0D05   308A           01634   movlw   b'10001010'
0D06   2???           01635   goto    LCD_REG
0D07                  01636 LCD_LINE2
0D07   30C0           01637   movlw   b'11000000'
0D08   2???           01638   goto    LCD_REG
0D09                  01639 LCD_LINE2R
0D09   30CA           01640   movlw   b'11001010'
0D0A   2???           01641   goto    LCD_REG
0D0B                  01642 LCD_LINE3
0D0B   3094           01643   movlw   b'10010100'
0D0C   2???           01644   goto    LCD_REG
0D0D                  01645 LCD_LINE3R
0D0D   309E           01646   movlw   b'10011110'
0D0E   2???           01647   goto    LCD_REG
0D0F                  01648 LCD_LINE4
0D0F   30D4           01649   movlw   b'11010100'
0D10   2???           01650   goto    LCD_REG
0D11                  01651 LCD_LINE4R
0D11   30DE           01652   movlw   b'11011110'
0D12   2???           01653   goto    LCD_REG
                      01654 ; -----------------------------------------------------------------------------
0D13                  01655 LCD_INI
0D13   117B           01656   bcf     DISPLAY_DATA
                      01657   ;
0D14   3038           01658   movlw   b'00111000'
0D15   2???           01659   call    LCD_REG         ;Codigo de instruccion
0D16   ???? ????      01660   PAGESEL Delay_x1ms
0D18   3005           01661   movlw   0x05            ; delay 5 ms
0D19   2???           01662   call    Delay_x1ms      ;
0D1A   ???? ????      01663   PAGESEL $
0D1C   3038           01664   movlw   b'00111000'
0D1D   2???           01665   call    LCD_REG         ;Codigo de instruccion
0D1E   ???? ????      01666   PAGESEL Delay_x1ms
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D20   3005           01667   movlw   0x05            ; delay 5 ms
0D21   2???           01668   call    Delay_x1ms      ;
0D22   ???? ????      01669   PAGESEL $
0D24   3038           01670   movlw   b'00111000'
0D25   2???           01671   call    LCD_REG         ;Codigo de instruccion
0D26   ???? ????      01672   PAGESEL Delay_x1ms
0D28   3005           01673   movlw   0x05            ; delay 5 ms
0D29   2???           01674   call    Delay_x1ms      ;
0D2A   ???? ????      01675   PAGESEL $
                      01676   ; ahora ya funciona el flag BUSY del display
0D2C   3001           01677   movlw   b'00000001'     ;Borrar LCD y Home
0D2D   2???           01678   call    LCD_REG
                      01679   ; aca ya puedo controlar si el display esta
0D2E   1C7B           01680   btfss   DISPLAY_OK
0D2F   0008           01681   return
                      01682   ;
0D30   3006           01683   movlw   b'00000110'     ;
0D31   2???           01684   call    LCD_REG
0D32   300C           01685   movlw   b'00001100'     ;LCD On, cursor Off,Parpadeo Off
0D33   2???           01686   call    LCD_REG
0D34   3080           01687   movlw   0x80            ;Direccion caracter
0D35   2???           01688   call    LCD_REG
                      01689   ; lo marco ya inicializado
0D36   14FB           01690   bsf     DISPLAY_INIT
                      01691   ;
                      01692   ; Leyenda de inicializacion
0D37   2???           01693   call    LCD_LINE1
0D38   3020           01694   movlw   ' '
0D39   2???           01695   call    LCD_DATOS
0D3A   3047           01696   movlw   'G'
0D3B   2???           01697   call    LCD_DATOS
0D3C   306E           01698   movlw   'n'
0D3D   2???           01699   call    LCD_DATOS
0D3E   3075           01700   movlw   'u'
0D3F   2???           01701   call    LCD_DATOS
0D40   302D           01702   movlw   '-'
0D41   2???           01703   call    LCD_DATOS
0D42   304D           01704   movlw   'M'
0D43   2???           01705   call    LCD_DATOS
0D44   3048           01706   movlw   'H'
0D45   2???           01707   call    LCD_DATOS
0D46   306F           01708   movlw   'o'
0D47   2???           01709   call    LCD_DATOS
0D48   306D           01710   movlw   'm'
0D49   2???           01711   call    LCD_DATOS
0D4A   3065           01712   movlw   'e'
0D4B   2???           01713   call    LCD_DATOS
                      01714   ;
0D4C   2???           01715   call    LCD_LINE2
0D4D   3020           01716   movlw   ' '
0D4E   2???           01717   call    LCD_DATOS
0D4F   3020           01718   movlw   ' '
0D50   2???           01719   call    LCD_DATOS
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D51   3020           01720   movlw   ' '
0D52   2???           01721   call    LCD_DATOS
0D53   304D           01722   movlw   'M'
0D54   2???           01723   call    LCD_DATOS
0D55   3049           01724   movlw   'I'
0D56   2???           01725   call    LCD_DATOS
0D57   304F           01726   movlw   'O'
0D58   2???           01727   call    LCD_DATOS
0D59   302D           01728   movlw   '-'
0D5A   2???           01729   call    LCD_DATOS
0D5B   3031           01730   movlw   '1'
0D5C   2???           01731   call    LCD_DATOS
0D5D   3036           01732   movlw   '6'
0D5E   2???           01733   call    LCD_DATOS
0D5F   3078           01734   movlw   'x'
0D60   2???           01735   call    LCD_DATOS
0D61   3031           01736   movlw   '1'
0D62   2???           01737   call    LCD_DATOS
0D63   3036           01738   movlw   '6'
0D64   2???           01739   call    LCD_DATOS
0D65   302F           01740   movlw   '/'
0D66   2???           01741   call    LCD_DATOS
0D67   3041           01742   movlw   'A'
0D68   2???           01743   call    LCD_DATOS
0D69   3044           01744   movlw   'D'
0D6A   2???           01745   call    LCD_DATOS
0D6B   0008           01746   return
                      01747 ; ----------------------------------------------------------------------------
                      01748 ; RxBuffer2LCD - Mueve datos desde el buffer recibido hacia el display
                      01749 ; ----------------------------------------------------------------------------
0D6C                  01750 RxBuffer2LCD
                      01751   ; inhibo el display por 2 minutos para que no se borre lo que puse
0D6C   3078           01752   movlw   0x78
0D6D   00A5           01753   movwf   DelayDisplay
                      01754   ; muevo los caracteres al display
0D6E   0855           01755   movf    rxdat1,w
0D6F   2???           01756   call    LCD_DATOS
0D70   0856           01757   movf    rxdat2,w
0D71   2???           01758   call    LCD_DATOS
0D72   0857           01759   movf    rxdat3,w
0D73   2???           01760   call    LCD_DATOS
0D74   0858           01761   movf    rxdat4,w
0D75   2???           01762   call    LCD_DATOS
0D76   0859           01763   movf    rxdat5,w
0D77   2???           01764   call    LCD_DATOS
0D78   085A           01765   movf    rxdat6,w
0D79   2???           01766   call    LCD_DATOS
0D7A   085B           01767   movf    rxdat7,w
0D7B   2???           01768   call    LCD_DATOS
0D7C   085C           01769   movf    rxdat8,w
0D7D   2???           01770   call    LCD_DATOS
0D7E   085D           01771   movf    rxdat9,w
0D7F   2???           01772   call    LCD_DATOS
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0D80   085E           01773   movf    rxdat10,w
0D81   2???           01774   call    LCD_DATOS
0D82   0008           01775   return
                      01776 ; ============================================================================
                      01777 ; HEX2DEC - Convierte el valor numerico en W a tres valores decimales
                      01778 ; ============================================================================
0D83                  01779 HEX2DEC
                      01780  ERRORLEVEL -302
0D83   1683           01781   bsf     STATUS,RP0 ; --> BANK1
0D84   00AA           01782   movwf   HEXADECIMAL
0D85   01AB           01783   clrf    DEC_H
0D86   01AC           01784   clrf    DEC_M
0D87   01AD           01785   clrf    DEC_L
0D88                  01786 HEX2DEC_H
0D88   3064           01787   movlw   D'100'          ;D'100' --> W
0D89   022A           01788   subwf   HEXADECIMAL,w   ;HEXADECIMAL - D'100' --> W
0D8A   1C03           01789   btfss   STATUS,C        ;HEXADECIMAL es menor que D'100' ?
0D8B   2???           01790   goto    HEX2DEC_M       ;Si
0D8C   00AA           01791   movwf   HEXADECIMAL     ;Salva el resto
0D8D   0AAB           01792   incf    DEC_H,f       ;Incrementa el contador de centenas BCD
0D8E   2???           01793   goto    HEX2DEC_H       ;Vuelve por otros D'100'
                      01794 ;
0D8F                  01795 HEX2DEC_M
0D8F   300A           01796   movlw   D'10'           ;D'10' --> W
0D90   022A           01797   subwf   HEXADECIMAL,w   ;HEXADECIMAL - D'10' --> W
0D91   1C03           01798   btfss   STATUS,C        ;HEXADECIMAL es menor que D'10' ?
0D92   2???           01799   goto    HEX2DEC_L       ;Si
0D93   00AA           01800   movwf   HEXADECIMAL     ;Salva el resto
0D94   0AAC           01801   incf    DEC_M,F       ;Incrementa el contador de decenas BCD
0D95   2???           01802   goto    HEX2DEC_M       ;Vuelve por otros D'10'
0D96                  01803 HEX2DEC_L
0D96   082A           01804   movf    HEXADECIMAL,W   ;El resto pertenece
0D97   00AD           01805   movwf   DEC_L         ;a las unidades BCD
0D98   01AA           01806   clrf    HEXADECIMAL     ;Pone a cero el registro HEXADECIMAL
0D99   1283           01807   bcf     STATUS,RP0 ; --> BANK0
                      01808  ERRORLEVEL +302
0D9A   0008           01809   return
                      01810 ; ============================================================================
                      01811 ; MANEJO DE I/O
                      01812 ; -------------
                      01813 ;
                      01814 ; ENTRADA1    NIN1
                      01815 ; ENTRADA2    NIN2
                      01816 ; SALIDA1     OUT1
                      01817 ; SALIDA2     OUT2
                      01818 ;
                      01819 ; ============================================================================
0D9B                  01820 IO_Refresh
                      01821   ; primero me aseguro que el multiplexado está inhabilitado
0D9B   1606           01822   bsf     NIN1
0D9C   1786           01823   bsf     NIN2
0D9D   1306           01824   bcf     OUT1
0D9E   1286           01825   bcf     OUT2
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01826   ; seteo el BUS como salida
                      01827  ERRORLEVEL -302
0D9F   1683           01828   bsf     STATUS,RP0    ; --> BANK1
0DA0   3000           01829   movlw   0x00   ;tris out
0DA1   0088           01830   movwf   TRISBUS
0DA2   1283           01831   bcf     STATUS,RP0    ; --> BANK2
                      01832  ERRORLEVEL +302
                      01833   ; verifico el flag de cambio de ambas salidas
0DA3   197E           01834   btfsc   CAMBIO_S1
0DA4   2???           01835   call    WriteSal1
0DA5   19FE           01836   btfsc   CAMBIO_S2
0DA6   2???           01837   call    WriteSal2
                      01838  ERRORLEVEL -302
0DA7   1683           01839   bsf     STATUS,RP0    ; --> BANK1
0DA8   30FF           01840   movlw   0xFF   ;tris in
0DA9   0088           01841   movwf   TRISBUS
0DAA   1283           01842   bcf     STATUS,RP0    ; --> BANK0
                      01843  ERRORLEVEL +302
                      01844 ; - Entradas -----------------------------------------------------------------
                      01845 ; verifico la entrada 1
0DAB                  01846 ReadEnt1
0DAB   3005           01847   movlw   SENS_INPUT          ; veces que se lee cada entrada
0DAC   00CE           01848   movwf   ReadIRetry
0DAD   1206           01849   bcf     NIN1                ; habilito la interface de in1
                      01850   ; un pequeño retardo de 15us
0DAE   3003           01851   movlw   0x03
0DAF   2???           01852   call    Delay_x5us
0DB0   0808           01853   movf    DATABUS,w           ; bus->w
0DB1   00CA           01854   movwf   RegTmpG
                      01855 ; ---------------------------
0DB2                  01856 ReadEnt1Loop
0DB2   0064           01857   clrwdt
                      01858   ; un pequeño retardo de 3ms
0DB3   3003           01859   movlw   0x03
0DB4   2???           01860   call    Delay_x1ms
0DB5   0808           01861   movf    DATABUS,w           ; bus->w
0DB6   024A           01862   subwf   RegTmpG,w
0DB7   1D03           01863   btfss   STATUS,Z
0DB8   2???           01864   goto    ReadEnt1Bad          ; si las lecturas dan diferente vuelvo a empesar
0DB9   0BCE           01865   decfsz  ReadIRetry,f        ; voy decrementando la lectura si leí lo mismo
0DBA   2???           01866   goto    ReadEnt1Loop
                      01867 ; con tres lecturas identicas lo doy por bueno
0DBB                  01868 ReadEnt1Ok
                      01869   ; inhabilito la interface de in1
0DBB   1606           01870   bsf     NIN1
                      01871   ; comparo lo del port con lo que tenia de antes
0DBC   084A           01872   movf    RegTmpG,w
0DBD   0674           01873   xorwf   ENTRADA1,w     ; dejo en w 1s donde hay diferencia
0DBE   1903           01874   btfsc   STATUS,Z
0DBF   2???           01875   goto    ReadEnt2       ; si no hay diferencia leo la otra entrada
                      01876   ; si hay diferencia me fijo si pasa la mascara
                      01877  ERRORLEVEL -302
0DC0   1683           01878   bsf     STATUS,RP0    ; --> BANK1
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0DC1   0540           01879   andwf   MaskNotifE1,w
0DC2   1903           01880   btfsc   STATUS,Z
0DC3   2???           01881   goto    ReadEnt1OkFin       ; los cambios no estaban en la mascara de noticicacion
0DC4   1283           01882   bcf     STATUS,RP0    ; --> BANK0
                      01883  ERRORLEVEL +302
                      01884   ; preparo la notificación
0DC5   300A           01885   movlw   REINTENTOS
0DC6   00B7           01886   movwf   CountNotifE1
0DC7                  01887 ReadEnt1OkFin
0DC7   1283           01888   bcf     STATUS,RP0    ; --> BANK0
0DC8   084A           01889   movf    RegTmpG,w
0DC9   00F4           01890   movwf   ENTRADA1
0DCA   147E           01891   bsf     CAMBIO_E1   ; levanto el flag que indica que cambió la entrada
0DCB   2???           01892   goto    ReadEnt2
                      01893 ; ---------------------------
0DCC                  01894 ReadEnt1Bad
                      01895   ; paso los datos del bus al registro temporal
0DCC   0808           01896   movf    DATABUS,w           ; bus->w
0DCD   00CA           01897   movwf   RegTmpG              ; w->f
                      01898   ; veces que se lee cada entrada
0DCE   3005           01899   movlw   SENS_INPUT
0DCF   00CE           01900   movwf   ReadIRetry
0DD0   2???           01901   goto    ReadEnt1Loop
                      01902 ; ---------------------------
                      01903 ; verifico la entrada 2
0DD1                  01904 ReadEnt2
0DD1   3005           01905   movlw   SENS_INPUT          ; veces que se lee cada entrada
0DD2   00CE           01906   movwf   ReadIRetry
0DD3   1606           01907   bsf     NIN1       ; inhabilito la interface de in1
0DD4   1386           01908   bcf     NIN2       ; habilito la interface de in2
                      01909   ; un pequeno retardo de 15us
0DD5   3003           01910   movlw   0x03
0DD6   2???           01911   call    Delay_x5us
0DD7   0808           01912   movf    DATABUS,w           ; bus->w
0DD8   00CA           01913   movwf   RegTmpG
                      01914 ; ---------------------------
0DD9                  01915 ReadEnt2Loop
0DD9   0064           01916   clrwdt
                      01917   ; un pequeño retardo de 3ms
0DDA   3003           01918   movlw   0x03
0DDB   2???           01919   call    Delay_x1ms
0DDC   0808           01920   movf    DATABUS,w           ; bus->w
0DDD   024A           01921   subwf   RegTmpG,w
0DDE   1D03           01922   btfss   STATUS,Z
0DDF   2???           01923   goto    ReadEnt2Bad          ; si las lecturas dan diferente vuelvo a empesar
0DE0   0BCE           01924   decfsz  ReadIRetry,f        ; voy decrementando la lectura si leí lo mismo
0DE1   2???           01925   goto    ReadEnt2Loop
                      01926 ; con tres lecturas identicas lo doy por bueno
0DE2                  01927 ReadEnt2Ok
                      01928   ; inhabilito la interface de in2
0DE2   1786           01929   bsf     NIN2
                      01930   ; comparo lo del port con lo que tenia de antes
0DE3   084A           01931   movf    RegTmpG,w
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0DE4   0675           01932   xorwf   ENTRADA2,w     ; dejo en w 1s donde hay diferencia
0DE5   1903           01933   btfsc   STATUS,Z
0DE6   2???           01934   goto    End_IO_Refresh      ; si no hay diferencia termino con I/O
                      01935 
                      01936   ; si hay diferencia me fijo si pasa la mascara
                      01937  ERRORLEVEL -302
0DE7   1683           01938   bsf     STATUS,RP0    ; --> BANK1
0DE8   0541           01939   andwf   MaskNotifE2,w
0DE9   1903           01940   btfsc   STATUS,Z
0DEA   2???           01941   goto    ReadEnt2OkFin       ; los cambios no estaban en la mascara de noticicacion
0DEB   1283           01942   bcf     STATUS,RP0    ; --> BANK0
                      01943  ERRORLEVEL +302
                      01944   ; preparo la notificación
0DEC   300A           01945   movlw   REINTENTOS
0DED   00B8           01946   movwf   CountNotifE2
0DEE                  01947 ReadEnt2OkFin
0DEE   1283           01948   bcf     STATUS,RP0    ; --> BANK0
0DEF   084A           01949   movf    RegTmpG,w
0DF0   00F5           01950   movwf   ENTRADA2
0DF1   14FE           01951   bsf     CAMBIO_E2   ; levanto el flag que indica que cambió la entrada
0DF2   2???           01952   goto    End_IO_Refresh      ; si no hay diferencia termino con I/O
                      01953 ; ---------------------------
0DF3                  01954 ReadEnt2Bad
                      01955   ; paso los datos del bus al registro temporal
0DF3   0808           01956   movf    DATABUS,w           ; bus->w
0DF4   00CA           01957   movwf   RegTmpG              ; w->f
                      01958   ; veces que se lee cada entrada
0DF5   3005           01959   movlw   SENS_INPUT
0DF6   00CE           01960   movwf   ReadIRetry
0DF7   2???           01961   goto    ReadEnt2Loop
                      01962 ; ----------------------------------------------------------------------------
                      01963 ; - Salidas ------------------------------------------------------------------
                      01964 ; refresco la salida 1 si está levantado el flag que me indica que cambió
0DF8                  01965 WriteSal1
                      01966   ; me fijo si tengo que notificar los cambios
0DF8   0872           01967   movf    SALIDA1,w
                      01968  ERRORLEVEL -302
0DF9   1683           01969   bsf     STATUS,RP0 ; --> BANK1
0DFA   0631           01970   xorwf   BKSALIDA1,w
0DFB   0542           01971   andwf   MaskNotifS1,w
0DFC   1283           01972   bcf     STATUS,RP0 ; --> BANK0
                      01973  ERRORLEVEL +302
0DFD   1903           01974   btfsc   STATUS,Z
0DFE   2???           01975   goto    WriteSal1Cont   ; no tengo que notificar
                      01976   ; cargo los reintentos para notificar cambios en la salida
0DFF   300A           01977   movlw   REINTENTOS
0E00   00BD           01978   movwf   CountNotifS1
0E01                  01979 WriteSal1Cont
0E01   117E           01980   bcf     CAMBIO_S1
0E02   0872           01981   movf    SALIDA1,w     ;cargo dato
                      01982  ERRORLEVEL -302
0E03   1683           01983   bsf     STATUS,RP0 ; --> BANK1
0E04   00B1           01984   movwf   BKSALIDA1     ;dato->backup
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E05   1283           01985   bcf     STATUS,RP0 ; --> BANK0
                      01986  ERRORLEVEL +302
0E06   0088           01987   movwf   DATABUS       ;dato->bus
0E07   0000           01988   nop
0E08   0000           01989   nop
0E09   1706           01990   bsf     OUT1 ; -
0E0A   0000           01991   nop                   ;  |
0E0B   0000           01992   nop                   ;  | un pulso a la interface de I/O
0E0C   0000           01993   nop                   ;  |
0E0D   0000           01994   nop                   ;  |
0E0E   1306           01995   bcf     OUT1 ; -
0E0F   0008           01996   return
                      01997 ; - Salidas ------------------------------------------------------------------
                      01998 ; refresco la salida 2 si está levantado el flag que me indica que cambió
0E10                  01999 WriteSal2
                      02000   ; me fijo si tengo que notificar los cambios
0E10   0873           02001   movf    SALIDA2,w
                      02002  ERRORLEVEL -302
0E11   1683           02003   bsf     STATUS,RP0 ; --> BANK1
0E12   0632           02004   xorwf   BKSALIDA2,w
0E13   0543           02005   andwf   MaskNotifS2,w
0E14   1283           02006   bcf     STATUS,RP0 ; --> BANK0
                      02007  ERRORLEVEL +302
0E15   1903           02008   btfsc   STATUS,Z
0E16   2???           02009   goto    WriteSal2Cont   ; no tengo que notificar
                      02010   ; cargo los reintentos para notificar cambios en la salida
0E17   300A           02011   movlw   REINTENTOS
0E18   00BE           02012   movwf   CountNotifS2
0E19                  02013 WriteSal2Cont
0E19   11FE           02014   bcf     CAMBIO_S2
0E1A   0873           02015   movf    SALIDA2,w     ;cargo dato
                      02016  ERRORLEVEL -302
0E1B   1683           02017   bsf     STATUS,RP0 ; --> BANK1
0E1C   00B2           02018   movwf   BKSALIDA2     ;dato->backup
0E1D   1283           02019   bcf     STATUS,RP0 ; --> BANK0
                      02020  ERRORLEVEL +302
0E1E   0088           02021   movwf   DATABUS       ;dato->bus
0E1F   0000           02022   nop
0E20   0000           02023   nop
0E21   1686           02024   bsf     OUT2 ; -
0E22   0000           02025   nop                   ;  |
0E23   0000           02026   nop                   ;  | un pulso a la interface de I/O
0E24   0000           02027   nop                   ;  |
0E25   0000           02028   nop                   ;  |
0E26   1286           02029   bcf     OUT2 ; -
0E27   0008           02030   return;
                      02031 ; - Final comun de las rutinas de refresh ------------------------------------
0E28                  02032 End_IO_Refresh
0E28   1606           02033   bsf     NIN1
0E29   1786           02034   bsf     NIN2
0E2A   1306           02035   bcf     OUT1
0E2B   1286           02036   bcf     OUT2
0E2C   0000           02037   nop
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E2D   0000           02038   nop
0E2E   0000           02039   nop
0E2F   0000           02040   nop
0E30   0008           02041   return
                      02042 ; ============================================================================
0E31                  02043 PrintLunes
0E31   304C           02044   movlw   'L'
0E32   2???           02045   call    LCD_DATOS
0E33   3075           02046   movlw   'u'
0E34   2???           02047   call    LCD_DATOS
0E35   306E           02048   movlw   'n'
0E36   2???           02049   call    LCD_DATOS
0E37   0008           02050   return
0E38                  02051 PrintMartes
0E38   304D           02052   movlw   'M'
0E39   2???           02053   call    LCD_DATOS
0E3A   3061           02054   movlw   'a'
0E3B   2???           02055   call    LCD_DATOS
0E3C   3072           02056   movlw   'r'
0E3D   2???           02057   call    LCD_DATOS
0E3E   0008           02058   return
0E3F                  02059 PrintMiercoles
0E3F   304D           02060   movlw   'M'
0E40   2???           02061   call    LCD_DATOS
0E41   3069           02062   movlw   'i'
0E42   2???           02063   call    LCD_DATOS
0E43   3065           02064   movlw   'e'
0E44   2???           02065   call    LCD_DATOS
0E45   0008           02066   return
0E46                  02067 PrintJueves
0E46   304A           02068   movlw   'J'
0E47   2???           02069   call    LCD_DATOS
0E48   3075           02070   movlw   'u'
0E49   2???           02071   call    LCD_DATOS
0E4A   3065           02072   movlw   'e'
0E4B   2???           02073   call    LCD_DATOS
0E4C   0008           02074   return
0E4D                  02075 PrintViernes
0E4D   3056           02076   movlw   'V'
0E4E   2???           02077   call    LCD_DATOS
0E4F   3069           02078   movlw   'i'
0E50   2???           02079   call    LCD_DATOS
0E51   3065           02080   movlw   'e'
0E52   2???           02081   call    LCD_DATOS
0E53   0008           02082   return
0E54                  02083 PrintSabado
0E54   3053           02084   movlw   'S'
0E55   2???           02085   call    LCD_DATOS
0E56   3061           02086   movlw   'a'
0E57   2???           02087   call    LCD_DATOS
0E58   3062           02088   movlw   'b'
0E59   2???           02089   call    LCD_DATOS
0E5A   0008           02090   return
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E5B                  02091 PrintDomingo
0E5B   3044           02092   movlw   'D'
0E5C   2???           02093   call    LCD_DATOS
0E5D   306F           02094   movlw   'o'
0E5E   2???           02095   call    LCD_DATOS
0E5F   306D           02096   movlw   'm'
0E60   2???           02097   call    LCD_DATOS
0E61   0008           02098   return
                      02099 ; ============================================================================
0E62                  02100 PrintEnero
0E62   3045           02101   movlw   'E'
0E63   2???           02102   call    LCD_DATOS
0E64   306E           02103   movlw   'n'
0E65   2???           02104   call    LCD_DATOS
0E66   3065           02105   movlw   'e'
0E67   2???           02106   call    LCD_DATOS
0E68   0008           02107   return
0E69                  02108 PrintFebrero
0E69   3046           02109   movlw   'F'
0E6A   2???           02110   call    LCD_DATOS
0E6B   3065           02111   movlw   'e'
0E6C   2???           02112   call    LCD_DATOS
0E6D   3062           02113   movlw   'b'
0E6E   2???           02114   call    LCD_DATOS
0E6F   0008           02115   return
0E70                  02116 PrintMarzo
0E70   304D           02117   movlw   'M'
0E71   2???           02118   call    LCD_DATOS
0E72   3061           02119   movlw   'a'
0E73   2???           02120   call    LCD_DATOS
0E74   3072           02121   movlw   'r'
0E75   2???           02122   call    LCD_DATOS
0E76   0008           02123   return
0E77                  02124 PrintAbril
0E77   3041           02125   movlw   'A'
0E78   2???           02126   call    LCD_DATOS
0E79   3062           02127   movlw   'b'
0E7A   2???           02128   call    LCD_DATOS
0E7B   3072           02129   movlw   'r'
0E7C   2???           02130   call    LCD_DATOS
0E7D   0008           02131   return
0E7E                  02132 PrintMayo
0E7E   304D           02133   movlw   'M'
0E7F   2???           02134   call    LCD_DATOS
0E80   3061           02135   movlw   'a'
0E81   2???           02136   call    LCD_DATOS
0E82   3079           02137   movlw   'y'
0E83   2???           02138   call    LCD_DATOS
0E84   0008           02139   return
0E85                  02140 PrintJunio
0E85   304A           02141   movlw   'J'
0E86   2???           02142   call    LCD_DATOS
0E87   3075           02143   movlw   'u'
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0E88   2???           02144   call    LCD_DATOS
0E89   306E           02145   movlw   'n'
0E8A   2???           02146   call    LCD_DATOS
0E8B   0008           02147   return
0E8C                  02148 PrintJulio
0E8C   304A           02149   movlw   'J'
0E8D   2???           02150   call    LCD_DATOS
0E8E   3075           02151   movlw   'u'
0E8F   2???           02152   call    LCD_DATOS
0E90   306C           02153   movlw   'l'
0E91   2???           02154   call    LCD_DATOS
0E92   0008           02155   return
0E93                  02156 PrintAgosto
0E93   3041           02157   movlw   'A'
0E94   2???           02158   call    LCD_DATOS
0E95   3067           02159   movlw   'g'
0E96   2???           02160   call    LCD_DATOS
0E97   306F           02161   movlw   'o'
0E98   2???           02162   call    LCD_DATOS
0E99   0008           02163   return
0E9A                  02164 PrintSeptiembre
0E9A   3053           02165   movlw   'S'
0E9B   2???           02166   call    LCD_DATOS
0E9C   3065           02167   movlw   'e'
0E9D   2???           02168   call    LCD_DATOS
0E9E   3070           02169   movlw   'p'
0E9F   2???           02170   call    LCD_DATOS
0EA0   0008           02171   return
0EA1                  02172 PrintOctubre
0EA1   304F           02173   movlw   'O'
0EA2   2???           02174   call    LCD_DATOS
0EA3   3063           02175   movlw   'c'
0EA4   2???           02176   call    LCD_DATOS
0EA5   3074           02177   movlw   't'
0EA6   2???           02178   call    LCD_DATOS
0EA7   0008           02179   return
0EA8                  02180 PrintNoviembre
0EA8   304E           02181   movlw   'N'
0EA9   2???           02182   call    LCD_DATOS
0EAA   306F           02183   movlw   'o'
0EAB   2???           02184   call    LCD_DATOS
0EAC   3076           02185   movlw   'v'
0EAD   2???           02186   call    LCD_DATOS
0EAE   0008           02187   return
0EAF                  02188 PrintDiciembre
0EAF   3044           02189   movlw   'D'
0EB0   2???           02190   call    LCD_DATOS
0EB1   3069           02191   movlw   'i'
0EB2   2???           02192   call    LCD_DATOS
0EB3   3063           02193   movlw   'c'
0EB4   2???           02194   call    LCD_DATOS
0EB5   0008           02195   return
                      02196 ; ============================================================================
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0EB6                  02197 Screen0
0EB6   2???           02198   call    LCD_LINE4
0EB7   3020           02199   movlw   ' '
0EB8   2???           02200   call    LCD_DATOS
0EB9   3020           02201   movlw   ' '
0EBA   2???           02202   call    LCD_DATOS
0EBB   3053           02203   movlw   'S'
0EBC   2???           02204   call    LCD_DATOS
0EBD   3049           02205   movlw   'I'
0EBE   2???           02206   call    LCD_DATOS
0EBF   3053           02207   movlw   'S'
0EC0   2???           02208   call    LCD_DATOS
0EC1   3054           02209   movlw   'T'
0EC2   2???           02210   call    LCD_DATOS
0EC3   3045           02211   movlw   'E'
0EC4   2???           02212   call    LCD_DATOS
0EC5   304D           02213   movlw   'M'
0EC6   2???           02214   call    LCD_DATOS
0EC7   3041           02215   movlw   'A'
0EC8   2???           02216   call    LCD_DATOS
0EC9   3020           02217   movlw   ' '
0ECA   2???           02218   call    LCD_DATOS
0ECB   3049           02219   movlw   'I'
0ECC   2???           02220   call    LCD_DATOS
0ECD   304E           02221   movlw   'N'
0ECE   2???           02222   call    LCD_DATOS
0ECF   3049           02223   movlw   'I'
0ED0   2???           02224   call    LCD_DATOS
0ED1   3043           02225   movlw   'C'
0ED2   2???           02226   call    LCD_DATOS
0ED3   3049           02227   movlw   'I'
0ED4   2???           02228   call    LCD_DATOS
0ED5   3041           02229   movlw   'A'
0ED6   2???           02230   call    LCD_DATOS
0ED7   3044           02231   movlw   'D'
0ED8   2???           02232   call    LCD_DATOS
0ED9   304F           02233   movlw   'O'
0EDA   2???           02234   call    LCD_DATOS
0EDB   0008           02235   return
                      02236 ; ============================================================================
                      02237 ; Screen1
                      02238 ;
                      02239 ; ============================================================================
0EDC                  02240 Screen1
0EDC   167B           02241   bsf     DISPLAY_CLOCK
0EDD   2???           02242   call    CLOCK_Refresh
                      02243   ;
                      02244   ; Linea 2
                      02245   ;
0EDE   2???           02246   call    LCD_LINE2
0EDF   3020           02247   movlw   ' '
0EE0   2???           02248   call    LCD_DATOS
0EE1   3020           02249   movlw   ' '
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0EE2   2???           02250   call    LCD_DATOS
0EE3   3020           02251   movlw   ' '
0EE4   2???           02252   call    LCD_DATOS
0EE5   3020           02253   movlw   ' '
0EE6   2???           02254   call    LCD_DATOS
0EE7   3020           02255   movlw   ' '
0EE8   2???           02256   call    LCD_DATOS
0EE9   3020           02257   movlw   ' '
0EEA   2???           02258   call    LCD_DATOS
0EEB   3020           02259   movlw   ' '
0EEC   2???           02260   call    LCD_DATOS
0EED   3020           02261   movlw   ' '
0EEE   2???           02262   call    LCD_DATOS
0EEF   3020           02263   movlw   ' '
0EF0   2???           02264   call    LCD_DATOS
0EF1   3020           02265   movlw   ' '
0EF2   2???           02266   call    LCD_DATOS
0EF3   3020           02267   movlw   ' '
0EF4   2???           02268   call    LCD_DATOS
0EF5   3020           02269   movlw   ' '
0EF6   2???           02270   call    LCD_DATOS
0EF7   3020           02271   movlw   ' '
0EF8   2???           02272   call    LCD_DATOS
0EF9   3020           02273   movlw   ' '
0EFA   2???           02274   call    LCD_DATOS
0EFB   3020           02275   movlw   ' '
0EFC   2???           02276   call    LCD_DATOS
0EFD   3020           02277   movlw   ' '
0EFE   2???           02278   call    LCD_DATOS
0EFF   3020           02279   movlw   ' '
0F00   2???           02280   call    LCD_DATOS
0F01   3020           02281   movlw   ' '
0F02   2???           02282   call    LCD_DATOS
0F03   3020           02283   movlw   ' '
0F04   2???           02284   call    LCD_DATOS
0F05   3020           02285   movlw   ' '
0F06   2???           02286   call    LCD_DATOS
                      02287   ;
                      02288   ; Linea 3
                      02289   ;
                      02290   ; Leyenda de inicializacion
0F07   2???           02291   call    LCD_LINE3
0F08   3020           02292   movlw   ' '
0F09   2???           02293   call    LCD_DATOS
0F0A   3020           02294   movlw   ' '
0F0B   2???           02295   call    LCD_DATOS
0F0C   3020           02296   movlw   ' '
0F0D   2???           02297   call    LCD_DATOS
0F0E   3020           02298   movlw   ' '
0F0F   2???           02299   call    LCD_DATOS
0F10   3020           02300   movlw   ' '
0F11   2???           02301   call    LCD_DATOS
0F12   3047           02302   movlw   'G'
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0F13   2???           02303   call    LCD_DATOS
0F14   306E           02304   movlw   'n'
0F15   2???           02305   call    LCD_DATOS
0F16   3075           02306   movlw   'u'
0F17   2???           02307   call    LCD_DATOS
0F18   302D           02308   movlw   '-'
0F19   2???           02309   call    LCD_DATOS
0F1A   304D           02310   movlw   'M'
0F1B   2???           02311   call    LCD_DATOS
0F1C   3048           02312   movlw   'H'
0F1D   2???           02313   call    LCD_DATOS
0F1E   306F           02314   movlw   'o'
0F1F   2???           02315   call    LCD_DATOS
0F20   306D           02316   movlw   'm'
0F21   2???           02317   call    LCD_DATOS
0F22   3065           02318   movlw   'e'
0F23   2???           02319   call    LCD_DATOS
0F24   3020           02320   movlw   ' '
0F25   2???           02321   call    LCD_DATOS
0F26   3020           02322   movlw   ' '
0F27   2???           02323   call    LCD_DATOS
0F28   3020           02324   movlw   ' '
0F29   2???           02325   call    LCD_DATOS
0F2A   3020           02326   movlw   ' '
0F2B   2???           02327   call    LCD_DATOS
0F2C   3020           02328   movlw   ' '
0F2D   2???           02329   call    LCD_DATOS
0F2E   3020           02330   movlw   ' '
0F2F   2???           02331   call    LCD_DATOS
                      02332   ;
                      02333   ; Linea 4
                      02334   ;
0F30   2???           02335   call    LCD_LINE4
0F31   3020           02336   movlw   ' '
0F32   2???           02337   call    LCD_DATOS
0F33   3020           02338   movlw   ' '
0F34   2???           02339   call    LCD_DATOS
0F35   3020           02340   movlw   ' '
0F36   2???           02341   call    LCD_DATOS
0F37   3020           02342   movlw   ' '
0F38   2???           02343   call    LCD_DATOS
0F39   304D           02344   movlw   'M'
0F3A   2???           02345   call    LCD_DATOS
0F3B   3049           02346   movlw   'I'
0F3C   2???           02347   call    LCD_DATOS
0F3D   304F           02348   movlw   'O'
0F3E   2???           02349   call    LCD_DATOS
0F3F   302D           02350   movlw   '-'
0F40   2???           02351   call    LCD_DATOS
0F41   3031           02352   movlw   '1'
0F42   2???           02353   call    LCD_DATOS
0F43   3036           02354   movlw   '6'
0F44   2???           02355   call    LCD_DATOS
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0F45   3078           02356   movlw   'x'
0F46   2???           02357   call    LCD_DATOS
0F47   3031           02358   movlw   '1'
0F48   2???           02359   call    LCD_DATOS
0F49   3036           02360   movlw   '6'
0F4A   2???           02361   call    LCD_DATOS
0F4B   302F           02362   movlw   '/'
0F4C   2???           02363   call    LCD_DATOS
0F4D   3041           02364   movlw   'A'
0F4E   2???           02365   call    LCD_DATOS
0F4F   3044           02366   movlw   'D'
0F50   2???           02367   call    LCD_DATOS
0F51   3020           02368   movlw   ' '
0F52   2???           02369   call    LCD_DATOS
0F53   3020           02370   movlw   ' '
0F54   2???           02371   call    LCD_DATOS
0F55   3020           02372   movlw   ' '
0F56   2???           02373   call    LCD_DATOS
0F57   3020           02374   movlw   ' '
0F58   2???           02375   call    LCD_DATOS
                      02376 
0F59   0008           02377   return
                      02378 ; ============================================================================
                      02379  ERRORLEVEL +306
                      00082   include "page2.inc"
                      00001 ; gpasm cuando se hace un salto a una posicion que no está en la página 1
                      00002 ;       se queja aunque el destino del salto esté en la misma página que
                      00003 ;       el origen
                      00004  ERRORLEVEL -306
                      00005 ; =.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=
                      00006 ;
                      00007 ;   PAGE 2 - PAGE 2 - PAGE 2 - PAGE 2 - PAGE 2 - PAGE 2 - PAGE 2 - PAGE 2
                      00008 ;
                      00009 ; =.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=.=
                      00010   org 0x1000    ; cambio de página de memoria de programa (1000h-17FFh)
                      00011 ; ============================================================================
                      00012 ; Zona de tablas
                      00013 ; ============================================================================
                      00014 
                      00015 
                      00016 
                      00017 
                      00018 
                      00019 ; ============================================================================
                      00020 ; FIN - Zona de TABLAS
                      00021   org     0x1100
                      00022 ; ============================================================================
1100                  00023 Notificaciones
1100   1C7F           00024   btfss   HSTONLINE
1101   0008           00025   return  ; si el host no está no le hablo
                      00026   ; me fijo si tengo que esperar
1102   08B6           00027   movf    DelayResend,f
1103   1D03           00028   btfss   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1104   0008           00029   return   ; todavía no puedo notificar nada
1105   197F           00030   btfsc   TXBUFFULL
1106   0008           00031   return  ; el buffer está lleno, no se puede hacer nada
                      00032   ;
1107   2???           00033   call    NotificarInput
1108   2???           00034   call    NotificarAnalog
1109   2???           00035   call    NotificarOutput
110A   0008           00036   return
                      00037 ; ============================================================================
                      00038 ; NotificarInput - procesa los cambios de estado de las entradas para
                      00039 ; transmitir
                      00040 ; ============================================================================
110B                  00041 NotificarInput
                      00042   ; inicializo el buffer
110B   ???? ????      00043   PAGESEL ClrTx
110D   2???           00044   call    ClrTx
110E   ???? ????      00045   PAGESEL $
                      00046 ; ----------------------------------------------------------------------------
1110                  00047 NotificarInput1
                      00048   ; me fijo si tengo que notificar esta entrada
1110   08B7           00049   movf    CountNotifE1,f
1111   1903           00050   btfsc   STATUS,Z
1112   2???           00051   goto    NotificarInput2
                      00052   ; decremento el contador de reintentos, si llega a cero --> chau
1113   0BB7           00053   decfsz  CountNotifE1,f
1114   2???           00054   goto    NotificarInput1Cont
1115   107F           00055   bcf     HSTONLINE   ; set off-line
1116   0AA8           00056   incf    Variant,f      ; incremento el contador de mensajes
1117   0008           00057   return
1118                  00058 NotificarInput1Cont
                      00059   ; cargo el nuevo delay que se incrementa a medida que reintento
1118   0837           00060   movf    CountNotifE1,w
1119   3C0C           00061   sublw   REINT_DELAY
111A   00B6           00062   movwf   DelayResend
                      00063   ; armo el mensaje con los datos de la entrada
111B   3031           00064   movlw   '1'
111C   00E5           00065   movwf   txdat1
111D   0874           00066   movf    ENTRADA1,w
111E   00E6           00067   movwf   txdat2
                      00068   ; le agrego la configuracion de la mascara de notificacion
                      00069  ERRORLEVEL -302
111F   1683           00070   bsf     STATUS,RP0    ; --> BANK1
1120   0840           00071   movf    MaskNotifE1,w
1121   1283           00072   bcf     STATUS,RP0    ; --> BANK0
                      00073  ERRORLEVEL +302
1122   00E7           00074   movwf   txdat3
                      00075   ; le agrego la configuracion de seguidores
1123   0876           00076   movf    Mascara_E1S1,w
1124   00E8           00077   movwf   txdat4
1125   2???           00078   goto    NotificarInputFin
                      00079 ; ----------------------------------------------------------------------------
1126                  00080 NotificarInput2
                      00081   ; me fijo si tengo que notificar esta entrada
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1126   08B8           00082   movf    CountNotifE2,f
1127   1903           00083   btfsc   STATUS,Z
1128   0008           00084   return
                      00085   ; decremento el contador de reintentos, si llega a cero --> chau
1129   0BB8           00086   decfsz  CountNotifE2,f
112A   2???           00087   goto    NotificarInput2Cont
112B   107F           00088   bcf     HSTONLINE   ; set off-line
112C   0AA8           00089   incf    Variant,f      ; incremento el contador de mensajes
112D   0008           00090   return
112E                  00091 NotificarInput2Cont
                      00092   ; cargo el nuevo delay que se incrementa a medida que reintento
112E   0838           00093   movf    CountNotifE2,w
112F   3C0C           00094   sublw   REINT_DELAY
1130   00B6           00095   movwf   DelayResend
                      00096   ; armo el mensaje con los datos de la entrada
1131   3032           00097   movlw   '2'
1132   00E5           00098   movwf   txdat1
1133   0875           00099   movf    ENTRADA2,w
1134   00E6           00100   movwf   txdat2
                      00101   ; le agrego la configuracion de la mascara de notificacion
                      00102  ERRORLEVEL -302
1135   1683           00103   bsf     STATUS,RP0    ; --> BANK1
1136   0841           00104   movf    MaskNotifE2,w
1137   1283           00105   bcf     STATUS,RP0    ; --> BANK0
                      00106  ERRORLEVEL +302
1138   00E7           00107   movwf   txdat3
                      00108   ; le agrego la configuracion de seguidores
1139   0877           00109   movf    Mascara_E2S2,w
113A   00E8           00110   movwf   txdat4
                      00111 ; ----------------------------------------------------------------------------
113B                  00112 NotificarInputFin
                      00113   ; >>>> mensaje de notificacion >>>>
113B   3051           00114   movlw   'Q'        ; start char
113C   00E0           00115   movwf   txtyp
113D   3000           00116   movlw   HSTADDR    ; dest addr
113E   00E1           00117   movwf   txdst
113F   0871           00118   movf    LocAddr,w  ; local addr
1140   00E2           00119   movwf   txsrc
1141   0828           00120   movf    Variant,w  ; contador
1142   00E3           00121   movwf   txcnt
1143   3036           00122   movlw   '6'        ; comando - '6'
1144   00E4           00123   movwf   txfcn
                      00124   ; <<<< mensaje de notificacion <<<<
                      00125   ; lo encola y termina
1145   ???? ????      00126   PAGESEL TxEnqueue
1147   2???           00127   call    TxEnqueue
1148   ???? ????      00128   PAGESEL $
114A   0008           00129   return
                      00130 ; ============================================================================
                      00131 ; NotificarAnalog - procesa los cambios de estado de las entradas analogicas
                      00132 ; para transmitir
                      00133 ; ============================================================================
114B                  00134 NotificarAnalog
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00135   ; limpio para armar el mensaje
114B   ???? ????      00136   PAGESEL ClrTx
114D   2???           00137   call    ClrTx
114E   ???? ????      00138   PAGESEL $
1150   1383           00139   bcf     STATUS,IRP ; pasa a banco 0/1 para direccionamiento indirecto
                      00140 ; ----------------------------------------------------------------------------
1151                  00141 NotificarAnalog1
                      00142   ; me fijo si tengo que notificar esta entrada
1151   08B9           00143   movf    CountNotifA1,f
1152   1903           00144   btfsc   STATUS,Z
1153   2???           00145   goto    NotificarAnalog2
                      00146   ; decremento el contador de reintentos, si llega a cero --> chau
1154   0BB9           00147   decfsz  CountNotifA1,f
1155   2???           00148   goto    NotificarAnalog1Cont
1156   107F           00149   bcf     HSTONLINE   ; set off-line
1157   0AA8           00150   incf    Variant,f      ; incremento el contador de mensajes
1158   0008           00151   return
1159                  00152 NotificarAnalog1Cont
                      00153   ; cargo el nuevo delay que se incrementa a medida que reintento
1159   0839           00154   movf    CountNotifA1,w
115A   3C0C           00155   sublw   REINT_DELAY
115B   00B6           00156   movwf   DelayResend
                      00157   ; armo el mensaje
115C   3031           00158   movlw   '1'
115D   00E5           00159   movwf   txdat1
115E   1C79           00160   btfss   AN1_UMBRAL
115F   3030           00161   movlw   '0'
1160   1879           00162   btfsc   AN1_UMBRAL
1161   3031           00163   movlw   '1'
1162   00E6           00164   movwf   txdat2
1163   083F           00165   movf    ANALOG1H,w
1164   00E7           00166   movwf   txdat3
1165   0840           00167   movf    ANALOG1L,w
1166   00E8           00168   movwf   txdat4
                      00169   ; cargo los valores de la alarma analogica
1167   30E0           00170   movlw   ANALOG1_MAXH
1168   0084           00171   movwf   FSR
1169   0800           00172   movf    INDF,w      ; ANALOG1_MAXH
116A   00E9           00173   movwf   txdat5
116B   0A84           00174   incf    FSR,f
116C   0800           00175   movf    INDF,w      ; ANALOG1_MAXL
116D   00EA           00176   movwf   txdat6
116E   0A84           00177   incf    FSR,f
116F   0800           00178   movf    INDF,w      ; ANALOG1_MINH
1170   00EB           00179   movwf   txdat7
1171   0A84           00180   incf    FSR,f
1172   0800           00181   movf    INDF,w      ; ANALOG1_MINL
1173   00EC           00182   movwf   txdat8
1174   2???           00183   goto    NotificarAnalogFin
                      00184 ; ----------------------------------------------------------------------------
1175                  00185 NotificarAnalog2
                      00186   ; me fijo si tengo que notificar esta entrada
1175   08BA           00187   movf    CountNotifA2,f
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

1176   1903           00188   btfsc   STATUS,Z
1177   2???           00189   goto    NotificarAnalog3
                      00190   ; decremento el contador de reintentos, si llega a cero --> chau
1178   0BBA           00191   decfsz  CountNotifA2,f
1179   2???           00192   goto    NotificarAnalog2Cont
117A   107F           00193   bcf     HSTONLINE   ; set off-line
117B   0AA8           00194   incf    Variant,f      ; incremento el contador de mensajes
117C   0008           00195   return
117D                  00196 NotificarAnalog2Cont
                      00197   ; cargo el nuevo delay que se incrementa a medida que reintento
117D   083A           00198   movf    CountNotifA2,w
117E   3C0C           00199   sublw   REINT_DELAY
117F   00B6           00200   movwf   DelayResend
                      00201   ; armo el mensaje
1180   3032           00202   movlw   '2'
1181   00E5           00203   movwf   txdat1
1182   1CF9           00204   btfss   AN2_UMBRAL
1183   3030           00205   movlw   '0'
1184   18F9           00206   btfsc   AN2_UMBRAL
1185   3031           00207   movlw   '1'
1186   00E6           00208   movwf   txdat2
1187   0841           00209   movf    ANALOG2H,w
1188   00E7           00210   movwf   txdat3
1189   0842           00211   movf    ANALOG2L,w
118A   00E8           00212   movwf   txdat4
                      00213   ; cargo los valores de la alarma analogica
118B   30E4           00214   movlw   ANALOG2_MAXH
118C   0084           00215   movwf   FSR
118D   0800           00216   movf    INDF,w      ; ANALOG1_MAXH
118E   00E9           00217   movwf   txdat5
118F   0A84           00218   incf    FSR,f
1190   0800           00219   movf    INDF,w      ; ANALOG1_MAXL
1191   00EA           00220   movwf   txdat6
1192   0A84           00221   incf    FSR,f
1193   0800           00222   movf    INDF,w      ; ANALOG1_MINH
1194   00EB           00223   movwf   txdat7
1195   0A84           00224   incf    FSR,f
1196   0800           00225   movf    INDF,w      ; ANALOG1_MINL
1197   00EC           00226   movwf   txdat8
1198   2???           00227   goto    NotificarAnalogFin
                      00228 ; ----------------------------------------------------------------------------
1199                  00229 NotificarAnalog3
                      00230   ; me fijo si tengo que notificar esta entrada
1199   08BB           00231   movf    CountNotifA3,f
119A   1903           00232   btfsc   STATUS,Z
119B   2???           00233   goto    NotificarAnalog4
                      00234   ; decremento el contador de reintentos, si llega a cero --> chau
119C   0BBB           00235   decfsz  CountNotifA3,f
119D   2???           00236   goto    NotificarAnalog3Cont
119E   107F           00237   bcf     HSTONLINE   ; set off-line
119F   0AA8           00238   incf    Variant,f      ; incremento el contador de mensajes
11A0   0008           00239   return
11A1                  00240 NotificarAnalog3Cont
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00241   ; cargo el nuevo delay que se incrementa a medida que reintento
11A1   083B           00242   movf    CountNotifA3,w
11A2   3C0C           00243   sublw   REINT_DELAY
11A3   00B6           00244   movwf   DelayResend
                      00245   ; armo el mensaje
11A4   3033           00246   movlw   '3'
11A5   00E5           00247   movwf   txdat1
11A6   1D79           00248   btfss   AN3_UMBRAL
11A7   3030           00249   movlw   '0'
11A8   1979           00250   btfsc   AN3_UMBRAL
11A9   3031           00251   movlw   '1'
11AA   00E6           00252   movwf   txdat2
11AB   0843           00253   movf    ANALOG3H,w
11AC   00E7           00254   movwf   txdat3
11AD   0844           00255   movf    ANALOG3L,w
11AE   00E8           00256   movwf   txdat4
                      00257   ; cargo los valores de la alarma analogica
11AF   30E8           00258   movlw   ANALOG3_MAXH
11B0   0084           00259   movwf   FSR
11B1   0800           00260   movf    INDF,w      ; ANALOG1_MAXH
11B2   00E9           00261   movwf   txdat5
11B3   0A84           00262   incf    FSR,f
11B4   0800           00263   movf    INDF,w      ; ANALOG1_MAXL
11B5   00EA           00264   movwf   txdat6
11B6   0A84           00265   incf    FSR,f
11B7   0800           00266   movf    INDF,w      ; ANALOG1_MINH
11B8   00EB           00267   movwf   txdat7
11B9   0A84           00268   incf    FSR,f
11BA   0800           00269   movf    INDF,w      ; ANALOG1_MINL
11BB   00EC           00270   movwf   txdat8
11BC   2???           00271   goto    NotificarAnalogFin
                      00272 ; ----------------------------------------------------------------------------
11BD                  00273 NotificarAnalog4
                      00274   ; me fijo si tengo que notificar esta entrada
11BD   08BC           00275   movf    CountNotifA4,f
11BE   1903           00276   btfsc   STATUS,Z
11BF   0008           00277   return
                      00278   ; decremento el contador de reintentos, si llega a cero --> chau
11C0   0BBC           00279   decfsz  CountNotifA4,f
11C1   2???           00280   goto    NotificarAnalog4Cont
11C2   107F           00281   bcf     HSTONLINE   ; set off-line
11C3   0AA8           00282   incf    Variant,f      ; incremento el contador de mensajes
11C4   0008           00283   return
11C5                  00284 NotificarAnalog4Cont
                      00285   ; cargo el nuevo delay que se incrementa a medida que reintento
11C5   083C           00286   movf    CountNotifA4,w
11C6   3C0C           00287   sublw   REINT_DELAY
11C7   00B6           00288   movwf   DelayResend
                      00289   ; armo el mensaje
11C8   3034           00290   movlw   '4'
11C9   00E5           00291   movwf   txdat1
11CA   1DF9           00292   btfss   AN4_UMBRAL
11CB   3030           00293   movlw   '0'
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

11CC   19F9           00294   btfsc   AN4_UMBRAL
11CD   3031           00295   movlw   '1'
11CE   00E6           00296   movwf   txdat2
11CF   0845           00297   movf    ANALOG4H,w
11D0   00E7           00298   movwf   txdat3
11D1   0846           00299   movf    ANALOG4L,w
11D2   00E8           00300   movwf   txdat4
                      00301   ; cargo los valores de la alarma analogica
11D3   30EC           00302   movlw   ANALOG4_MAXH
11D4   0084           00303   movwf   FSR
11D5   0800           00304   movf    INDF,w      ; ANALOG1_MAXH
11D6   00E9           00305   movwf   txdat5
11D7   0A84           00306   incf    FSR,f
11D8   0800           00307   movf    INDF,w      ; ANALOG1_MAXL
11D9   00EA           00308   movwf   txdat6
11DA   0A84           00309   incf    FSR,f
11DB   0800           00310   movf    INDF,w      ; ANALOG1_MINH
11DC   00EB           00311   movwf   txdat7
11DD   0A84           00312   incf    FSR,f
11DE   0800           00313   movf    INDF,w      ; ANALOG1_MINL
11DF   00EC           00314   movwf   txdat8
11E0   2???           00315   goto    NotificarAnalogFin
                      00316 ; ----------------------------------------------------------------------------
11E1                  00317 NotificarAnalogFin
                      00318   ; >>>> mensaje de notificacion >>>>
11E1   3051           00319   movlw   'Q'        ; start char
11E2   00E0           00320   movwf   txtyp
11E3   3000           00321   movlw   HSTADDR    ; dest addr
11E4   00E1           00322   movwf   txdst
11E5   0871           00323   movf    LocAddr,w  ; local addr
11E6   00E2           00324   movwf   txsrc
11E7   0828           00325   movf    Variant,w  ; contador
11E8   00E3           00326   movwf   txcnt
11E9   3039           00327   movlw   '9'        ; comando - '9'
11EA   00E4           00328   movwf   txfcn
                      00329   ; le agrego la configuracion de la mascara de notificacion
                      00330  ERRORLEVEL -302
11EB   1683           00331   bsf     STATUS,RP0    ; --> BANK1
11EC   0844           00332   movf    MaskNotifAN,w
11ED   1283           00333   bcf     STATUS,RP0    ; --> BANK0
                      00334  ERRORLEVEL +302
11EE   00ED           00335   movwf   txdat9
                      00336   ; le agrego la configuracion de seguidores
11EF   0878           00337   movf    Mascara_ANS2,w
11F0   00EE           00338   movwf   txdat10
                      00339   ; <<<< mensaje de notificacion <<<<
                      00340   ; lo encola y termina
11F1   ???? ????      00341   PAGESEL TxEnqueue
11F3   2???           00342   call    TxEnqueue
11F4   ???? ????      00343   PAGESEL $
11F6   0008           00344   return
                      00345 ; ============================================================================
                      00346 ; NotificarOutput - procesa los cambios de estado de las salidas para
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00347 ; transmitir
                      00348 ; ============================================================================
11F7                  00349 NotificarOutput
                      00350   ; inicializo el buffer
11F7   ???? ????      00351   PAGESEL ClrTx
11F9   2???           00352   call    ClrTx
11FA   ???? ????      00353   PAGESEL $
                      00354 ; ----------------------------------------------------------------------------
11FC                  00355 NotificarOutput1
                      00356   ; me fijo si tengo que notificar esta salida
11FC   08BD           00357   movf    CountNotifS1,f
11FD   1903           00358   btfsc   STATUS,Z
11FE   2???           00359   goto    NotificarOutput2
                      00360   ; decremento el contador de reintentos, si llega a cero --> chau
11FF   0BBD           00361   decfsz  CountNotifS1,f
1200   2???           00362   goto    NotificarOutput1Cont
1201   107F           00363   bcf     HSTONLINE   ; set off-line
1202   0AA8           00364   incf    Variant,f      ; incremento el contador de mensajes
1203   0008           00365   return
1204                  00366 NotificarOutput1Cont
                      00367   ; cargo el nuevo delay que se incrementa a medida que reintento
1204   083D           00368   movf    CountNotifS1,w
1205   3C0C           00369   sublw   REINT_DELAY
1206   00B6           00370   movwf   DelayResend
                      00371   ; armo el mensaje con los datos de la salida
1207   3031           00372   movlw   '1'
1208   00E5           00373   movwf   txdat1
1209   0872           00374   movf    SALIDA1,w
120A   00E6           00375   movwf   txdat2
                      00376   ; le agrego la configuracion de la mascara de notificacion
                      00377  ERRORLEVEL -302
120B   1683           00378   bsf     STATUS,RP0    ; --> BANK1
120C   0842           00379   movf    MaskNotifS1,w
120D   1283           00380   bcf     STATUS,RP0    ; --> BANK0
                      00381  ERRORLEVEL +302
120E   00E7           00382   movwf   txdat3
                      00383   ; le agrego la configuracion de seguidores
120F   0876           00384   movf    Mascara_E1S1,w
1210   00E8           00385   movwf   txdat4
                      00386   ; le agrego la configuracion de seguidores
1211   3000           00387   movlw   0
1212   00E9           00388   movwf   txdat5
1213   2???           00389   goto    NotificarOutputFin
                      00390 ; ----------------------------------------------------------------------------
1214                  00391 NotificarOutput2
                      00392   ; me fijo si tengo que notificar esta salida
1214   08BE           00393   movf    CountNotifS2,f
1215   1903           00394   btfsc   STATUS,Z
1216   0008           00395   return
                      00396   ; decremento el contador de reintentos, si llega a cero --> chau
1217   0BBE           00397   decfsz  CountNotifS2,f
1218   2???           00398   goto    NotificarOutput2Cont
1219   107F           00399   bcf     HSTONLINE   ; set off-line
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

121A   0AA8           00400   incf    Variant,f      ; incremento el contador de mensajes
121B   0008           00401   return
121C                  00402 NotificarOutput2Cont
                      00403   ; cargo el nuevo delay que se incrementa a medida que reintento
121C   083E           00404   movf    CountNotifS2,w
121D   3C0C           00405   sublw   REINT_DELAY
121E   00B6           00406   movwf   DelayResend
                      00407   ; armo el mensaje con los datos de la salida
121F   3032           00408   movlw   '2'
1220   00E5           00409   movwf   txdat1
1221   0873           00410   movf    SALIDA2,w
1222   00E6           00411   movwf   txdat2
                      00412   ; le agrego la configuracion de la mascara de notificacion
                      00413  ERRORLEVEL -302
1223   1683           00414   bsf     STATUS,RP0    ; --> BANK1
1224   0843           00415   movf    MaskNotifS2,w
1225   1283           00416   bcf     STATUS,RP0    ; --> BANK0
                      00417  ERRORLEVEL +302
1226   00E7           00418   movwf   txdat3
                      00419   ; le agrego la configuracion de seguidores
1227   0877           00420   movf    Mascara_E2S2,w
1228   00E8           00421   movwf   txdat4
                      00422   ; le agrego la configuracion de seguidores
1229   0878           00423   movf    Mascara_ANS2,w
122A   00E9           00424   movwf   txdat5
                      00425 ; ----------------------------------------------------------------------------
122B                  00426 NotificarOutputFin
                      00427   ; >>>> mensaje de notificacion >>>>
122B   3051           00428   movlw   'Q'        ; start char
122C   00E0           00429   movwf   txtyp
122D   3000           00430   movlw   HSTADDR    ; dest addr
122E   00E1           00431   movwf   txdst
122F   0871           00432   movf    LocAddr,w  ; local addr
1230   00E2           00433   movwf   txsrc
1231   0828           00434   movf    Variant,w  ; contador
1232   00E3           00435   movwf   txcnt
1233   3037           00436   movlw   '7'        ; comando - '6'
1234   00E4           00437   movwf   txfcn
                      00438   ; <<<< mensaje de notificacion <<<<
                      00439   ; lo encola y termina
1235   ???? ????      00440   PAGESEL TxEnqueue
1237   2???           00441   call    TxEnqueue
1238   ???? ????      00442   PAGESEL $
123A   0008           00443   return
                      00444 ; ============================================================================
                      00445  ERRORLEVEL +306
                      00083 ; ============================================================================
                      00084 ; Inicio de corrida
                      00085 ; ============================================================================
                      00086   org 0x00              ; reset vector
0000   2???           00087   goto    Init
                      00088 ; ============================================================================
                      00089 ; Tratamiento del vector de INTERRUPCION
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00090 ; ============================================================================
                      00091   org 0x04              ; interrupt vector
0004   138B           00092   bcf       INTCON,GIE    ;inhabilito las interrupciones
                      00093 ; >>>> Save context >>>>
0005   00F0           00094   movwf     w_saved       ;w --> w_saved register
0006   0E03           00095   swapf     STATUS,w      ;Swap status to be saved into W
0007   0183           00096   clrf      STATUS        ;bank 0, regardless of current bank,Clears IRP,RP1,RP0
0008   00A0           00097   movwf     status_saved  ;Save status to bank zero status_saved register
0009   0804           00098   movf      FSR,w         ;Guardo el registro de direccionamiento indirecto
000A   00A2           00099   movwf     fsr_saved     ;Save FSR into fsr_saved
000B   080A           00100   movf      PCLATH,w      ;Only required if using pages 1, 2 and/or 3
000C   00A1           00101   movwf     pclath_saved  ;Save PCLATH into pclath_saved
000D   018A           00102   clrf      PCLATH        ;Page zero, regardless of current page
                      00103 ; <<<< Save context <<<<
                      00104 
                      00105 ; >> interrupt code >>
                      00106 
                      00107  ERRORLEVEL -306
                      00108   ; << Interrupcion de timer0 en Pagina 1
000E   ???? ????      00109   PAGESEL TimerInt
0010   190B           00110   btfsc   INTCON,T0IF    ;interrupcion por timer0
0011   2???           00111   call    TimerInt
0012   ???? ????      00112   PAGESEL $
                      00113   ; << Interrupcion de timer2 en Pagina 1
0014   ???? ????      00114   PAGESEL IRCodeInt
0016   188C           00115   btfsc   PIR1,TMR2IF    ;interrupcion por timer2
0017   2???           00116   call    IRCodeInt
0018   ???? ????      00117   PAGESEL $
                      00118   ; << Interrupcion externa en Pagina 1
001A   ???? ????      00119   PAGESEL ExternInt
001C   188B           00120   btfsc   INTCON,INTF   ;interrupcion externa RB0
001D   2???           00121   call    ExternInt
001E   ???? ????      00122   PAGESEL $
                      00123  ERRORLEVEL +306
                      00124 
0020   1A8C           00125   btfsc   PIR1,RCIF     ; Interrupcion de Rx Serial
0021   2???           00126   call    RxInt
                      00127   ;
                      00128   ; dejo esta para lo ultimo, si está habilitada la int entro a ver
                      00129  ERRORLEVEL -302
0022   1683           00130   bsf     STATUS,RP0 ; --> BANK1
0023   1A0C           00131   btfsc   PIE1,TXIE
0024   2???           00132   call    TxInt
0025   1283           00133   bcf     STATUS,RP0 ; --> BANK0
                      00134  ERRORLEVEL +302
                      00135 ; << interrupt code <<
                      00136 
                      00137 ; >>>> Restore context >>>>
0026   0183           00138   clrf  STATUS              ;bank 0, regardless of current bank,Clears IRP,RP1,RP0
0027   0821           00139   movf  pclath_saved,w      ;Restore PCLATH
0028   008A           00140   movwf PCLATH              ;w --> PCLATH
0029   0822           00141   movf  fsr_saved,w         ;Restore FSR
002A   0084           00142   movwf FSR                 ;w --> FSR
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002B   0E20           00143   swapf status_saved,w      ;Swap status_saved register into W
                      00144                             ;(sets bank to original state)
002C   0083           00145   movwf STATUS              ;w --> STATUS register
002D   0EF0           00146   swapf w_saved,f           ;Swap w_saved
002E   0E70           00147   swapf w_saved,w           ;Swap w_saved into W
                      00148 ; <<<< Restore context <<<<
                      00149 
002F   178B           00150   bsf    INTCON,GIE      ;habilito las interrupciones
0030   0009           00151   retfie
                      00152 ; ============================================================================
                      00153 ; Zona de TABLAS
                      00154 ; ============================================================================
                      00155 
                      00156 ; ============================================================================
                      00157 ; FcnQ3SetB
                      00158 ; ============================================================================
0031                  00159 FcnQ3SetB
0031   084A           00160   movf    RegTmpG,w
                      00161   ; el salto es de a 4 y en cada paso en el offset 0 está la instrucción de
                      00162   ; apagado, en el 2 la de encendido y en la 1 y 3 la de return
0032   0782           00163   addwf   PCL,f
                      00164   ;------------- >>
0033   1000           00165   bcf     INDF,0 ;  << 0 - apagar
0034   0008           00166   return
0035   1400           00167   bsf     INDF,0 ;  << 0 - encender
0036   0008           00168   return
                      00169   ;-------------
0037   1080           00170   bcf     INDF,1 ;  << 1 - apagar
0038   0008           00171   return
0039   1480           00172   bsf     INDF,1 ;  << 1 - encender
003A   0008           00173   return
                      00174   ;-------------
003B   1100           00175   bcf     INDF,2 ;  << 2 - apagar
003C   0008           00176   return
003D   1500           00177   bsf     INDF,2 ;  << 2 - encender
003E   0008           00178   return
                      00179   ;-------------
003F   1180           00180   bcf     INDF,3 ;  << 3 - apagar
0040   0008           00181   return
0041   1580           00182   bsf     INDF,3 ;  << 3 - encender
0042   0008           00183   return
                      00184   ;-------------
0043   1200           00185   bcf     INDF,4 ;  << 4 - apagar
0044   0008           00186   return
0045   1600           00187   bsf     INDF,4 ;  << 4 - encender
0046   0008           00188   return
                      00189   ;-------------
0047   1280           00190   bcf     INDF,5 ;  << 5 - apagar
0048   0008           00191   return
0049   1680           00192   bsf     INDF,5 ;  << 5 - encender
004A   0008           00193   return
                      00194   ;-------------
004B   1300           00195   bcf     INDF,6 ;  << 6 - apagar
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 64


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

004C   0008           00196   return
004D   1700           00197   bsf     INDF,6 ;  << 6 - encender
004E   0008           00198   return
                      00199   ;-------------
004F   1380           00200   bcf     INDF,7 ;  << 7 - apagar
0050   0008           00201   return
0051   1780           00202   bsf     INDF,7 ;  << 7 - encender
0052   0008           00203   return
                      00204 ; ============================================================================
                      00205 ; GetPulseCountS1 - Devuelve la dirección del contador para el bit en w
                      00206 ; ============================================================================
0053                  00207 GetPulseCountS1
0053   0782           00208   addwf   PCL,f
0054   34D0           00209   retlw   ContPulseE1B0
0055   34D1           00210   retlw   ContPulseE1B1
0056   34D2           00211   retlw   ContPulseE1B2
0057   34D3           00212   retlw   ContPulseE1B3
0058   34D4           00213   retlw   ContPulseE1B4
0059   34D5           00214   retlw   ContPulseE1B5
005A   34D6           00215   retlw   ContPulseE1B6
005B   34D7           00216   retlw   ContPulseE1B7
                      00217 ; ============================================================================
                      00218 ; GetPulseCountS2 - Devuelve la dirección del contador para el bit en w
                      00219 ; ============================================================================
005C                  00220 GetPulseCountS2
005C   0782           00221   addwf   PCL,f
005D   34D8           00222   retlw   ContPulseE2B0
005E   34D9           00223   retlw   ContPulseE2B1
005F   34DA           00224   retlw   ContPulseE2B2
0060   34DB           00225   retlw   ContPulseE2B3
0061   34DC           00226   retlw   ContPulseE2B4
0062   34DD           00227   retlw   ContPulseE2B5
0063   34DE           00228   retlw   ContPulseE2B6
0064   34DF           00229   retlw   ContPulseE2B7
                      00230 ; ============================================================================
                      00231 ; SetWBitW - Deja prendido en W solo el bit indicado en W
                      00232 ; ============================================================================
0065                  00233 SetWBitW
0065   0782           00234   addwf   PCL,f
0066   3401           00235   retlw   0x01
0067   3402           00236   retlw   0x02
0068   3404           00237   retlw   0x04
0069   3408           00238   retlw   0x08
006A   3410           00239   retlw   0x10
006B   3420           00240   retlw   0x20
006C   3440           00241   retlw   0x40
006D   3480           00242   retlw   0x80
                      00243 ; ============================================================================
                      00244 ; FIN - Zona de TABLAS
                      00245   org     0x0100
                      00246   include "txrx.inc"
                      00001 ; ############################################################################
                      00002 ; ZONA TX
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 65


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00003 ; ############################################################################
                      00004 ; ============================================================================
                      00005 ; ClrTx - limpia el area donde se arma el mensaje a enviar
                      00006 ; ============================================================================
0100                  00007 ClrTx
                      00008   ; blanqueo los datos
0100   3020           00009   movlw   ' '
0101   00E0           00010   movwf   txtyp
0102   00E1           00011   movwf   txdst
0103   00E3           00012   movwf   txcnt
0104   00E4           00013   movwf   txfcn
0105   00E5           00014   movwf   txdat1
0106   00E6           00015   movwf   txdat2
0107   00E7           00016   movwf   txdat3
0108   00E8           00017   movwf   txdat4
0109   00E9           00018   movwf   txdat5
010A   00EA           00019   movwf   txdat6
010B   00EB           00020   movwf   txdat7
010C   00EC           00021   movwf   txdat8
010D   00ED           00022   movwf   txdat9
010E   00EE           00023   movwf   txdat10
                      00024   ; inicializo el origen
010F   0871           00025   movf    LocAddr,w
0110   00E2           00026   movwf   txsrc
0111   0008           00027   return
                      00028 ; ============================================================================
                      00029 ; TxEnqueue - se llama para cargar el registro armado para transmitir en la
                      00030 ;             cola de salida
                      00031 ; ============================================================================
0112                  00032 TxEnqueue
0112   197F           00033   btfsc   TXBUFFULL
0113   0008           00034   return  ; el buffer está lleno, no se puede hacer nada
0114   1783           00035   bsf     STATUS,IRP ; pasa a banco 2/3 para direccionamiento indirecto
0115   0829           00036   movf    TxPtrAdd,w ; cargo la dirección donde escribir en el buffer
0116   0084           00037   movwf   FSR
0117   01EF           00038   clrf    txchksum  ; inicializo el checksum
                      00039   ; voy moviendo los datos y calculando el checksum mientras tanto
0118   0860           00040   movf    txtyp,w
0119   0080           00041   movwf   INDF
011A   07EF           00042   addwf   txchksum,f
011B   0A84           00043   incf    FSR,f
011C   2???           00044   call    TxEnqueueCtrlVuelta
011D   0861           00045   movf    txdst,w 
011E   0080           00046   movwf   INDF
011F   07EF           00047   addwf   txchksum,f
0120   0A84           00048   incf    FSR,f
0121   2???           00049   call    TxEnqueueCtrlVuelta
0122   0862           00050   movf    txsrc,w
0123   0080           00051   movwf   INDF
0124   07EF           00052   addwf   txchksum,f
0125   0A84           00053   incf    FSR,f
0126   2???           00054   call    TxEnqueueCtrlVuelta
0127   0863           00055   movf    txcnt,w
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 66


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0128   0080           00056   movwf   INDF
0129   07EF           00057   addwf   txchksum,f
012A   0A84           00058   incf    FSR,f
012B   2???           00059   call    TxEnqueueCtrlVuelta
012C   0864           00060   movf    txfcn,w
012D   0080           00061   movwf   INDF
012E   07EF           00062   addwf   txchksum,f
012F   0A84           00063   incf    FSR,f
0130   2???           00064   call    TxEnqueueCtrlVuelta
0131   0865           00065   movf    txdat1,w
0132   0080           00066   movwf   INDF
0133   07EF           00067   addwf   txchksum,f
0134   0A84           00068   incf    FSR,f
0135   2???           00069   call    TxEnqueueCtrlVuelta
0136   0866           00070   movf    txdat2,w
0137   0080           00071   movwf   INDF
0138   07EF           00072   addwf   txchksum,f
0139   0A84           00073   incf    FSR,f
013A   2???           00074   call    TxEnqueueCtrlVuelta
013B   0867           00075   movf    txdat3,w
013C   0080           00076   movwf   INDF
013D   07EF           00077   addwf   txchksum,f
013E   0A84           00078   incf    FSR,f
013F   2???           00079   call    TxEnqueueCtrlVuelta
0140   0868           00080   movf    txdat4,w
0141   0080           00081   movwf   INDF
0142   07EF           00082   addwf   txchksum,f
0143   0A84           00083   incf    FSR,f
0144   2???           00084   call    TxEnqueueCtrlVuelta
0145   0869           00085   movf    txdat5,w
0146   0080           00086   movwf   INDF
0147   07EF           00087   addwf   txchksum,f
0148   0A84           00088   incf    FSR,f
0149   2???           00089   call    TxEnqueueCtrlVuelta
014A   086A           00090   movf    txdat6,w
014B   0080           00091   movwf   INDF
014C   07EF           00092   addwf   txchksum,f
014D   0A84           00093   incf    FSR,f
014E   2???           00094   call    TxEnqueueCtrlVuelta
014F   086B           00095   movf    txdat7,w
0150   0080           00096   movwf   INDF
0151   07EF           00097   addwf   txchksum,f
0152   0A84           00098   incf    FSR,f
0153   2???           00099   call    TxEnqueueCtrlVuelta
0154   086C           00100   movf    txdat8,w
0155   0080           00101   movwf   INDF
0156   07EF           00102   addwf   txchksum,f
0157   0A84           00103   incf    FSR,f
0158   2???           00104   call    TxEnqueueCtrlVuelta
0159   086D           00105   movf    txdat9,w
015A   0080           00106   movwf   INDF
015B   07EF           00107   addwf   txchksum,f
015C   0A84           00108   incf    FSR,f
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 67


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

015D   2???           00109   call    TxEnqueueCtrlVuelta
015E   086E           00110   movf    txdat10,w
015F   0080           00111   movwf   INDF
0160   07EF           00112   addwf   txchksum,f
0161   0A84           00113   incf    FSR,f
0162   2???           00114   call    TxEnqueueCtrlVuelta
0163   086F           00115   movf    txchksum,w
0164   0080           00116   movwf   INDF
                      00117   ; un incremento mas para que quede apuntando al siguiente
0165   0A84           00118   incf    FSR,f
0166   2???           00119   call    TxEnqueueCtrlVuelta
                      00120   ; actualizo el puntero de escritura de la cola circular
0167   0804           00121   movf    FSR,w
0168   00A9           00122   movwf   TxPtrAdd
                      00123 ;  bcf     STATUS,IRP    ; vuelvo a banco 0/1 de direccionamiento indirecto
0169                  00124 TxEnqueueCtrlBuffer
                      00125   ; controlo si el buffer está lleno (comparo puntero de escritura y lectura)
0169   0829           00126   movf    TxPtrAdd,w
016A   022A           00127   subwf   TxPtrSnd,w
016B   1903           00128   btfsc   STATUS,Z
016C   157F           00129   bsf     TXBUFFULL  ; está lleno
016D                  00130 TxEnqueueEnd
                      00131   ;incf    Variant,f
016D   0008           00132   return
                      00133 ; ============================================================================
                      00134 ; TxEnqueueCtrlVuelta
                      00135 ; ============================================================================
016E                  00136 TxEnqueueCtrlVuelta
016E   0804           00137   movf    FSR,w
016F   3C6F           00138   sublw   TXMAXBUFFER
0170   1903           00139   btfsc   STATUS,Z      ; (w == TXMAXBUFFER)
0171   2???           00140   goto    TxEnqueueCtrlVueltaSi
0172   1C03           00141   btfss   STATUS,C      ; (w < TXMAXBUFFER)
0173   2???           00142   goto    TxEnqueueCtrlVueltaSi
0174   0008           00143   return
                      00144 ;------------------------------------------------
0175                  00145 TxEnqueueCtrlVueltaSi
                      00146   ; vuelvo al inicio de la cola circular
0175   3010           00147   movlw   TXINITBUFFER
0176   0084           00148   movwf   FSR
0177   0008           00149   return
                      00150 ; ============================================================================
                      00151 ; TxDequeue
                      00152 ; ============================================================================
0178                  00153 TxDequeueCtrl
                      00154   ; me fijo si el buffer está lleno
0178   197F           00155   btfsc     TXBUFFULL
0179   2???           00156   goto      TxDequeueCtrlUp     ; está lleno, activo la transmisión
                      00157   ; me fijo si hay algo para transmitir por
                      00158   ; comparacion de inicio y fin del buffer
017A   0829           00159   movf    TxPtrAdd,w
017B   022A           00160   subwf   TxPtrSnd,w
017C   1D03           00161   btfss   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 68


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

017D   2???           00162   goto    TxDequeueCtrlUp
017E   0008           00163   return  ; nada che!
017F                  00164 TxDequeueCtrlUp
                      00165   ; habilito la interrupción de Tx
                      00166  ERRORLEVEL -302
017F   1683           00167   bsf     STATUS,RP0 ; --> BANK1
0180   1A0C           00168   btfsc   PIE1,TXIE
0181   2???           00169   goto    TxDequeueCtrlEnd ; si está activada la int no hago nada mas
0182   160C           00170   bsf     PIE1,TXIE
0183   1283           00171   bcf     STATUS,RP0 ; --> BANK0
                      00172  ERRORLEVEL +302
0184   2???           00173   call    TxInt
0185                  00174 TxDequeueCtrlEnd
0185   1283           00175   bcf     STATUS,RP0 ; --> BANK0
0186   0008           00176   return
                      00177 ; ============================================================================
                      00178 ; TxInt - se llama desde el programa para iniciar el envío de un mensaje y
                      00179 ;         desde una interrupcion para continuarlo
                      00180 ; ============================================================================
0187                  00181 TxInt
0187   1283           00182   bcf     STATUS,RP0  ; --> BANK0
0188   1303           00183   bcf     STATUS,RP1  ; \_ por si vengo de INT
0189   1E0C           00184   btfss   PIR1,TXIF
018A   0008           00185   return  ; el buffer está ocupado, cuando se vacíe la interrupcion se encarga
                      00186   ; el buffer está vacío o hubo interrupción
                      00187   ; me fijo si hay algo para transmitir
                      00188   ; por comparacion de inicio y fin del buffer
018B   0829           00189   movf    TxPtrAdd,w
018C   022A           00190   subwf   TxPtrSnd,w
018D   1D03           00191   btfss   STATUS,Z
018E   2???           00192   goto    TxIntCont
                      00193   ; inicio y fin son iguales => no hay mensajes o el buffer está lleno
018F   197F           00194   btfsc   TXBUFFULL
0190   0008           00195   return
                      00196   ; no hay nada, inhabilito la interrupcion
                      00197  ERRORLEVEL -302
0191   1683           00198   bsf     STATUS,RP0 ; --> BANK1
0192   120C           00199   bcf     PIE1,TXIE
0193   1283           00200   bcf     STATUS,RP0 ; --> BANK0
                      00201  ERRORLEVEL +302
0194   0008           00202   return  
0195                  00203 TxIntCont
0195   1783           00204   bsf     STATUS,IRP ; pasa a banco 2/3 para direccionamiento indirecto
0196   082A           00205   movf    TxPtrSnd,w
0197   0084           00206   movwf   FSR
0198   0800           00207   movf    INDF,w
0199   0099           00208   movwf   TXREG
019A   0A84           00209   incf    FSR,f
                      00210   ; ahora controlo si lleguó al final del buffer
019B   0804           00211   movf    FSR,w
019C   3C6F           00212   sublw   TXMAXBUFFER
019D   1903           00213   btfsc   STATUS,Z      ; (w == TXMAXBUFFER)
019E   2???           00214   goto    TxIntResetBuffer
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 69


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

019F   1C03           00215   btfss   STATUS,C      ; (w < TXMAXBUFFER)
01A0   2???           00216   goto    TxIntResetBuffer
                      00217   ; cargo la dirección del puntero
01A1   0804           00218   movf    FSR,w
01A2   00AA           00219   movwf   TxPtrSnd
01A3   2???           00220   goto    TxIntEnd
01A4                  00221 TxIntResetBuffer
                      00222   ; vuelvo al principio del buffer
01A4   3010           00223   movlw   TXINITBUFFER
01A5   00AA           00224   movwf   TxPtrSnd
01A6                  00225 TxIntEnd
                      00226 ;  bcf     STATUS,IRP    ; vuelvo a BANK 0/1 de direccionamiento indirecto
01A6   117F           00227   bcf     TXBUFFULL ; borro el flag por si el buffer estaba lleno
01A7   0008           00228   return
                      00229 ; ############################################################################
                      00230 ; ZONA RX
                      00231 ; ############################################################################
                      00232 ; ============================================================================
                      00233 ; RxInt - interrupcion por caracter recibido
                      00234 ; ============================================================================
01A8                  00235 RxInt
01A8   081A           00236   movf    RCREG,w
01A9   19FF           00237   btfsc   RXBUFFULL
01AA   2???           00238   goto    RxIntErr  ; el buffer de recepción está lleno, descarto lo recibido
01AB   00AE           00239   movwf   RxChar
                      00240   ; Controlo el dato recibido según la cantidad de bytes que tengo del mensaje
01AC   127F           00241   bcf     RXCHARERR
01AD   12FF           00242   bcf     RXCHAREND
01AE   2???           00243   call    ControlRxByte
01AF   1A7F           00244   btfsc   RXCHARERR
01B0   2???           00245   goto    RxIntErr    ; el caracter recibido no sirve
01B1   1AFF           00246   btfsc   RXCHAREND
01B2   2???           00247   goto    RxIntEnd    ; el caracter recibido fue el ultimo (ChkSum)
                      00248   ; el caracter recibido está OK
                      00249   ; incremento el contador de caracteres para este mensaje
01B3   0AAF           00250   incf    RxCharCount,f
01B4   082E           00251   movf    RxChar,w
01B5   07B0           00252   addwf   RxCharSum,f     ; mantengo el checksum
01B6   0008           00253   return
                      00254 ;------------------------------------------------
01B7                  00255 RxIntErr
                      00256   ; en caso de error de recepción tiro todo lo recibido como mensaje
01B7   082B           00257   movf    RxPtrAdd,w
01B8   00AC           00258   movwf   RxPtrAddTmp
01B9   01AF           00259   clrf    RxCharCount
01BA   0008           00260   return
                      00261 ;------------------------------------------------
01BB                  00262 RxIntEnd
01BB   082C           00263   movf    RxPtrAddTmp,w
01BC   00AB           00264   movwf   RxPtrAdd      ; adelanto el puntero del buffer
01BD   01AF           00265   clrf    RxCharCount   ; reseteo el contador de caracteres
01BE   0008           00266   return
                      00267 ; ============================================================================
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 70


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00268 ; ControlRxByte - Control de los bytes recibidos
                      00269 ; ============================================================================
01BF                  00270 ControlRxByte
01BF   127F           00271   bcf     RXCHARERR ; reseteo el flag de error
01C0   082F           00272   movf    RxCharCount,w
01C1   1903           00273   btfsc   STATUS,Z
01C2   2???           00274   goto    ControlRxStart    ; rxtyp   control del primer byte
                      00275   ;
01C3   082F           00276   movf    RxCharCount,w
01C4   3C02           00277   sublw   0x02
01C5   1903           00278   btfsc   STATUS,Z
01C6   2???           00279   goto    ControlSrc        ; rxsrc
                      00280   ;
01C7   082F           00281   movf    RxCharCount,w
01C8   3C0F           00282   sublw   0x0F
01C9   1903           00283   btfsc   STATUS,Z
01CA   2???           00284   goto    ControlChkSum     ; rxchksum
                      00285   ;
01CB   2???           00286   goto    RxAddBuffer
                      00287 ; ============================================================================
                      00288 ; Funciones de control de byte recibido
                      00289 ; - Lo controlan según su orden, lo mueven según corresponda
                      00290 ; * Se mueve a la cola circular:
                      00291 ;     rxtyp   
                      00292 ;     rxdst - para saber si es a mi a a todos   
                      00293 ;     rxsrc   
                      00294 ;     rxcnt   
                      00295 ;     rxfcn   
                      00296 ;     rxdat1  
                      00297 ;     rxdat2  
                      00298 ;     rxdat3  
                      00299 ;     rxdat4  
                      00300 ;     rxdat5  
                      00301 ;     rxdat6  
                      00302 ;     rxdat7  
                      00303 ;     rxdat8  
                      00304 ;     rxdat9  
                      00305 ;     rxdat10 
                      00306 ;
                      00307 ; ============================================================================
01CC                  00308 ControlRxStart
01CC   082E           00309   movf    RxChar,w
01CD   3C51           00310   sublw   'Q'
01CE   1903           00311   btfsc   STATUS,Z
01CF   2???           00312   goto    ControlRxStartOk
01D0   082E           00313   movf    RxChar,w
01D1   3C52           00314   sublw   'R'
01D2   1903           00315   btfsc   STATUS,Z
01D3   2???           00316   goto    ControlRxStartOk
01D4   082E           00317   movf    RxChar,w
01D5   3C45           00318   sublw   'E'
01D6   1903           00319   btfsc   STATUS,Z
01D7   2???           00320   goto    ControlRxStartOk
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 71


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01D8   167F           00321   bsf     RXCHARERR ; si no es ninguno de los anteriores hay un error
01D9   0008           00322   return
01DA                  00323 ControlRxStartOk
01DA   01B0           00324   clrf    RxCharSum   ; reseteo el checksum
01DB   2???           00325   call    RxAddBuffer
                      00326   ; cargo un time-out de 250ms para que termine de llegar el mensaje
01DC   3019           00327   movlw   0x19
01DD   00B1           00328   movwf   RxTimeOut
01DE   0008           00329   return
                      00330 ; -----------------
01DF                  00331 ControlSrc
01DF   08AE           00332   movf    RxChar,f
01E0   1D03           00333   btfss   STATUS,Z
01E1   167F           00334   bsf     RXCHARERR ;si el origen no era el host (unico origen permitido)
01E2   1903           00335   btfsc   STATUS,Z
01E3   2???           00336   call    RxAddBuffer
01E4   0008           00337   return
                      00338 ; -----------------
01E5                  00339 ControlChkSum
01E5   0830           00340   movf    RxCharSum,w
01E6   022E           00341   subwf   RxChar,w
01E7   1D03           00342   btfss   STATUS,Z
01E8   167F           00343   bsf     RXCHARERR  ;el checksum no dió
01E9   1D03           00344   btfss   STATUS,Z
01EA   0008           00345   return
                      00346   ; si el checksum dió OK tengo un mensaje !
01EB   16FF           00347   bsf     RXCHAREND
01EC   0008           00348   return
                      00349 ; ============================================================================
                      00350 ;  CheckRxOverflow - Verifica los flags de overflow y paridad
                      00351 ; ============================================================================
01ED                  00352 CheckRxOverflow
01ED   1C98           00353   btfss   RCSTA,OERR
01EE   0008           00354   return
01EF   1218           00355   bcf     RCSTA,CREN    ; reseteo la recepción
01F0   1618           00356   bsf     RCSTA,CREN
01F1   2???           00357   call    LongBeep
01F2   0008           00358   return
                      00359 ; ============================================================================
                      00360 ; ClrTx - limpia 
                      00361 ; ============================================================================
01F3                  00362 ClrRx
01F3   3020           00363   movlw   ' '
01F4   00D0           00364   movwf   rxtyp
01F5   00D1           00365   movwf   rxdst
01F6   00D2           00366   movwf   rxsrc
01F7   00D3           00367   movwf   rxcnt
01F8   00D4           00368   movwf   rxfcn
01F9   00D5           00369   movwf   rxdat1
01FA   00D6           00370   movwf   rxdat2
01FB   00D7           00371   movwf   rxdat3
01FC   00D8           00372   movwf   rxdat4
01FD   00D9           00373   movwf   rxdat5
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 72


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01FE   00DA           00374   movwf   rxdat6
01FF   00DB           00375   movwf   rxdat7
0200   00DC           00376   movwf   rxdat8
0201   00DD           00377   movwf   rxdat9
0202   00DE           00378   movwf   rxdat10
0203   00DF           00379   movwf   rxchksum
0204   0008           00380   return
                      00381 ; ============================================================================
                      00382 ; RxAddBuffer - agrega el contenido del registro RxChar al buffer de recepcion
                      00383 ; ============================================================================
0205                  00384 RxAddBuffer
0205   19FF           00385   btfsc   RXBUFFULL
0206   0008           00386   return    ; no hay lugar!!!
0207   1783           00387   bsf     STATUS,IRP ; pasa a banco 2/3 para direccionamiento indirecto
0208   082C           00388   movf    RxPtrAddTmp,w ; cargo la dirección donde escribir en el buffer
0209   0084           00389   movwf   FSR
                      00390   ; muevo el dato recibido
020A   082E           00391   movf    RxChar,w
020B   0080           00392   movwf   INDF
                      00393   ; incremento mas para que quede apuntando al siguiente
020C   0A84           00394   incf    FSR,f
                      00395 ;  bcf     STATUS,IRP    ; vuelvo a banco 0/1 de direccionamiento indirecto
                      00396   ; ahora controlo si llegué al final del buffer
020D   0804           00397   movf    FSR,w
020E   3CE9           00398   sublw   RXMAXBUFFER   ; (RXMAXBUFFER - w)
020F   1903           00399   btfsc   STATUS,Z      ; (w == RXMAXBUFFER)
0210   2???           00400   goto    RxAddBufferVuelta
0211   1C03           00401   btfss   STATUS,C      ; (w < RXMAXBUFFER)
0212   2???           00402   goto    RxAddBufferVuelta
                      00403 ;------------------------------------------------
0213                  00404 RxAddBufferSetAddr
                      00405   ; cargo la dirección del puntero
0213   0804           00406   movf    FSR,w
0214   00AC           00407   movwf   RxPtrAddTmp
0215   2???           00408   goto    RxAddBufferCtrlFull
                      00409 ;------------------------------------------------
0216                  00410 RxAddBufferVuelta
                      00411   ; llegué al final de la cola circular y pego la vuelta
0216   3090           00412   movlw   RXINITBUFFER
0217   00AC           00413   movwf   RxPtrAddTmp
                      00414 ;------------------------------------------------
0218                  00415 RxAddBufferCtrlFull
                      00416   ; controlo si el buffer está lleno
0218   082C           00417   movf    RxPtrAddTmp,w
0219   022D           00418   subwf   RxPtrRcv,w
021A   1903           00419   btfsc   STATUS,Z
021B   15FF           00420   bsf     RXBUFFULL  ; está lleno
021C   0008           00421   return
                      00422 ; ============================================================================
                      00423 ; RxDequeue - saca un mensaje de la cola de recepción, lo coloca en el registro
                      00424 ;             de recepción y llama a ProcessCmd
                      00425 ; ============================================================================
021D                  00426 RxDequeue
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 73


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00427   ; si el buffer está lleno no tengo nada mas que mirar
021D   19FF           00428   btfsc   RXBUFFULL
021E   2???           00429   goto    RxDequeueMsg
                      00430   ; si el buffer no está lleno comparo los punteros
021F   082B           00431   movf    RxPtrAdd,w
0220   022D           00432   subwf   RxPtrRcv,w
0221   1903           00433   btfsc   STATUS,Z
0222   0008           00434   return  ; son iguales, no hay nada en el buffer
                      00435 ;------------------------------------------------
0223                  00436 RxDequeueMsg
                      00437   ; muevo los datos al registro de adentro
0223   082D           00438   movf    RxPtrRcv,w
0224   0084           00439   movwf   FSR
0225   1783           00440   bsf     STATUS,IRP ; pasa a banco 2/3 para direccionamiento indirecto
0226   0800           00441   movf    INDF,w
0227   00D0           00442   movwf   rxtyp
0228   0A84           00443   incf    FSR,f
0229   2???           00444   call    RxDequeueCtrlVuelta
022A   0800           00445   movf    INDF,w
022B   00D1           00446   movwf   rxdst
022C   0A84           00447   incf    FSR,f
022D   2???           00448   call    RxDequeueCtrlVuelta
022E   0800           00449   movf    INDF,w
022F   00D2           00450   movwf   rxsrc
0230   0A84           00451   incf    FSR,f
0231   2???           00452   call    RxDequeueCtrlVuelta
0232   0800           00453   movf    INDF,w
0233   00D3           00454   movwf   rxcnt
0234   0A84           00455   incf    FSR,f
0235   2???           00456   call    RxDequeueCtrlVuelta
0236   0800           00457   movf    INDF,w
0237   00D4           00458   movwf   rxfcn
0238   0A84           00459   incf    FSR,f
0239   2???           00460   call    RxDequeueCtrlVuelta
023A   0800           00461   movf    INDF,w
023B   00D5           00462   movwf   rxdat1
023C   0A84           00463   incf    FSR,f
023D   2???           00464   call    RxDequeueCtrlVuelta
023E   0800           00465   movf    INDF,w
023F   00D6           00466   movwf   rxdat2
0240   0A84           00467   incf    FSR,f
0241   2???           00468   call    RxDequeueCtrlVuelta
0242   0800           00469   movf    INDF,w
0243   00D7           00470   movwf   rxdat3
0244   0A84           00471   incf    FSR,f
0245   2???           00472   call    RxDequeueCtrlVuelta
0246   0800           00473   movf    INDF,w
0247   00D8           00474   movwf   rxdat4
0248   0A84           00475   incf    FSR,f
0249   2???           00476   call    RxDequeueCtrlVuelta
024A   0800           00477   movf    INDF,w
024B   00D9           00478   movwf   rxdat5
024C   0A84           00479   incf    FSR,f
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 74


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

024D   2???           00480   call    RxDequeueCtrlVuelta
024E   0800           00481   movf    INDF,w
024F   00DA           00482   movwf   rxdat6
0250   0A84           00483   incf    FSR,f
0251   2???           00484   call    RxDequeueCtrlVuelta
0252   0800           00485   movf    INDF,w
0253   00DB           00486   movwf   rxdat7
0254   0A84           00487   incf    FSR,f
0255   2???           00488   call    RxDequeueCtrlVuelta
0256   0800           00489   movf    INDF,w
0257   00DC           00490   movwf   rxdat8
0258   0A84           00491   incf    FSR,f
0259   2???           00492   call    RxDequeueCtrlVuelta
025A   0800           00493   movf    INDF,w
025B   00DD           00494   movwf   rxdat9
025C   0A84           00495   incf    FSR,f
025D   2???           00496   call    RxDequeueCtrlVuelta
025E   0800           00497   movf    INDF,w
025F   00DE           00498   movwf   rxdat10
                      00499   ; un incremento mas para dejarlo en el siguiente
0260   0A84           00500   incf    FSR,f
0261   2???           00501   call    RxDequeueCtrlVuelta
                      00502 ;  bcf     STATUS,IRP    ; vuelvo a banco 0/1 de direccionamiento indirecto
                      00503   ; actualizo el puntero de recepción con el valor
                      00504   ; del registro de direccionamiento indirecto
0262   0804           00505   movf    FSR,w
0263   00AD           00506   movwf   RxPtrRcv
                      00507   ; borro el flag de buffer lleno
0264   11FF           00508   bcf     RXBUFFULL  ; por si estaba lleno lleno
                      00509   ; voy a procesar el comando
0265   2???           00510   goto    ProcessCmd           ; proceso lo recibido
                      00511 ;------------------------------------------------
                      00512 ; controla si tiene que volver al principio de la cola circular
0266                  00513 RxDequeueCtrlVuelta
0266   0804           00514   movf    FSR,w
0267   3CE9           00515   sublw   RXMAXBUFFER
0268   1903           00516   btfsc   STATUS,Z      ; (w == RXMAXBUFFER)
0269   2???           00517   goto    RxDequeueCtrlVueltaSi
026A   1C03           00518   btfss   STATUS,C      ; (w < RXMAXBUFFER)
026B   2???           00519   goto    RxDequeueCtrlVueltaSi
026C   0008           00520   return
                      00521 ;------------------------------------------------
026D                  00522 RxDequeueCtrlVueltaSi
                      00523   ; vuelvo al inicio de la cola circular
026D   3090           00524   movlw   RXINITBUFFER
026E   0084           00525   movwf   FSR
026F   0008           00526   return
                      00247   include "fcn.inc"
                      00001 ; ============================================================================
                      00002 ; ProcessCmd - procesa un comando si es otra cosa lo deriva
                      00003 ; ============================================================================
0270                  00004 ProcessCmd
                      00005   ; Reseteo el WFT
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 75


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0270   30FF           00006   movlw   0xFF
0271   00C8           00007   movwf   CntTrafic
                      00008   ; me fijo si es para mi, broadcast u otro
0272   0851           00009   movf    rxdst,w      ; comparo con mi direccion
0273   0271           00010   subwf   LocAddr,w
0274   1903           00011   btfsc   STATUS,Z
0275   2???           00012   goto    ProcessCmdOk
0276   0851           00013   movf    rxdst,w      ; comparo con la direccion de broadcast
0277   3CFF           00014   sublw   BSTADDR
0278   1D03           00015   btfss   STATUS,Z
0279   0008           00016   return               ; no era para mi ni broadcast
027A                  00017 ProcessCmdOk
                      00018   ; limpio los datos de respuesta
027A   2???           00019   call    ClrTx
                      00020   ; llegó un mensaje, me fijo qué es
027B   0850           00021   movf    rxtyp,w
027C   3C51           00022   sublw   'Q'
027D   1D03           00023   btfss   STATUS,Z
027E   2???           00024   goto    ProcessResp
                      00025   ; es un requerimiento
                      00026   ; Controlo si es repetido
027F   13FF           00027   bcf     DUPMSG
0280   0832           00028   movf    RxLastCnt,w
0281   0253           00029   subwf   rxcnt,w
0282   1903           00030   btfsc   STATUS,Z
0283   17FF           00031   bsf     DUPMSG
0284   0853           00032   movf    rxcnt,w
0285   00B2           00033   movwf   RxLastCnt
                      00034   ; salto por funcion
0286   0854           00035   movf    rxfcn,w   ; - - - - - - - -
0287   3C50           00036   sublw   'P'       ; -  Funcion 'P'
0288   1903           00037   btfsc   STATUS,Z  ; -     PING
0289   2???           00038   goto    FcnQP     ; -
028A   0854           00039   movf    rxfcn,w   ; - - - - - - - -
028B   3C33           00040   sublw   '3'       ; -  Funcion '3'
028C   1903           00041   btfsc   STATUS,Z  ; -    SETBIT
028D   2???           00042   goto    FcnQ3     ; -
028E   0854           00043   movf    rxfcn,w   ; - - - - - - - -
028F   3C34           00044   sublw   '4'       ; -  Funcion '4'
0290   1903           00045   btfsc   STATUS,Z  ; -    IRCODE
0291   2???           00046   goto    FcnQ4     ; -
0292   0854           00047   movf    rxfcn,w   ; - - - - - - - -
0293   3C35           00048   sublw   '5'       ; -  Funcion '5'
0294   1903           00049   btfsc   STATUS,Z  ; -    PULSE
0295   2???           00050   goto    FcnQ5     ; -
0296   0854           00051   movf    rxfcn,w   ; - - - - - - - -
0297   3C36           00052   sublw   '6'       ; -  Funcion '6'
0298   1903           00053   btfsc   STATUS,Z  ; -    GETIN
0299   2???           00054   goto    FcnQ6     ; -
029A   0854           00055   movf    rxfcn,w   ; - - - - - - - -
029B   3C37           00056   sublw   '7'       ; -  Funcion '7'
029C   1903           00057   btfsc   STATUS,Z  ; -    GETOUT
029D   2???           00058   goto    FcnQ7     ; -
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 76


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

029E   0854           00059   movf    rxfcn,w   ; - - - - - - - -
029F   3C38           00060   sublw   '8'       ; -  Funcion '8'
02A0   1903           00061   btfsc   STATUS,Z  ; -   GETANALOG
02A1   2???           00062   goto    FcnQ8     ; -
02A2   0854           00063   movf    rxfcn,w   ; - - - - - - - -
02A3   3C4C           00064   sublw   'L'       ; -  Funcion 'L'
02A4   1903           00065   btfsc   STATUS,Z  ; -    SETADDR
02A5   2???           00066   goto    FcnQL     ; -
02A6   0854           00067   movf    rxfcn,w   ; - - - - - - - -
02A7   3C54           00068   sublw   'T'       ; -  Funcion 'T'
02A8   1903           00069   btfsc   STATUS,Z  ; -    SETTIME
02A9   2???           00070   goto    FcnQT     ; -
02AA   0854           00071   movf    rxfcn,w   ; - - - - - - - -
02AB   3C49           00072   sublw   'I'       ; -  Funcion 'I'
02AC   1903           00073   btfsc   STATUS,Z  ; -    INVERT
02AD   2???           00074   goto    FcnQI     ; -
02AE   0854           00075   movf    rxfcn,w   ; - - - - - - - -
02AF   3C52           00076   sublw   'R'       ; -  Funcion 'R'
02B0   1903           00077   btfsc   STATUS,Z  ; -    RESET
02B1   2???           00078   goto    FcnQR     ; -
02B2   0854           00079   movf    rxfcn,w   ; - - - - - - - -
02B3   3C42           00080   sublw   'B'       ; -  Funcion 'B'
02B4   1903           00081   btfsc   STATUS,Z  ; -   BAUDRATE
02B5   2???           00082   goto    FcnQB     ; -
02B6   0854           00083   movf    rxfcn,w   ; - - - - - - - -
02B7   3C46           00084   sublw   'F'       ; -  Funcion 'F'
02B8   1903           00085   btfsc   STATUS,Z  ; -   Seguidores
02B9   2???           00086   goto    FcnQF     ; -
02BA   0854           00087   movf    rxfcn,w   ; - - - - - - - -
02BB   3C4F           00088   sublw   'O'       ; -  Funcion 'O'
02BC   1903           00089   btfsc   STATUS,Z  ; -   Mascaras de notificacion
02BD   2???           00090   goto    FcnQO     ; -
02BE   0854           00091   movf    rxfcn,w   ; - - - - - - - -
02BF   3C41           00092   sublw   'A'       ; -  Funcion 'A'
02C0   1903           00093   btfsc   STATUS,Z  ; -   ALARM A/D
02C1   2???           00094   goto    FcnQA     ; -
02C2   0854           00095   movf    rxfcn,w   ; - - - - - - - -
02C3   3C43           00096   sublw   'C'       ; -  Funcion 'C'
02C4   1903           00097   btfsc   STATUS,Z  ; -   Play Beep
02C5   2???           00098   goto    FcnQC     ; -
02C6   0854           00099   movf    rxfcn,w   ; - - - - - - - -
02C7   3C44           00100   sublw   'D'       ; -  Funcion 'D'
02C8   1903           00101   btfsc   STATUS,Z  ; -   MSG-1L
02C9   2???           00102   goto    FcnQD     ; -
02CA   0854           00103   movf    rxfcn,w   ; - - - - - - - -
02CB   3C45           00104   sublw   'E'       ; -  Funcion 'E'
02CC   1903           00105   btfsc   STATUS,Z  ; -   MSG-1R
02CD   2???           00106   goto    FcnQE     ; -
02CE   0854           00107   movf    rxfcn,w   ; - - - - - - - -
02CF   3C47           00108   sublw   'G'       ; -  Funcion 'G'
02D0   1903           00109   btfsc   STATUS,Z  ; -   MSG-2L
02D1   2???           00110   goto    FcnQG     ; -
02D2   0854           00111   movf    rxfcn,w   ; - - - - - - - -
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 77


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02D3   3C48           00112   sublw   'H'       ; -  Funcion 'H'
02D4   1903           00113   btfsc   STATUS,Z  ; -   MSG-2R
02D5   2???           00114   goto    FcnQH     ; -
02D6   0854           00115   movf    rxfcn,w   ; - - - - - - - -
02D7   3C4A           00116   sublw   'J'       ; -  Funcion 'J'
02D8   1903           00117   btfsc   STATUS,Z  ; -   MSG-3L
02D9   2???           00118   goto    FcnQJ     ; -
02DA   0854           00119   movf    rxfcn,w   ; - - - - - - - -
02DB   3C4B           00120   sublw   'K'       ; -  Funcion 'K'
02DC   1903           00121   btfsc   STATUS,Z  ; -   MSG-3R
02DD   2???           00122   goto    FcnQK     ; -
02DE   0854           00123   movf    rxfcn,w   ; - - - - - - - -
02DF   3C4D           00124   sublw   'M'       ; -  Funcion 'M'
02E0   1903           00125   btfsc   STATUS,Z  ; -   MSG-4L
02E1   2???           00126   goto    FcnQM     ; -
02E2   0854           00127   movf    rxfcn,w   ; - - - - - - - -
02E3   3C4E           00128   sublw   'N'       ; -  Funcion 'N'
02E4   1903           00129   btfsc   STATUS,Z  ; -   MSG-4R
02E5   2???           00130   goto    FcnQN     ; -
02E6   0854           00131   movf    rxfcn,w  ; ----------------
02E7   3C51           00132   sublw   'Q'      ; -  Funcion 'Q'
02E8   1903           00133   btfsc   STATUS,Z ; -    Display Config
02E9   2???           00134   goto    FcnQQ    ; -
                      00135   ; comando desconocido, no hace nada
02EA   0008           00136   return
                      00137 ; ============================================================================
                      00138 ; ProcessResp - procesa una respuesta si es otra cosa lo deriva
                      00139 ; ============================================================================
02EB                  00140 ProcessResp
                      00141   ; me fijo qué es
02EB   0850           00142   movf    rxtyp,w
02EC   3C52           00143   sublw   'R'
02ED   1D03           00144   btfss   STATUS,Z
02EE   2???           00145   goto    ProcessError
02EF   01B6           00146   clrf    DelayResend    ; una vez recibida respuesta no espero si tengo que 
02F0   0AA8           00147   incf    Variant,f      ; incremento el contador de mensajes
                      00148   ; --> salto por función
02F1   0854           00149   movf    rxfcn,w  ; ----------------
02F2   3C50           00150   sublw   'P'      ; -  Funcion 'P'
02F3   1903           00151   btfsc   STATUS,Z ; -     PING
02F4   2???           00152   goto    FcnRP    ; -
02F5   0854           00153   movf    rxfcn,w  ; ----------------
02F6   3C36           00154   sublw   '6'      ; -  Funcion '6'
02F7   1903           00155   btfsc   STATUS,Z ; -    INFO-IN
02F8   2???           00156   goto    FcnR6    ; -
02F9   0854           00157   movf    rxfcn,w  ; ----------------
02FA   3C37           00158   sublw   '7'      ; -  Funcion '7'
02FB   1903           00159   btfsc   STATUS,Z ; -    INFO-OUT
02FC   2???           00160   goto    FcnR7    ; -
02FD   0854           00161   movf    rxfcn,w  ; ----------------
02FE   3C39           00162   sublw   '9'      ; -  Funcion '9'
02FF   1903           00163   btfsc   STATUS,Z ; -    AD-ALARM
0300   2???           00164   goto    FcnR9    ; -
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 78


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0301   0854           00165   movf    rxfcn,w  ; ----------------
0302   3C54           00166   sublw   'T'      ; -  Funcion 'T'
0303   1903           00167   btfsc   STATUS,Z ; -    TIME
0304   2???           00168   goto    FcnRT    ; -
                      00169   ; para el resto por ahora no hago nada, despues veo que pongo acá
0305   0008           00170   return
                      00171 ; ============================================================================
                      00172 ; ProcessError - procesa un error si es otra cosa está mal
                      00173 ; ============================================================================
0306                  00174 ProcessError
                      00175   ; llegó un error, me fijo qué es
0306   0850           00176   movf    rxtyp,w
0307   3C45           00177   sublw   'E'
0308   1D03           00178   btfss   STATUS,Z
0309   0008           00179   return  ; mensaje de tipo desconocido
030A   01B6           00180   clrf    DelayResend    ; una vez recibida respuesta no espero si tengo que 
030B   0AA8           00181   incf    Variant,f      ; incremento el contador de mensajes
                      00182 
                      00183   ; es un error --> por ahora no hago nada, despues veo si pongo algo acá
                      00184 
                      00185   ; Algún dia voy a poner algo acá
                      00186 
030C   0008           00187   return
                      00188 
                      00189 ; ----------------------------------------------------------------------------
                      00190 ; FcnQOk - Respuesta de solo OK
                      00191 ; ----------------------------------------------------------------------------
030D                  00192 FcnQOk
                      00193   ; si era un comando broadcast no contesto
030D   0851           00194   movf    rxdst,w
030E   3CFF           00195   sublw   BSTADDR
030F   1903           00196   btfsc   STATUS,Z
0310   0008           00197   return  ; era un mensaje de broadcast
0311   3052           00198   movlw   'R'        ; start char
0312   00E0           00199   movwf   txtyp
0313   0852           00200   movf    rxsrc,w    ; dest addr
0314   00E1           00201   movwf   txdst
0315   0853           00202   movf    rxcnt,w    ; contador
0316   00E3           00203   movwf   txcnt
0317   0854           00204   movf    rxfcn,w    ; comando - el mismo recibido
0318   00E4           00205   movwf   txfcn
                      00206   ; lo encola y termina
0319   2???           00207   goto    TxEnqueue
                      00208 
                      00209 ; ----------------------------------------------------------------------------
                      00210 ; FcnQError - Respuesta generica de error
                      00211 ; ----------------------------------------------------------------------------
031A                  00212 FcnQError
031A   3045           00213   movlw   'E'        ; start char
031B   00E0           00214   movwf   txtyp
031C   0852           00215   movf    rxsrc,w    ; dest addr
031D   00E1           00216   movwf   txdst
031E   0853           00217   movf    rxcnt,w    ; contador
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 79


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

031F   00E3           00218   movwf   txcnt
0320   0854           00219   movf    rxfcn,w    ; comando - el mismo recibido
0321   00E4           00220   movwf   txfcn
0322   0826           00221   movf    ErrCde1,w  ; primer digito de respuesta
0323   00E5           00222   movwf   txdat1
                      00223   ; lo encola y termina
0324   2???           00224   goto    TxEnqueue
                      00225 ; ============================================================================
                      00226 ; ============================================================================
                      00227 ; Tratamiento de requerimientos
                      00228 ; ----------------------------------------------------------------------------
                      00229 ; FcnQP - Ping
                      00230 ; ----------------------------------------------------------------------------
0325                  00231 FcnQP
                      00232   ; el host está (LOGGED-ON)
0325   187F           00233   btfsc   HSTONLINE
0326   2???           00234   goto    FcnQP1       ; ya estaba logged-on
                      00235   ; tres pitidos
0327   2???           00236   call    Short3Beep
                      00237   ; flag logged-on
0328   147F           00238   bsf     HSTONLINE
                      00239   ; cambio la pantalla para que muestre la Screen1 (fecha/hora)
0329   3001           00240   movlw   0x01
032A   00FC           00241   movwf   ScrnId
032B   157B           00242   bsf     DISPLAY_DATA
032C                  00243 FcnQP1
                      00244   ; armo la respuesta al ping
032C   3052           00245   movlw   'R'        ; start char
032D   00E0           00246   movwf   txtyp
032E   0852           00247   movf    rxsrc,w    ; dest addr
032F   00E1           00248   movwf   txdst
0330   0853           00249   movf    rxcnt,w    ; contador
0331   00E3           00250   movwf   txcnt
0332   0854           00251   movf    rxfcn,w    ; comando - el mismo recibido
0333   00E4           00252   movwf   txfcn
0334   3002           00253   movlw   HARTYPE    ; tipo de dispositivo
0335   00E5           00254   movwf   txdat1
0336   3001           00255   movlw   HARDVER    ; version de dispositivo
0337   00E6           00256   movwf   txdat2
0338   3001           00257   movlw   SOFTVER    ; version de software
0339   00E7           00258   movwf   txdat3
033A   3003           00259   movlw   PROCESSOR_VER ; micro procesador
033B   00E8           00260   movwf   txdat4
033C   3000           00261   movlw   0             ; presencia de display
033D   187B           00262   btfsc   DISPLAY_OK
033E   3050           00263   movlw   0x50 ; display de 80 caracteres
033F   00E9           00264   movwf   txdat5
                      00265   ; lo encola y termina
0340   2???           00266   goto    TxEnqueue
                      00267 ; ----------------------------------------------------------------------------
                      00268 ; FcnQ3 - SETBIT
                      00269 ; ----------------------------------------------------------------------------
0341                  00270 FcnQ3
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 80


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00271   ; si es duplicada contesto sin hacer nada
0341   1BFF           00272   btfsc   DUPMSG
0342   2???           00273   goto    FcnQOk
                      00274   ; limpio el error
0343   01A6           00275   clrf    ErrCde1
0344   1383           00276   bcf     STATUS,IRP ; pasa a banco 0/1 para direccionamiento indirecto
                      00277   ; me abro por nro de salida
                      00278   ; salida 1
0345   0855           00279   movf    rxdat1,w
0346   3C31           00280   sublw   '1'
0347   1903           00281   btfsc   STATUS,Z
0348   2???           00282   goto    FcnQ3s1
                      00283   ; salida 2
0349   0855           00284   movf    rxdat1,w
034A   3C32           00285   sublw   '2'
034B   1903           00286   btfsc   STATUS,Z
034C   2???           00287   goto    FcnQ3s2
                      00288   ; si no es ninguna de las contempladas es un error
034D   2???           00289   goto    FcnQError
034E                  00290 FcnQ3s1
                      00291   ; cargo la direccion de la salida 1 en el registro de direccionamiento ind
034E   3072           00292   movlw   SALIDA1
034F   0084           00293   movwf   FSR
                      00294   ; levanto el flag de modificación
0350   157E           00295   bsf     CAMBIO_S1
0351   2???           00296   goto    FcnQ3Set
0352                  00297 FcnQ3s2
                      00298   ; cargo la direccion de la salida 2 en el registro de direccionamiento ind
0352   3073           00299   movlw   SALIDA2
0353   0084           00300   movwf   FSR
                      00301   ; levanto el flag de modificación
0354   15FE           00302   bsf     CAMBIO_S2
                      00303 ; goto    FcnQ3Set
0355                  00304 FcnQ3Set
                      00305   ; voy incrementando ErrCde1 para que en caso
                      00306   ; de error pueda saber en que etapa se produjo
0355   0AA6           00307   incf    ErrCde1,f
                      00308   ; calculo el salto en función del bit a encender o apagar
0356   3030           00309   movlw   '0'
0357   0256           00310   subwf   rxdat2,w
0358   00CA           00311   movwf   RegTmpG
                      00312   ; verifico que no sea mayor a 7
0359   39F8           00313   andlw   0xF8
035A   1D03           00314   btfss   STATUS,Z
035B   2???           00315   goto    FcnQError
                      00316   ; voy incrementando ErrCde1 para que en caso
                      00317   ; de error pueda saber en que etapa se produjo
035C   0AA6           00318   incf    ErrCde1,f
                      00319   ; multiplico por 4 para provocar un salto del cuadruple
                      00320   ; borro el carry para que no se me meta en el LSB
035D   1003           00321   bcf     STATUS,C
035E   0DCA           00322   rlf     RegTmpG,f
035F   1003           00323   bcf     STATUS,C
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 81


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0360   0DCA           00324   rlf     RegTmpG,f
                      00325   ; ahora me fijo si es encender o apagar
0361   3030           00326   movlw   '0'
0362   0257           00327   subwf   rxdat3,w
0363   1903           00328   btfsc   STATUS,Z
0364   2???           00329   goto    FcnQ3SetA ; si es apagar no hay que calcular mas nada
0365   3031           00330   movlw   '1'
0366   0257           00331   subwf   rxdat3,w
0367   1D03           00332   btfss   STATUS,Z
0368   2???           00333   goto    FcnQError ; si no es ni '0' ni '1' es un error
0369   3002           00334   movlw   0x02
036A   07CA           00335   addwf   RegTmpG,f
036B                  00336 FcnQ3SetA
                      00337 ; FcnQ3SetB - movido a la zona de tablas
036B   2???           00338   call    FcnQ3SetB
                      00339   ; listo, grabo en EE en 5 segundos
036C   3005           00340   movlw   0x05
036D   00B3           00341   movwf   SaveEECount
036E   2???           00342   goto    FcnQOk
                      00343 ; ----------------------------------------------------------------------------
                      00344 ; FcnQ4 - IRCODE
                      00345 ; ----------------------------------------------------------------------------
036F                  00346 FcnQ4
                      00347   ; si es duplicada contesto sin hacer nada
036F   1BFF           00348   btfsc   DUPMSG
0370   2???           00349   goto    FcnQOk
                      00350   ; limpio el error
0371   01A6           00351   clrf    ErrCde1
                      00352   ; muevo el código al buffer infra-rojo
                      00353  ERRORLEVEL -302
0372   0855           00354   movf    rxdat1,w
0373   1683           00355   bsf     STATUS,RP0 ; --> BANK1
0374   00B9           00356   movwf   IRCode1
0375   1283           00357   bcf     STATUS,RP0 ; --> BANK0
0376   0856           00358   movf    rxdat2,w
0377   1683           00359   bsf     STATUS,RP0 ; --> BANK1
0378   00BA           00360   movwf   IRCode2
0379   1283           00361   bcf     STATUS,RP0 ; --> BANK0
037A   0857           00362   movf    rxdat3,w
037B   1683           00363   bsf     STATUS,RP0 ; --> BANK1
037C   00BB           00364   movwf   IRCode3
037D   1283           00365   bcf     STATUS,RP0 ; --> BANK0
037E   0858           00366   movf    rxdat4,w
037F   1683           00367   bsf     STATUS,RP0 ; --> BANK1
0380   00BC           00368   movwf   IRCode4
0381   1283           00369   bcf     STATUS,RP0 ; --> BANK0
0382   0859           00370   movf    rxdat5,w
0383   1683           00371   bsf     STATUS,RP0 ; --> BANK1
0384   00BD           00372   movwf   IRCode5
0385   1283           00373   bcf     STATUS,RP0 ; --> BANK0
                      00374  ERRORLEVEL +302
0386   16FE           00375   bsf     SEND_IR    ; para que transmita
0387   2???           00376   goto    FcnQOk
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 82


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00377 ; ----------------------------------------------------------------------------
                      00378 ; FcnQ5 - PULSE
                      00379 ; ----------------------------------------------------------------------------
0388                  00380 FcnQ5
                      00381   ; si es duplicada contesto sin hacer nada
0388   1BFF           00382   btfsc   DUPMSG
0389   2???           00383   goto    FcnQOk
                      00384   ; limpio el error
038A   01A6           00385   clrf    ErrCde1
038B   1383           00386   bcf     STATUS,IRP ; pasa a banco 0/1 para direccionamiento indirecto
                      00387   ; calculo el nro de bit a modificar
038C   3030           00388   movlw   '0'
038D   0256           00389   subwf   rxdat2,w
                      00390   ; lo guardo en un temporal (lo voy a usar varias veces)
038E   00CA           00391   movwf   RegTmpG
                      00392   ; verifico que no sea mayor a 7
038F   39F8           00393   andlw   0xF8
0390   1D03           00394   btfss   STATUS,Z
0391   2???           00395   goto    FcnQError
                      00396   ; voy incrementando ErrCde1 para que en caso
                      00397   ; de error pueda saber en qué etapa se produjo
0392   0AA6           00398   incf    ErrCde1,f
                      00399   ; me abro por nro de salida
0393   0855           00400   movf    rxdat1,w
0394   3C31           00401   sublw   '1'
0395   1903           00402   btfsc   STATUS,Z
0396   2???           00403   goto    FcnQ5s1
0397   0855           00404   movf    rxdat1,w
0398   3C32           00405   sublw   '2'
0399   1903           00406   btfsc   STATUS,Z
039A   2???           00407   goto    FcnQ5s2
                      00408   ; si no es ni '1' ni '2' es un error
039B   2???           00409   goto    FcnQError
039C                  00410 FcnQ5s1
                      00411   ; seteo el contador para el retorno del pulso con el valor del 3er dato
039C   084A           00412   movf    RegTmpG,w
039D   2???           00413   call    GetPulseCountS1
039E   0084           00414   movwf   FSR
039F   0857           00415   movf    rxdat3,w
03A0   0080           00416   movwf   INDF
                      00417   ; cargo la direccion de la salida 1 en el registro de direccionamiento ind
03A1   3072           00418   movlw   SALIDA1
03A2   0084           00419   movwf   FSR
                      00420   ; levanto el flag de modificación
03A3   157E           00421   bsf     CAMBIO_S1
03A4   2???           00422   goto    FcnQ5Set
03A5                  00423 FcnQ5s2
                      00424   ; seteo el contador para el retorno del pulso con el valor del 3er dato
03A5   084A           00425   movf    RegTmpG,w
03A6   2???           00426   call    GetPulseCountS2
03A7   0084           00427   movwf   FSR
03A8   0857           00428   movf    rxdat3,w
03A9   0080           00429   movwf   INDF
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 83


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00430   ; cargo la direccion de la salida 2 en el registro de direccionamiento ind
03AA   3073           00431   movlw   SALIDA2
03AB   0084           00432   movwf   FSR
                      00433   ; levanto el flag de modificación
03AC   15FE           00434   bsf     CAMBIO_S2
03AD                  00435 FcnQ5Set
                      00436   ; levanto el bit seleccionado
03AD   084A           00437   movf    RegTmpG,w
03AE   2???           00438   call    SetWBitW
03AF   0480           00439   iorwf   INDF,f
                      00440   ; listo, grabo en EE en 5 segundos
03B0   3005           00441   movlw   0x05
03B1   00B3           00442   movwf   SaveEECount
                      00443   ; contesto
03B2   2???           00444   goto    FcnQOk
                      00445 ; ----------------------------------------------------------------------------
                      00446 ; FcnQ6 - GETIN
                      00447 ; ----------------------------------------------------------------------------
03B3                  00448 FcnQ6
03B3   01A6           00449   clrf    ErrCde1
                      00450   ; preparo la respuesta
03B4   0855           00451   movf    rxdat1,w
03B5   00E5           00452   movwf   txdat1
                      00453   ; me abro por nro de entrada
03B6   0855           00454   movf    rxdat1,w
03B7   3C31           00455   sublw   '1'
03B8   1903           00456   btfsc   STATUS,Z
03B9   2???           00457   goto    FcnQ6e1
03BA   0855           00458   movf    rxdat1,w
03BB   3C32           00459   sublw   '2'
03BC   1903           00460   btfsc   STATUS,Z
03BD   2???           00461   goto    FcnQ6e2
                      00462   ; si no es ni '1' ni '2' es un error
03BE   2???           00463   goto    FcnQError
03BF                  00464 FcnQ6e1
                      00465   ; cargo el valor de la entrada
03BF   0874           00466   movf    ENTRADA1,w
03C0   00E6           00467   movwf   txdat2
                      00468   ; le agrego la configuracion de la mascara de notificacion
                      00469  ERRORLEVEL -302
03C1   1683           00470   bsf     STATUS,RP0    ; --> BANK1
03C2   0840           00471   movf    MaskNotifE1,w
03C3   1283           00472   bcf     STATUS,RP0    ; --> BANK0
                      00473  ERRORLEVEL +302
03C4   00E7           00474   movwf   txdat3
                      00475   ; le agrego la configuracion de seguidores
03C5   0876           00476   movf    Mascara_E1S1,w
03C6   00E8           00477   movwf   txdat4
03C7   2???           00478   goto    FcnQOk
03C8                  00479 FcnQ6e2
                      00480   ; cargo el valor de la entrada
03C8   0875           00481   movf    ENTRADA2,w
03C9   00E6           00482   movwf   txdat2
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 84


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00483   ; le agrego la configuracion de la mascara de notificacion
                      00484  ERRORLEVEL -302
03CA   1683           00485   bsf     STATUS,RP0    ; --> BANK1
03CB   0841           00486   movf    MaskNotifE2,w
03CC   1283           00487   bcf     STATUS,RP0    ; --> BANK0
                      00488  ERRORLEVEL +302
03CD   00E7           00489   movwf   txdat3
                      00490   ; le agrego la configuracion de seguidores
03CE   0877           00491   movf    Mascara_E2S2,w
03CF   00E8           00492   movwf   txdat4
03D0   2???           00493   goto    FcnQOk
                      00494 ; ----------------------------------------------------------------------------
                      00495 ; FcnQ7 - GETOUT
                      00496 ; ----------------------------------------------------------------------------
03D1                  00497 FcnQ7
03D1   01A6           00498   clrf    ErrCde1
                      00499   ; preparo la respuesta
03D2   0855           00500   movf    rxdat1,w
03D3   00E5           00501   movwf   txdat1
                      00502   ; me abro por nro de salida
03D4   0855           00503   movf    rxdat1,w
03D5   3C31           00504   sublw   '1'
03D6   1903           00505   btfsc   STATUS,Z
03D7   2???           00506   goto    FcnQ7s1
03D8   0855           00507   movf    rxdat1,w
03D9   3C32           00508   sublw   '2'
03DA   1903           00509   btfsc   STATUS,Z
03DB   2???           00510   goto    FcnQ7s2
                      00511   ; si no es ni '1' ni '2' es un error
03DC   2???           00512   goto    FcnQError
03DD                  00513 FcnQ7s1
                      00514   ; cargo el valor de la salida
03DD   0872           00515   movf    SALIDA1,w
03DE   00E6           00516   movwf   txdat2
                      00517   ; le agrego la configuracion de la mascara de notificacion
                      00518  ERRORLEVEL -302
03DF   1683           00519   bsf     STATUS,RP0    ; --> BANK1
03E0   0842           00520   movf    MaskNotifS1,w
03E1   1283           00521   bcf     STATUS,RP0    ; --> BANK0
                      00522  ERRORLEVEL +302
03E2   00E7           00523   movwf   txdat3
                      00524   ; le agrego la configuracion de seguidores
03E3   0876           00525   movf    Mascara_E1S1,w
03E4   00E8           00526   movwf   txdat4
                      00527   ; le agrego la configuracion de seguidores
03E5   3000           00528   movlw   0
03E6   00E9           00529   movwf   txdat5
03E7   2???           00530   goto    FcnQOk
03E8                  00531 FcnQ7s2
                      00532   ; cargo el valor de la salida
03E8   0873           00533   movf    SALIDA2,w
03E9   00E6           00534   movwf   txdat2
                      00535   ; le agrego la configuracion de la mascara de notificacion
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 85


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00536  ERRORLEVEL -302
03EA   1683           00537   bsf     STATUS,RP0    ; --> BANK1
03EB   0843           00538   movf    MaskNotifS2,w
03EC   1283           00539   bcf     STATUS,RP0    ; --> BANK0
                      00540  ERRORLEVEL +302
03ED   00E7           00541   movwf   txdat3
                      00542   ; le agrego la configuracion de seguidores
03EE   0877           00543   movf    Mascara_E2S2,w
03EF   00E8           00544   movwf   txdat4
                      00545   ; le agrego la configuracion de seguidores
03F0   0878           00546   movf    Mascara_ANS2,w
03F1   00E9           00547   movwf   txdat5
03F2   2???           00548   goto    FcnQOk
                      00549 ; ----------------------------------------------------------------------------
                      00550 ; FcnQ8 - GETANALOG
                      00551 ; ----------------------------------------------------------------------------
03F3                  00552 FcnQ8
03F3   01A6           00553   clrf    ErrCde1
03F4   1383           00554   bcf     STATUS,IRP ; pasa a banco 0/1 para direccionamiento indirecto
                      00555   ; preparo la respuesta
03F5   0855           00556   movf    rxdat1,w
03F6   00E5           00557   movwf   txdat1
                      00558   ; me abro por nro de salida
03F7   0855           00559   movf    rxdat1,w
03F8   3C31           00560   sublw   '1'
03F9   1903           00561   btfsc   STATUS,Z
03FA   2???           00562   goto    FcnQ8e1
03FB   0855           00563   movf    rxdat1,w
03FC   3C32           00564   sublw   '2'
03FD   1903           00565   btfsc   STATUS,Z
03FE   2???           00566   goto    FcnQ8e2
03FF   0855           00567   movf    rxdat1,w
0400   3C33           00568   sublw   '3'
0401   1903           00569   btfsc   STATUS,Z
0402   2???           00570   goto    FcnQ8e3
0403   0855           00571   movf    rxdat1,w
0404   3C34           00572   sublw   '4'
0405   1903           00573   btfsc   STATUS,Z
0406   2???           00574   goto    FcnQ8e4
                      00575   ; si no está entre 1 y 4 está mal
0407   2???           00576   goto    FcnQError
0408                  00577 FcnQ8e1
                      00578   ; cargo los valores de la entrada analogica
0408   083F           00579   movf    ANALOG1H,w
0409   00E6           00580   movwf   txdat2
040A   0840           00581   movf    ANALOG1L,w
040B   00E7           00582   movwf   txdat3
                      00583   ; cargo los valores de la alarma analogica
040C   30E0           00584   movlw   ANALOG1_MAXH
040D   0084           00585   movwf   FSR
040E   0800           00586   movf    INDF,w      ; ANALOG1_MAXH
040F   00E8           00587   movwf   txdat4
0410   0A84           00588   incf    FSR,f
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 86


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0411   0800           00589   movf    INDF,w      ; ANALOG1_MAXL
0412   00E9           00590   movwf   txdat5
0413   0A84           00591   incf    FSR,f
0414   0800           00592   movf    INDF,w      ; ANALOG1_MINH
0415   00EA           00593   movwf   txdat6
0416   0A84           00594   incf    FSR,f
0417   0800           00595   movf    INDF,w      ; ANALOG1_MINL
0418   00EB           00596   movwf   txdat7
0419   1C79           00597   btfss   AN1_UMBRAL
041A   3030           00598   movlw   '0'
041B   1879           00599   btfsc   AN1_UMBRAL
041C   3031           00600   movlw   '1'
041D   00EC           00601   movwf   txdat8
041E   2???           00602   goto    FcnQ8Fin
041F                  00603 FcnQ8e2
                      00604   ; cargo los valores de la entrada analogica
041F   0841           00605   movf    ANALOG2H,w
0420   00E6           00606   movwf   txdat2
0421   0842           00607   movf    ANALOG2L,w
0422   00E7           00608   movwf   txdat3
                      00609   ; cargo los valores de la alarma analogica
0423   30E4           00610   movlw   ANALOG2_MAXH
0424   0084           00611   movwf   FSR
0425   0800           00612   movf    INDF,w      ; ANALOG2_MAXH
0426   00E8           00613   movwf   txdat4
0427   0A84           00614   incf    FSR,f
0428   0800           00615   movf    INDF,w      ; ANALOG2_MAXL
0429   00E9           00616   movwf   txdat5
042A   0A84           00617   incf    FSR,f
042B   0800           00618   movf    INDF,w      ; ANALOG2_MINH
042C   00EA           00619   movwf   txdat6
042D   0A84           00620   incf    FSR,f
042E   0800           00621   movf    INDF,w      ; ANALOG2_MINL
042F   00EB           00622   movwf   txdat7
0430   1CF9           00623   btfss   AN2_UMBRAL
0431   3030           00624   movlw   '0'
0432   18F9           00625   btfsc   AN2_UMBRAL
0433   3031           00626   movlw   '1'
0434   00EC           00627   movwf   txdat8
0435   2???           00628   goto    FcnQ8Fin
0436                  00629 FcnQ8e3
                      00630   ; cargo los valores de la entrada analogica
0436   0843           00631   movf    ANALOG3H,w
0437   00E6           00632   movwf   txdat2
0438   0844           00633   movf    ANALOG3L,w
0439   00E7           00634   movwf   txdat3
                      00635   ; cargo los valores de la alarma analogica
043A   30E8           00636   movlw   ANALOG3_MAXH
043B   0084           00637   movwf   FSR
043C   0800           00638   movf    INDF,w      ; ANALOG3_MAXH
043D   00E8           00639   movwf   txdat4
043E   0A84           00640   incf    FSR,f
043F   0800           00641   movf    INDF,w      ; ANALOG3_MAXL
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 87


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0440   00E9           00642   movwf   txdat5
0441   0A84           00643   incf    FSR,f
0442   0800           00644   movf    INDF,w      ; ANALOG3_MINH
0443   00EA           00645   movwf   txdat6
0444   0A84           00646   incf    FSR,f
0445   0800           00647   movf    INDF,w      ; ANALOG3_MINL
0446   00EB           00648   movwf   txdat7
0447   1D79           00649   btfss   AN3_UMBRAL
0448   3030           00650   movlw   '0'
0449   1979           00651   btfsc   AN3_UMBRAL
044A   3031           00652   movlw   '1'
044B   00EC           00653   movwf   txdat8
044C   2???           00654   goto    FcnQ8Fin
044D                  00655 FcnQ8e4
                      00656   ; cargo los valores de la entrada analogica
044D   0845           00657   movf    ANALOG4H,w
044E   00E6           00658   movwf   txdat2
044F   0846           00659   movf    ANALOG4L,w
0450   00E7           00660   movwf   txdat3
                      00661   ; cargo los valores de la alarma analogica
0451   30EC           00662   movlw   ANALOG4_MAXH
0452   0084           00663   movwf   FSR
0453   0800           00664   movf    INDF,w      ; ANALOG4_MAXH
0454   00E8           00665   movwf   txdat4
0455   0A84           00666   incf    FSR,f
0456   0800           00667   movf    INDF,w      ; ANALOG4_MAXL
0457   00E9           00668   movwf   txdat5
0458   0A84           00669   incf    FSR,f
0459   0800           00670   movf    INDF,w      ; ANALOG4_MINH
045A   00EA           00671   movwf   txdat6
045B   0A84           00672   incf    FSR,f
045C   0800           00673   movf    INDF,w      ; ANALOG4_MINL
045D   00EB           00674   movwf   txdat7
045E   1DF9           00675   btfss   AN4_UMBRAL
045F   3030           00676   movlw   '0'
0460   19F9           00677   btfsc   AN4_UMBRAL
0461   3031           00678   movlw   '1'
0462   00EC           00679   movwf   txdat8
0463                  00680 FcnQ8Fin
                      00681   ; le agrego la configuracion de la mascara de notificacion
                      00682  ERRORLEVEL -302
0463   1683           00683   bsf     STATUS,RP0    ; --> BANK1
0464   0844           00684   movf    MaskNotifAN,w
0465   1283           00685   bcf     STATUS,RP0    ; --> BANK0
                      00686  ERRORLEVEL +302
0466   00ED           00687   movwf   txdat9
                      00688   ; le agrego la configuracion de seguidores
0467   0878           00689   movf    Mascara_ANS2,w
0468   00EE           00690   movwf   txdat10
0469   2???           00691   goto    FcnQOk
                      00692 ; ----------------------------------------------------------------------------
                      00693 ; FcnQL - SETADDR
                      00694 ; ----------------------------------------------------------------------------
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 88


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

046A                  00695 FcnQL
                      00696   ; si es duplicada contesto sin hacer nada
046A   1BFF           00697   btfsc   DUPMSG
046B   2???           00698   goto    FcnQOk
                      00699   ; actualizo la direccion local
046C   0855           00700   movf    rxdat1,w
046D   00F1           00701   movwf   LocAddr
                      00702   ; listo, grabo en EE en 5 segundos
046E   3005           00703   movlw   0x05
046F   00B3           00704   movwf   SaveEECount
                      00705   ; cargo el timer para el reset
0470   300A           00706   movlw   0x0A         ; 10 segundos
0471   00B4           00707   movwf   ResetCount
                      00708   ; contesto Ok generico
0472   2???           00709   goto    FcnQOk
                      00710 ; ----------------------------------------------------------------------------
                      00711 ; FcnQT - SETDATETIME
                      00712 ; ----------------------------------------------------------------------------
0473                  00713 FcnQT
                      00714   ; si es duplicada contesto sin hacer nada
0473   1BFF           00715   btfsc   DUPMSG
0474   2???           00716   goto    FcnQOk
                      00717   ; actualizo la hora
0475   0855           00718   movf    rxdat1,w
                      00719  ERRORLEVEL -302
0476   1683           00720   bsf     STATUS,RP0    ; --> BANK1
0477   00C5           00721   movwf   LocHora
0478   1283           00722   bcf     STATUS,RP0    ; --> BANK0
                      00723  ERRORLEVEL +302
0479   0856           00724   movf    rxdat2,w
                      00725  ERRORLEVEL -302
047A   1683           00726   bsf     STATUS,RP0    ; --> BANK1
047B   00C6           00727   movwf   LocMin
047C   1283           00728   bcf     STATUS,RP0    ; --> BANK0
                      00729  ERRORLEVEL +302
047D   0857           00730   movf    rxdat3,w
                      00731  ERRORLEVEL -302
047E   1683           00732   bsf     STATUS,RP0    ; --> BANK1
047F   00C7           00733   movwf   LocSeg
0480   1283           00734   bcf     STATUS,RP0    ; --> BANK0
                      00735  ERRORLEVEL +302
0481   0858           00736   movf    rxdat4,w
                      00737  ERRORLEVEL -302
0482   1683           00738   bsf     STATUS,RP0    ; --> BANK1
0483   00C8           00739   movwf   LocDia
0484   1283           00740   bcf     STATUS,RP0    ; --> BANK0
                      00741  ERRORLEVEL +302
0485   0859           00742   movf    rxdat5,w
                      00743  ERRORLEVEL -302
0486   1683           00744   bsf     STATUS,RP0    ; --> BANK1
0487   00C9           00745   movwf   LocFecha
0488   1283           00746   bcf     STATUS,RP0    ; --> BANK0
                      00747  ERRORLEVEL +302
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 89


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0489   085A           00748   movf    rxdat6,w
                      00749  ERRORLEVEL -302
048A   1683           00750   bsf     STATUS,RP0    ; --> BANK1
048B   00CA           00751   movwf   LocMes
048C   1283           00752   bcf     STATUS,RP0    ; --> BANK0
                      00753  ERRORLEVEL +302
048D   085B           00754   movf    rxdat7,w
                      00755  ERRORLEVEL -302
048E   1683           00756   bsf     STATUS,RP0    ; --> BANK1
048F   00CB           00757   movwf   LocAnio
0490   1283           00758   bcf     STATUS,RP0    ; --> BANK0
                      00759  ERRORLEVEL +302
                      00760   ; para que actualice el display cuando pueda
0491   157B           00761   bsf     DISPLAY_DATA
0492   15FB           00762   bsf     DATE_OK
                      00763   ; contesto Ok generico
0493   2???           00764   goto    FcnQOk
                      00765 ; ----------------------------------------------------------------------------
                      00766 ; FcnQR - RESET
                      00767 ; ----------------------------------------------------------------------------
0494                  00768 FcnQR
                      00769   ; si es duplicada contesto sin hacer nada
0494   1BFF           00770   btfsc   DUPMSG
0495   2???           00771   goto    FcnQOk
                      00772   ; cargo el timer para el reset
0496   300A           00773   movlw   0x0A         ; 10 segundos
0497   00B4           00774   movwf   ResetCount
                      00775   ; contesto Ok generico
0498   2???           00776   goto    FcnQOk
                      00777 ; ----------------------------------------------------------------------------
                      00778 ; FcnQI - INVERT
                      00779 ; ----------------------------------------------------------------------------
0499                  00780 FcnQI
                      00781   ; si es duplicada contesto sin hacer nada
0499   1BFF           00782   btfsc   DUPMSG
049A   2???           00783   goto    FcnQOk
                      00784   ; limpio el error
049B   01A6           00785   clrf    ErrCde1
049C   1383           00786   bcf     STATUS,IRP ; pasa a banco 0/1 para direccionamiento indirecto
                      00787   ; me abro por nro de salida
                      00788   ; salida 1
049D   0855           00789   movf    rxdat1,w
049E   3C31           00790   sublw   '1'
049F   1903           00791   btfsc   STATUS,Z
04A0   2???           00792   goto    FcnQIs1
                      00793   ; salida 2
04A1   0855           00794   movf    rxdat1,w
04A2   3C32           00795   sublw   '2'
04A3   1903           00796   btfsc   STATUS,Z
04A4   2???           00797   goto    FcnQIs2
                      00798   ; si no es ninguna de las contempladas es un error
04A5   2???           00799   goto    FcnQError
04A6                  00800 FcnQIs1
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 90


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00801   ; cargo la direccion de la salida 1 en el registro de direccionamiento ind
04A6   3072           00802   movlw   SALIDA1
04A7   0084           00803   movwf   FSR
                      00804   ; levanto el flag de modificación
04A8   157E           00805   bsf     CAMBIO_S1
04A9   2???           00806   goto    FcnQIOper
04AA                  00807 FcnQIs2
                      00808   ; cargo la direccion de la salida 2 en el registro de direccionamiento ind
04AA   3073           00809   movlw   SALIDA2
04AB   0084           00810   movwf   FSR
                      00811   ; levanto el flag de modificación
04AC   15FE           00812   bsf     CAMBIO_S2
                      00813 ; goto    FcnQIOper
04AD                  00814 FcnQIOper
                      00815   ; voy incrementando ErrCde1 para que en caso
                      00816   ; de error pueda saber en qué etapa se produjo
04AD   0AA6           00817   incf    ErrCde1,f
                      00818   ; calculo bit a encender o apagar
04AE   3030           00819   movlw   '0'
04AF   0256           00820   subwf   rxdat2,w
04B0   00CA           00821   movwf   RegTmpG
                      00822   ; verifico que no sea mayor a 7
04B1   39F8           00823   andlw   0xF8
04B2   1D03           00824   btfss   STATUS,Z
04B3   2???           00825   goto    FcnQError
                      00826   ; voy incrementando ErrCde1 para que en caso
                      00827   ; de error pueda saber en qué etapa se produjo
04B4   0AA6           00828   incf    ErrCde1,f
04B5   084A           00829   movf    RegTmpG,w
04B6   2???           00830   call    SetWBitW
04B7   0680           00831   xorwf   INDF,f      ; invierto el bit seleccionado
                      00832   ; listo, grabo en EE en 5 segundos
04B8   3005           00833   movlw   0x05
04B9   00B3           00834   movwf   SaveEECount
04BA   2???           00835   goto    FcnQOk
                      00836 ; ----------------------------------------------------------------------------
                      00837 ; FcnQB - BAUDRATE
                      00838 ; ----------------------------------------------------------------------------
04BB                  00839 FcnQB
                      00840   ; si es duplicada contesto sin hacer nada
04BB   1BFF           00841   btfsc   DUPMSG
04BC   2???           00842   goto    FcnQOk
                      00843   ; actualizo el Baudrate (se activa al resetear)
04BD   0855           00844   movf    rxdat1,w
04BE   00FA           00845   movwf   BaudRate
                      00846   ; listo, grabo en EE en 5 segundos
04BF   3005           00847   movlw   0x05
04C0   00B3           00848   movwf   SaveEECount
                      00849   ; cargo el timer para el reset
04C1   300A           00850   movlw   0x0A         ; 10 segundos
04C2   00B4           00851   movwf   ResetCount
                      00852   ; contesto Ok generico
04C3   2???           00853   goto    FcnQOk
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 91


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00854 ; ----------------------------------------------------------------------------
                      00855 ; FcnQA - Alarmas A/D
                      00856 ; ----------------------------------------------------------------------------
04C4                  00857 FcnQA
                      00858   ; si es duplicada contesto sin hacer nada
04C4   1BFF           00859   btfsc   DUPMSG
04C5   2???           00860   goto    FcnQOk
                      00861   ; limpio el error
04C6   01A6           00862   clrf    ErrCde1
04C7   1383           00863   bcf     STATUS,IRP ; pasa a banco 0/1 para direccionamiento indirecto
                      00864   ; me abro por nro de salida
04C8   0855           00865   movf    rxdat1,w
04C9   3C31           00866   sublw   '1'
04CA   1903           00867   btfsc   STATUS,Z
04CB   2???           00868   goto    FcnQA1
04CC   0855           00869   movf    rxdat1,w
04CD   3C32           00870   sublw   '2'
04CE   1903           00871   btfsc   STATUS,Z
04CF   2???           00872   goto    FcnQA2
04D0   0855           00873   movf    rxdat1,w
04D1   3C33           00874   sublw   '3'
04D2   1903           00875   btfsc   STATUS,Z
04D3   2???           00876   goto    FcnQA3
04D4   0855           00877   movf    rxdat1,w
04D5   3C34           00878   sublw   '4'
04D6   1903           00879   btfsc   STATUS,Z
04D7   2???           00880   goto    FcnQA4
                      00881   ; si no está entre 1 y 5 está mal
04D8   2???           00882   goto    FcnQError
                      00883 ; -----------------------
04D9                  00884 FcnQA1
04D9   30E0           00885   movlw   ANALOG1_MAXH
04DA   0084           00886   movwf   FSR
04DB   2???           00887   goto    FcnQASet
04DC                  00888 FcnQA2
04DC   30E4           00889   movlw   ANALOG2_MAXH
04DD   0084           00890   movwf   FSR
04DE   2???           00891   goto    FcnQASet
04DF                  00892 FcnQA3
04DF   30E8           00893   movlw   ANALOG3_MAXH
04E0   0084           00894   movwf   FSR
04E1   2???           00895   goto    FcnQASet
04E2                  00896 FcnQA4
04E2   30EC           00897   movlw   ANALOG4_MAXH
04E3   0084           00898   movwf   FSR
04E4   2???           00899   goto    FcnQASet
                      00900 ; -----------------------
04E5                  00901 FcnQASet
04E5   0856           00902   movf    rxdat2,w
04E6   0080           00903   movwf   INDF
04E7   0A84           00904   incf    FSR,f
04E8   0857           00905   movf    rxdat3,w
04E9   0080           00906   movwf   INDF
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 92


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

04EA   0A84           00907   incf    FSR,f
04EB   0858           00908   movf    rxdat4,w
04EC   0080           00909   movwf   INDF
04ED   0A84           00910   incf    FSR,f
04EE   0859           00911   movf    rxdat5,w
04EF   0080           00912   movwf   INDF
                      00913   ; listo, grabo en EE en 5 segundos
04F0   3005           00914   movlw   0x05
04F1   00B3           00915   movwf   SaveEECount
04F2   2???           00916   goto    FcnQOk
                      00917 ; ----------------------------------------------------------------------------
                      00918 ; FcnQF - Seguidores
                      00919 ; ----------------------------------------------------------------------------
04F3                  00920 FcnQF
                      00921   ; si es duplicada contesto sin hacer nada
04F3   1BFF           00922   btfsc   DUPMSG
04F4   2???           00923   goto    FcnQOk
                      00924   ; limpio el error
04F5   01A6           00925   clrf    ErrCde1
                      00926   ; me abro por nro de entrada
                      00927   ; entrada 1
04F6   0855           00928   movf    rxdat1,w
04F7   3C31           00929   sublw   '1'
04F8   1903           00930   btfsc   STATUS,Z
04F9   2???           00931   goto    FcnQFe1
                      00932   ; entrada 2
04FA   0855           00933   movf    rxdat1,w
04FB   3C32           00934   sublw   '2'
04FC   1903           00935   btfsc   STATUS,Z
04FD   2???           00936   goto    FcnQFe2
                      00937   ; entrada analogica
04FE   0855           00938   movf    rxdat1,w
04FF   3C41           00939   sublw   'A'
0500   1903           00940   btfsc   STATUS,Z
0501   2???           00941   goto    FcnQFeA
                      00942   ; si no es ninguna de las contempladas es un error
0502   2???           00943   goto    FcnQError
0503                  00944 FcnQFe1
                      00945   ; muevo el dato a a mascara
0503   0856           00946   movf    rxdat2,w
0504   00F6           00947   movwf   Mascara_E1S1
0505   147E           00948   bsf     CAMBIO_E1
0506   2???           00949   goto    FcnQFEnd
0507                  00950 FcnQFe2
                      00951   ; muevo el dato a a mascara
0507   0856           00952   movf    rxdat2,w
0508   00F7           00953   movwf   Mascara_E2S2
0509   14FE           00954   bsf     CAMBIO_E2
050A   2???           00955   goto    FcnQFEnd
050B                  00956 FcnQFeA
                      00957   ; muevo el dato a a mascara
050B   0856           00958   movf    rxdat2,w
050C   390F           00959   andlw   0x0F        ; para analogicos solamente los primeros 4 bits
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 93


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

050D   00F8           00960   movwf   Mascara_ANS2
050E   167E           00961   bsf     CAMBIO_AN
                      00962 ;  goto    FcnQFEnd
050F                  00963 FcnQFEnd
                      00964   ; listo, grabo en EE en 5 segundos
050F   3005           00965   movlw   0x05
0510   00B3           00966   movwf   SaveEECount
0511   2???           00967   goto    FcnQOk
                      00968 ; ----------------------------------------------------------------------------
                      00969 ; FcnQO - Mascara de notificación
                      00970 ; ----------------------------------------------------------------------------
0512                  00971 FcnQO
                      00972   ; si es duplicada contesto sin hacer nada
0512   1BFF           00973   btfsc   DUPMSG
0513   2???           00974   goto    FcnQOk
                      00975   ; limpio el error
0514   01A6           00976   clrf    ErrCde1
                      00977   ; me abro por nro de entrada
                      00978   ; entrada 1
0515   0855           00979   movf    rxdat1,w
0516   3C31           00980   sublw   '1'
0517   1903           00981   btfsc   STATUS,Z
0518   2???           00982   goto    FcnQOe1
                      00983   ; entrada 2
0519   0855           00984   movf    rxdat1,w
051A   3C32           00985   sublw   '2'
051B   1903           00986   btfsc   STATUS,Z
051C   2???           00987   goto    FcnQOe2
                      00988   ; salida 1
051D   0855           00989   movf    rxdat1,w
051E   3C33           00990   sublw   '3'
051F   1903           00991   btfsc   STATUS,Z
0520   2???           00992   goto    FcnQOs1
                      00993   ; salida 2
0521   0855           00994   movf    rxdat1,w
0522   3C34           00995   sublw   '4'
0523   1903           00996   btfsc   STATUS,Z
0524   2???           00997   goto    FcnQOs2
                      00998   ; entrada analogica
0525   0855           00999   movf    rxdat1,w
0526   3C41           01000   sublw   'A'
0527   1903           01001   btfsc   STATUS,Z
0528   2???           01002   goto    FcnQOeA
                      01003   ; si no es ninguna de las contempladas es un error
0529   2???           01004   goto    FcnQError
052A                  01005 FcnQOe1
                      01006   ; muevo el dato a a mascara
052A   0856           01007   movf    rxdat2,w
                      01008  ERRORLEVEL -302
052B   1683           01009   bsf     STATUS,RP0    ; --> BANK1
052C   00C0           01010   movwf   MaskNotifE1
052D   1283           01011   bcf     STATUS,RP0    ; --> BANK0
                      01012  ERRORLEVEL +302
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 94


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

052E   2???           01013   goto    FcnQOEnd
052F                  01014 FcnQOe2
                      01015   ; muevo el dato a a mascara
052F   0856           01016   movf    rxdat2,w
                      01017  ERRORLEVEL -302
0530   1683           01018   bsf     STATUS,RP0    ; --> BANK1
0531   00C1           01019   movwf   MaskNotifE2
0532   1283           01020   bcf     STATUS,RP0    ; --> BANK0
                      01021  ERRORLEVEL +302
0533   2???           01022   goto    FcnQOEnd
0534                  01023 FcnQOs1
                      01024   ; muevo el dato a a mascara
0534   0856           01025   movf    rxdat2,w
                      01026  ERRORLEVEL -302
0535   1683           01027   bsf     STATUS,RP0    ; --> BANK1
0536   00C2           01028   movwf   MaskNotifS1
0537   1283           01029   bcf     STATUS,RP0    ; --> BANK0
                      01030  ERRORLEVEL +302
0538   2???           01031   goto    FcnQOEnd
0539                  01032 FcnQOs2
                      01033   ; muevo el dato a a mascara
0539   0856           01034   movf    rxdat2,w
                      01035  ERRORLEVEL -302
053A   1683           01036   bsf     STATUS,RP0    ; --> BANK1
053B   00C3           01037   movwf   MaskNotifS2
053C   1283           01038   bcf     STATUS,RP0    ; --> BANK0
                      01039  ERRORLEVEL +302
053D   2???           01040   goto    FcnQOEnd
053E                  01041 FcnQOeA
                      01042   ; muevo el dato a a mascara
053E   0856           01043   movf    rxdat2,w
053F   390F           01044   andlw   0x0F        ; para analogicos solamente los primeros 4 bits
                      01045  ERRORLEVEL -302
0540   1683           01046   bsf     STATUS,RP0    ; --> BANK1
0541   00C4           01047   movwf   MaskNotifAN
0542   1283           01048   bcf     STATUS,RP0    ; --> BANK0
                      01049  ERRORLEVEL +302
                      01050 ;  goto    FcnQOEnd
0543                  01051 FcnQOEnd
                      01052   ; listo, grabo en EE en 5 segundos
0543   3005           01053   movlw   0x05
0544   00B3           01054   movwf   SaveEECount
0545   2???           01055   goto    FcnQOk
                      01056 ; ----------------------------------------------------------------------------
                      01057 ; FcnQC - Produce beeps por el buzzer on-board
                      01058 ; ----------------------------------------------------------------------------
0546                  01059 FcnQC
                      01060   ; si es duplicada contesto sin hacer nada
0546   1BFF           01061   btfsc   DUPMSG
0547   2???           01062   goto    FcnQOk
                      01063   ; si el primer parametro es cero es un beep largo
                      01064   ; si es mayor es la cantidad de beeps cortos
0548   3030           01065   movlw   '0'
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 95


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0549   0255           01066   subwf   rxdat1,w
054A   1903           01067   btfsc   STATUS,Z
054B   2???           01068   goto    FcnQC_LongBeep
054C   2???           01069   call    NumBeep       ; en W ya esta la cantidad de beeps
054D   2???           01070   goto    FcnQOk
054E                  01071 FcnQC_LongBeep
054E   2???           01072   call    LongBeep
054F   2???           01073   goto    FcnQOk
                      01074 
                      01075 ; ----------------------------------------------------------------------------
                      01076 ; >> Mensajes en el display
                      01077 ;    DDDDDDDDDDEEEEEEEEEE
                      01078 ;    GGGGGGGGGGHHHHHHHHHH
                      01079 ;    JJJJJJJJJJKKKKKKKKKK
                      01080 ;    MMMMMMMMMMNNNNNNNNNN
                      01081 ; ----------------------------------------------------------------------------
                      01082 ; FcnQD - Mueve lo recibido a la primera mitad de la linea 1 del LCD
                      01083 ; ----------------------------------------------------------------------------
0550                  01084 FcnQD
                      01085   ; Si el display no está es un error
0550   01A6           01086   clrf    ErrCde1
0551   1C7B           01087   btfss   DISPLAY_OK
0552   2???           01088   goto    FcnQError
                      01089   ; si es duplicada contesto sin hacer nada
0553   1BFF           01090   btfsc   DUPMSG
0554   2???           01091   goto    FcnQOk
                      01092  ERRORLEVEL -306
0555   ???? ????      01093   PAGESEL LCD_LINE1
0557   2???           01094   call    LCD_LINE1
0558   2???           01095   call    RxBuffer2LCD
0559   ???? ????      01096   PAGESEL $
                      01097  ERRORLEVEL +306
055B   2???           01098   goto    FcnQOk
                      01099 ; ----------------------------------------------------------------------------
                      01100 ; FcnQE - Mueve lo recibido a la segunda mitad de la linea 1 del LCD
                      01101 ; ----------------------------------------------------------------------------
055C                  01102 FcnQE
                      01103   ; Si el display no está es un error
055C   01A6           01104   clrf    ErrCde1
055D   1C7B           01105   btfss   DISPLAY_OK
055E   2???           01106   goto    FcnQError
                      01107   ; si es duplicada contesto sin hacer nada
055F   1BFF           01108   btfsc   DUPMSG
0560   2???           01109   goto    FcnQOk
                      01110  ERRORLEVEL -306
0561   ???? ????      01111   PAGESEL LCD_LINE1R
0563   2???           01112   call    LCD_LINE1R
0564   2???           01113   call    RxBuffer2LCD
0565   ???? ????      01114   PAGESEL $
                      01115  ERRORLEVEL +306
0567   2???           01116   goto    FcnQOk
                      01117 ; ----------------------------------------------------------------------------
                      01118 ; FcnQG - Mueve lo recibido a la primera mitad de la linea 2 del LCD
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 96


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01119 ; ----------------------------------------------------------------------------
0568                  01120 FcnQG
                      01121   ; Si el display no está es un error
0568   01A6           01122   clrf    ErrCde1
0569   1C7B           01123   btfss   DISPLAY_OK
056A   2???           01124   goto    FcnQError
                      01125   ; si es duplicada contesto sin hacer nada
056B   1BFF           01126   btfsc   DUPMSG
056C   2???           01127   goto    FcnQOk
                      01128  ERRORLEVEL -306
056D   ???? ????      01129   PAGESEL LCD_LINE2
056F   2???           01130   call    LCD_LINE2
0570   2???           01131   call    RxBuffer2LCD
0571   ???? ????      01132   PAGESEL $
                      01133  ERRORLEVEL +306
0573   2???           01134   goto    FcnQOk
                      01135 ; ----------------------------------------------------------------------------
                      01136 ; FcnQH - Mueve lo recibido a la segunda mitad de la linea 2 del LCD
                      01137 ; ----------------------------------------------------------------------------
0574                  01138 FcnQH
                      01139   ; Si el display no está es un error
0574   01A6           01140   clrf    ErrCde1
0575   1C7B           01141   btfss   DISPLAY_OK
0576   2???           01142   goto    FcnQError
                      01143   ; si es duplicada contesto sin hacer nada
0577   1BFF           01144   btfsc   DUPMSG
0578   2???           01145   goto    FcnQOk
                      01146  ERRORLEVEL -306
0579   ???? ????      01147   PAGESEL LCD_LINE2R
057B   2???           01148   call    LCD_LINE2R
057C   2???           01149   call    RxBuffer2LCD
057D   ???? ????      01150   PAGESEL $
                      01151  ERRORLEVEL +306
057F   2???           01152   goto    FcnQOk
                      01153 ; ----------------------------------------------------------------------------
                      01154 ; FcnQJ - Mueve lo recibido a la primera mitad de la linea 3 del LCD
                      01155 ; ----------------------------------------------------------------------------
0580                  01156 FcnQJ
                      01157   ; Si el display no está es un error
0580   01A6           01158   clrf    ErrCde1
0581   1C7B           01159   btfss   DISPLAY_OK
0582   2???           01160   goto    FcnQError
                      01161   ; si es duplicada contesto sin hacer nada
0583   1BFF           01162   btfsc   DUPMSG
0584   2???           01163   goto    FcnQOk
                      01164  ERRORLEVEL -306
0585   ???? ????      01165   PAGESEL LCD_LINE3
0587   2???           01166   call    LCD_LINE3
0588   2???           01167   call    RxBuffer2LCD
0589   ???? ????      01168   PAGESEL $
                      01169  ERRORLEVEL +306
058B   2???           01170   goto    FcnQOk
                      01171 ; ----------------------------------------------------------------------------
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 97


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01172 ; FcnQK - Mueve lo recibido a la segunda mitad de la linea 3 del LCD
                      01173 ; ----------------------------------------------------------------------------
058C                  01174 FcnQK
                      01175   ; Si el display no está es un error
058C   01A6           01176   clrf    ErrCde1
058D   1C7B           01177   btfss   DISPLAY_OK
058E   2???           01178   goto    FcnQError
                      01179   ; si es duplicada contesto sin hacer nada
058F   1BFF           01180   btfsc   DUPMSG
0590   2???           01181   goto    FcnQOk
                      01182  ERRORLEVEL -306
0591   ???? ????      01183   PAGESEL LCD_LINE3R
0593   2???           01184   call    LCD_LINE3R
0594   2???           01185   call    RxBuffer2LCD
0595   ???? ????      01186   PAGESEL $
                      01187  ERRORLEVEL +306
0597   2???           01188   goto    FcnQOk
                      01189 ; ----------------------------------------------------------------------------
                      01190 ; FcnQM - Mueve lo recibido a la primera mitad de la linea 4 del LCD
                      01191 ; ----------------------------------------------------------------------------
0598                  01192 FcnQM
                      01193   ; Si el display no está es un error
0598   01A6           01194   clrf    ErrCde1
0599   1C7B           01195   btfss   DISPLAY_OK
059A   2???           01196   goto    FcnQError
                      01197   ; si es duplicada contesto sin hacer nada
059B   1BFF           01198   btfsc   DUPMSG
059C   2???           01199   goto    FcnQOk
                      01200  ERRORLEVEL -306
059D   ???? ????      01201   PAGESEL LCD_LINE4
059F   2???           01202   call    LCD_LINE4
05A0   2???           01203   call    RxBuffer2LCD
05A1   ???? ????      01204   PAGESEL $
                      01205  ERRORLEVEL +306
05A3   2???           01206   goto    FcnQOk
                      01207 ; ----------------------------------------------------------------------------
                      01208 ; FcnQN - Mueve lo recibido a la segunda mitad de la linea 4 del LCD
                      01209 ; ----------------------------------------------------------------------------
05A4                  01210 FcnQN
                      01211   ; Si el display no está es un error
05A4   01A6           01212   clrf    ErrCde1
05A5   1C7B           01213   btfss   DISPLAY_OK
05A6   2???           01214   goto    FcnQError
                      01215   ; si es duplicada contesto sin hacer nada
05A7   1BFF           01216   btfsc   DUPMSG
05A8   2???           01217   goto    FcnQOk
                      01218  ERRORLEVEL -306
05A9   ???? ????      01219   PAGESEL LCD_LINE4R
05AB   2???           01220   call    LCD_LINE4R
05AC   2???           01221   call    RxBuffer2LCD
05AD   ???? ????      01222   PAGESEL $
                      01223  ERRORLEVEL +306
05AF   2???           01224   goto    FcnQOk
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 98


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01225 ; ----------------------------------------------------------------------------
                      01226 ; FcnQQ - Display config
                      01227 ; ----------------------------------------------------------------------------
05B0                  01228 FcnQQ
                      01229   ; si es duplicada contesto sin hacer nada
05B0   1BFF           01230   btfsc   DUPMSG
05B1   2???           01231   goto    FcnQOk
                      01232   ; habilitacion del display
05B2   3030           01233   movlw   '0'
05B3   0255           01234   subwf   rxdat1,w
05B4   1903           01235   btfsc   STATUS,Z
05B5   107B           01236   bcf     DISPLAY_OK
05B6   1D03           01237   btfss   STATUS,Z
05B7   147B           01238   bsf     DISPLAY_OK
                      01239   ; etc.
                      01240 
                      01241 
                      01242   ; listo, grabo en EE en 5 segundos
05B8   3005           01243   movlw   0x05
05B9   00B3           01244   movwf   SaveEECount
                      01245   ; contesto Ok generico
05BA   2???           01246   goto    FcnQOk
                      01247 ; ============================================================================
                      01248 ; ============================================================================
                      01249 ; Tratamiento de respuestas
                      01250 ; ----------------------------------------------------------------------------
                      01251 ; FcnRP - Ping
                      01252 ; ----------------------------------------------------------------------------
05BB                  01253 FcnRP
                      01254   ; es una respuesta
                      01255   ; el host está (LOGGED-ON)
05BB   187F           01256   btfsc   HSTONLINE
05BC   0008           01257   return
                      01258   ; tres pitidos
05BD   2???           01259   call    Short3Beep
                      01260   ; flag logged-on
05BE   147F           01261   bsf     HSTONLINE
                      01262   ; cambio la pantalla para que muestre la Screen1 (fecha/hora)
05BF   3001           01263   movlw   0x01
05C0   00FC           01264   movwf   ScrnId
05C1   157B           01265   bsf     DISPLAY_DATA
05C2   0008           01266   return
                      01267 ; ----------------------------------------------------------------------------
                      01268 ; FcnR6 - INFO-IN
                      01269 ; ----------------------------------------------------------------------------
05C3                  01270 FcnR6
                      01271   ; me abro por nro de entrada
05C3   0855           01272   movf    rxdat1,w
05C4   3C31           01273   sublw   '1'
05C5   1903           01274   btfsc   STATUS,Z
05C6   2???           01275   goto    FcnR6e1
05C7   0855           01276   movf    rxdat1,w
05C8   3C32           01277   sublw   '2'
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 99


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05C9   1903           01278   btfsc   STATUS,Z
05CA   2???           01279   goto    FcnR6e2
05CB   0008           01280   return
05CC                  01281 FcnR6e1
05CC   01B7           01282   clrf    CountNotifE1
                      01283   ; comparo los datos de la respuesta con el estado actual de la entrada
05CD   0856           01284   movf    rxdat2,w
05CE   0274           01285   subwf   ENTRADA1,w
05CF   1903           01286   btfsc   STATUS,Z
05D0   0008           01287   return
                      01288   ; si hay diferencia notifico de nuevo
05D1   300A           01289   movlw   REINTENTOS
05D2   00B7           01290   movwf   CountNotifE1
05D3   0008           01291   return
05D4                  01292 FcnR6e2
05D4   01B8           01293   clrf    CountNotifE2
                      01294   ; comparo los datos de la respuesta con el estado actual de la entrada
05D5   0856           01295   movf    rxdat2,w
05D6   0275           01296   subwf   ENTRADA2,w
05D7   1903           01297   btfsc   STATUS,Z
05D8   0008           01298   return
                      01299   ; si hay diferencia notifico de nuevo
05D9   300A           01300   movlw   REINTENTOS
05DA   00B8           01301   movwf   CountNotifE2
05DB   0008           01302   return
                      01303 ; ----------------------------------------------------------------------------
                      01304 ; FcnR7 - INFO-OUT
                      01305 ; ----------------------------------------------------------------------------
05DC                  01306 FcnR7
                      01307   ; me abro por nro de salida
05DC   0855           01308   movf    rxdat1,w
05DD   3C31           01309   sublw   '1'
05DE   1903           01310   btfsc   STATUS,Z
05DF   2???           01311   goto    FcnR7s1
05E0   0855           01312   movf    rxdat1,w
05E1   3C32           01313   sublw   '2'
05E2   1903           01314   btfsc   STATUS,Z
05E3   2???           01315   goto    FcnR7s2
05E4   0008           01316   return
05E5                  01317 FcnR7s1
05E5   01BD           01318   clrf    CountNotifS1
                      01319   ; comparo los datos de la respuesta con el estado actual de la entrada
05E6   0856           01320   movf    rxdat2,w
05E7   0272           01321   subwf   SALIDA1,w
05E8   1903           01322   btfsc   STATUS,Z
05E9   0008           01323   return
                      01324   ; si hay diferencia notifico de nuevo
05EA   300A           01325   movlw   REINTENTOS
05EB   00BD           01326   movwf   CountNotifS1
05EC   0008           01327   return
05ED                  01328 FcnR7s2
05ED   01BE           01329   clrf    CountNotifS2
                      01330   ; comparo los datos de la respuesta con el estado actual de la entrada
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 100


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

05EE   0856           01331   movf    rxdat2,w
05EF   0273           01332   subwf   SALIDA2,w
05F0   1903           01333   btfsc   STATUS,Z
05F1   0008           01334   return
                      01335   ; si hay diferencia notifico de nuevo
05F2   300A           01336   movlw   REINTENTOS
05F3   00BE           01337   movwf   CountNotifS2
05F4   0008           01338   return
                      01339 ; ----------------------------------------------------------------------------
                      01340 ; FcnR9 - NOTIF ANALOG
                      01341 ; ----------------------------------------------------------------------------
05F5                  01342 FcnR9
                      01343   ; me abro por nro de entrada
05F5   0855           01344   movf    rxdat1,w
05F6   3C31           01345   sublw   '1'
05F7   1903           01346   btfsc   STATUS,Z
05F8   2???           01347   goto    FcnR9a1
05F9   0855           01348   movf    rxdat1,w
05FA   3C32           01349   sublw   '2'
05FB   1903           01350   btfsc   STATUS,Z
05FC   2???           01351   goto    FcnR9a2
05FD   0855           01352   movf    rxdat1,w
05FE   3C33           01353   sublw   '3'
05FF   1903           01354   btfsc   STATUS,Z
0600   2???           01355   goto    FcnR9a3
0601   0855           01356   movf    rxdat1,w
0602   3C34           01357   sublw   '4'
0603   1903           01358   btfsc   STATUS,Z
0604   2???           01359   goto    FcnR9a4
0605   0008           01360   return
0606                  01361 FcnR9a1
0606   01B9           01362   clrf    CountNotifA1
                      01363   ; comparo los datos de la respuesta con el estado actual de la alarma
0607   1C79           01364   btfss   AN1_UMBRAL
0608   3030           01365   movlw   '0'
0609   1879           01366   btfsc   AN1_UMBRAL
060A   3031           01367   movlw   '1'
060B   0256           01368   subwf   rxdat2,w
060C   1903           01369   btfsc   STATUS,Z
060D   0008           01370   return
                      01371   ; si hay diferencia notifico de nuevo
060E   300A           01372   movlw   REINTENTOS
060F   00B9           01373   movwf   CountNotifA1
0610   0008           01374   return
0611                  01375 FcnR9a2
0611   01BA           01376   clrf    CountNotifA2
                      01377   ; comparo los datos de la respuesta con el estado actual de la alarma
0612   1CF9           01378   btfss   AN2_UMBRAL
0613   3030           01379   movlw   '0'
0614   18F9           01380   btfsc   AN2_UMBRAL
0615   3031           01381   movlw   '1'
0616   0256           01382   subwf   rxdat2,w
0617   1903           01383   btfsc   STATUS,Z
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 101


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0618   0008           01384   return
                      01385   ; si hay diferencia notifico de nuevo
0619   300A           01386   movlw   REINTENTOS
061A   00BA           01387   movwf   CountNotifA2
061B   0008           01388   return
061C                  01389 FcnR9a3
061C   01BB           01390   clrf    CountNotifA3
                      01391   ; comparo los datos de la respuesta con el estado actual de la alarma
061D   1D79           01392   btfss   AN3_UMBRAL
061E   3030           01393   movlw   '0'
061F   1979           01394   btfsc   AN3_UMBRAL
0620   3031           01395   movlw   '1'
0621   0256           01396   subwf   rxdat2,w
0622   1903           01397   btfsc   STATUS,Z
0623   0008           01398   return
                      01399   ; si hay diferencia notifico de nuevo
0624   300A           01400   movlw   REINTENTOS
0625   00BB           01401   movwf   CountNotifA3
0626   0008           01402   return
0627                  01403 FcnR9a4
0627   01BC           01404   clrf    CountNotifA4
                      01405   ; comparo los datos de la respuesta con el estado actual de la alarma
0628   1DF9           01406   btfss   AN4_UMBRAL
0629   3030           01407   movlw   '0'
062A   19F9           01408   btfsc   AN4_UMBRAL
062B   3031           01409   movlw   '1'
062C   0256           01410   subwf   rxdat2,w
062D   1903           01411   btfsc   STATUS,Z
062E   0008           01412   return
                      01413   ; si hay diferencia notifico de nuevo
062F   300A           01414   movlw   REINTENTOS
0630   00BC           01415   movwf   CountNotifA4
0631   0008           01416   return
                      01417 ; ----------------------------------------------------------------------------
                      01418 ; FcnRT - SETDATETIME
                      01419 ; ----------------------------------------------------------------------------
0632                  01420 FcnRT
                      01421   ; actualizo la hora
0632   0855           01422   movf    rxdat1,w
                      01423  ERRORLEVEL -302
0633   1683           01424   bsf     STATUS,RP0    ; --> BANK1
0634   00C5           01425   movwf   LocHora
0635   1283           01426   bcf     STATUS,RP0    ; --> BANK0
                      01427  ERRORLEVEL +302
0636   0856           01428   movf    rxdat2,w
                      01429  ERRORLEVEL -302
0637   1683           01430   bsf     STATUS,RP0    ; --> BANK1
0638   00C6           01431   movwf   LocMin
0639   1283           01432   bcf     STATUS,RP0    ; --> BANK0
                      01433  ERRORLEVEL +302
063A   0857           01434   movf    rxdat3,w
                      01435  ERRORLEVEL -302
063B   1683           01436   bsf     STATUS,RP0    ; --> BANK1
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 102


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

063C   00C7           01437   movwf   LocSeg
063D   1283           01438   bcf     STATUS,RP0    ; --> BANK0
                      01439  ERRORLEVEL +302
063E   0858           01440   movf    rxdat4,w
                      01441  ERRORLEVEL -302
063F   1683           01442   bsf     STATUS,RP0    ; --> BANK1
0640   00C8           01443   movwf   LocDia
0641   1283           01444   bcf     STATUS,RP0    ; --> BANK0
                      01445  ERRORLEVEL +302
0642   0859           01446   movf    rxdat5,w
                      01447  ERRORLEVEL -302
0643   1683           01448   bsf     STATUS,RP0    ; --> BANK1
0644   00C9           01449   movwf   LocFecha
0645   1283           01450   bcf     STATUS,RP0    ; --> BANK0
                      01451  ERRORLEVEL +302
0646   085A           01452   movf    rxdat6,w
                      01453  ERRORLEVEL -302
0647   1683           01454   bsf     STATUS,RP0    ; --> BANK1
0648   00CA           01455   movwf   LocMes
0649   1283           01456   bcf     STATUS,RP0    ; --> BANK0
                      01457  ERRORLEVEL +302
064A   085B           01458   movf    rxdat7,w
                      01459  ERRORLEVEL -302
064B   1683           01460   bsf     STATUS,RP0    ; --> BANK1
064C   00CB           01461   movwf   LocAnio
064D   1283           01462   bcf     STATUS,RP0    ; --> BANK0
                      01463  ERRORLEVEL +302
                      01464   ; para que actualice el display cuando pueda
064E   157B           01465   bsf     DISPLAY_DATA
064F   15FB           01466   bsf     DATE_OK
0650   0008           01467   return
                      01468 ; ============================================================================
                      00248   include "eefunc.inc"
                      00001 ; ============================================================================
                      00002 ; ReadConf - Lee de EE y escribe las variables persistentes (0xE0..0xFF)
                      00003 ; ============================================================================
                      00004  ERRORLEVEL -302
0651                  00005 ReadConf
0651   1283           00006   bcf     STATUS,RP0          ;
0652   1703           00007   bsf     STATUS,RP1          ; --> BANK2
0653   018D           00008   clrf    EEADR               ; Address to read
0654   018F           00009   clrf    EEADRH
0655   1683           00010   bsf     STATUS,RP0          ; --> BANK3
0656   138C           00011   bcf     EECON1,EEPGD        ; Point to Data memory
                      00012   ; leo el primer byte
0657   140C           00013   bsf     EECON1,RD           ; EE Read
0658   1283           00014   bcf     STATUS,RP0          ; --> BANK2
0659   080C           00015   movf    EEDATA,w            ; EEDATA --> w
                      00016   ; comparo el primer byte con una mascara de 1s y 0s
                      00017   ; para ver si tiene datos válidos
065A   3CB8           00018   sublw   MARCA_EE_OK
065B   1D03           00019   btfss   STATUS,Z
065C   2???           00020   goto    ReadConfEnd         ; los datos en EE no son validos
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 103


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00021   ; sigo en BANK2
065D                  00022 ReadConfValid
065D   1383           00023   bcf     STATUS,IRP     ; pasa a banco 0/1 para direccionamiento indirecto
065E   30C0           00024   movlw   CONFIG_START   ; cargo la dirección de inicio de variables persistentes
065F   0084           00025   movwf   FSR
                      00026   ; sigo en BANK2
0660                  00027 ReadConfLoop
0660   0A8D           00028   incf    EEADR,f             ; Address to read
0661   1683           00029   bsf     STATUS,RP0          ; --> BANK3
0662   140C           00030   bsf     EECON1,RD           ; EE Read
0663   1283           00031   bcf     STATUS,RP0          ; --> BANK2
0664   080C           00032   movf    EEDATA,w            ; EEDATA --> w
0665   0080           00033   movwf   INDF                ; w --> (FSR->f)
0666   0F84           00034   incfsz  FSR,f               ; recorro hasta el overflow del FSR (cuando excede 0xFF)
0667   2???           00035   goto    ReadConfLoop
0668                  00036 ReadConfEnd
0668   1283           00037   bcf     STATUS,RP0
0669   1303           00038   bcf     STATUS,RP1 ; --> BANK0
066A   0008           00039   return
                      00040  ERRORLEVEL +302
                      00041 ; ============================================================================
                      00042 ; WriteConf - escribe en EE las variables persistentes (CONFIG_START..0xFF)
                      00043 ; ============================================================================
                      00044  ERRORLEVEL -302
066B                  00045 WriteConf
066B   0064           00046   clrwdt
066C   137F           00047   bcf     SAVETOEE  ; reseteo el flag
066D   1703           00048   bsf     STATUS,RP1          ;
066E   1683           00049   bsf     STATUS,RP0          ; --> BANK3
066F   188C           00050   btfsc   EECON1,WR           ; \Wait for write
0670   2???           00051   goto    $-1                 ; /to complete
0671   1283           00052   bcf     STATUS, RP0         ; --> BANK2
0672   018D           00053   clrf    EEADR               ; Address to write
0673   018F           00054   clrf    EEADRH
0674   30B8           00055   movlw   MARCA_EE_OK         ; Data Memory Value
0675   008C           00056   movwf   EEDATA              ; w --> EEDATA
0676   1683           00057   bsf     STATUS,RP0          ; --> BANK3
0677   138C           00058   bcf     EECON1,EEPGD        ; Point to DATA
                      00059   ;memory
0678   150C           00060   bsf     EECON1,WREN ;Enable writes
0679   138B           00061   bcf     INTCON,GIE ;Disable INTs.
067A   1B8B           00062   btfsc   INTCON,GIE
067B   2???           00063   goto    $-2
                      00064   ; >>>> bloque loco para pasar la protección >>>>
067C   3055           00065   movlw   0x55         ;
067D   008D           00066   movwf   EECON2       ;Write 55h
067E   30AA           00067   movlw   0xAA         ;
067F   008D           00068   movwf   EECON2         ;Write AAh
0680   148C           00069   bsf     EECON1,WR      ;Set WR bit to
                      00070   ;begin write
                      00071   ; <<<< bloque loco para pasar la protección <<<<
0681   178B           00072   bsf     INTCON,GIE          ;Enable INTs.
                      00073   ; sigo en BANK3
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 104


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0682                  00074 WriteConInit
0682   1383           00075   bcf     STATUS,IRP     ; pasa a banco 0/1 para direccionamiento indirecto
0683   30C0           00076   movlw   CONFIG_START   ; cargo la dirección de inicio de variables persistentes
0684   0084           00077   movwf   FSR
                      00078   ; sigo en BANK3
0685                  00079 WriteConfLoop
0685   188C           00080   btfsc   EECON1,WR           ; \Wait for write
0686   2???           00081   goto    $-1                 ; /to complete
0687   0064           00082   clrwdt
0688   1283           00083   bcf     STATUS, RP0         ; --> BANK2
0689   0A8D           00084   incf    EEADR,f             ; Address to write
068A   0800           00085   movf    INDF,w              ; (FSR->f) --> w
068B   008C           00086   movwf   EEDATA              ; w --> EEDATA
068C   1683           00087   bsf     STATUS,RP0          ; --> BANK3
068D   138B           00088   bcf     INTCON,GIE ;Disable INTs.
068E   1B8B           00089   btfsc   INTCON,GIE
068F   2???           00090   goto    $-2
                      00091   ; >>>> bloque loco para pasar la protección >>>>
0690   3055           00092   movlw   0x55                ;
0691   008D           00093   movwf   EECON2              ;Write 55h
0692   30AA           00094   movlw   0xAA                ;
0693   008D           00095   movwf   EECON2              ;Write AAh
0694   148C           00096   bsf     EECON1,WR           ;Set WR bit to
                      00097   ;begin write
                      00098   ; <<<< bloque loco para pasar la protección <<<<
0695   178B           00099   bsf     INTCON,GIE          ;Enable INTs.
0696   0F84           00100   incfsz  FSR,f               ; recorro hasta el overflow del FSR (cuando excede 0xFF)
0697   2???           00101   goto    WriteConfLoop
0698                  00102 WriteConfEnd
0698   110C           00103   bcf     EECON1,WREN         ;Disable writes
0699   1283           00104   bcf     STATUS,RP0          ; --> BANK0
069A   1303           00105   bcf     STATUS,RP1
069B   0008           00106   return
                      00107  ERRORLEVEL +302
                      00249 ; ============================================================================
                      00250 ; ============================================================================
                      00251 ; Tratamiento del vector de RESET (Main)
                      00252 ; ============================================================================
069C                  00253 Init
069C   0064           00254   clrwdt
069D   0183           00255   clrf    STATUS        ;bank 0  ; Registros de configuracion
069E   018B           00256   clrf    INTCON
069F   018C           00257   clrf    PIR1
                      00258  ERRORLEVEL -302
06A0   1683           00259   bsf     STATUS,RP0 ; --> BANK1
                      00260   ; (7)    pull-up disabled
                      00261   ; (3)    prescaler to WDT
                      00262   ; (0..2) prescaler rate 1:128
06A1   308F           00263   movlw   0x8F
06A2   0081           00264   movwf   OPTION_REG
                      00265   ; PIE2
06A3   018D           00266   clrf    PIE2
06A4   1283           00267   bcf     STATUS,RP0 ; --> BANK0
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 105


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00268  ERRORLEVEL +302
                      00269   ; INTCON
06A5   168B           00270   bsf     INTCON,T0IE     ; interrupcion del TIMER0
06A6   160B           00271   bsf     INTCON,INTE     ; interrupcion externa (RB0)
06A7   170B           00272   bsf     INTCON,PEIE     ; necesario para el serial
                      00273   ; TIMER1 por ahora no uso
06A8   0190           00274   clrf    T1CON
                      00275   ; Seteo el TIMER2 para transmisión de código infra-rojo
06A9   3005           00276   movlw   0x05    ; Pre=1:4, TMR2ON, Post=1:1
06AA   0092           00277   movwf   T2CON
                      00278  ERRORLEVEL -302
06AB   1683           00279   bsf     STATUS,RP0 ; --> BANK1
06AC   307D           00280   movlw   0x7D            ; PR2=125
06AD   0092           00281   movwf   PR2
06AE   148C           00282   bsf     PIE1,TMR2IE      ; Interrupcion del TIMER2
06AF   1283           00283   bcf     STATUS,RP0 ; --> BANK0
                      00284  ERRORLEVEL +302
                      00285   ; Inicializacion de perifericos
06B0   019F           00286   clrf    ADCON0
                      00287  ERRORLEVEL -302
                      00288  ifdef __16F887
06B1   0197           00289   clrf    CCP1CON
06B2   019D           00290   clrf    CCP2CON
06B3   1683           00291   bsf     STATUS,RP0 ; --> BANK1
06B4   3080           00292   movlw   0x80
06B5   009F           00293   movwf   ADCON1
06B6   0195           00294   clrf    WPUB  ; disable pull-ups PORTB
06B7   0196           00295   clrf    IOCB  ; disable PORTB Ints PORTB
06B8   1703           00296   bsf     STATUS,RP1 ; --> BANK3
06B9   0187           00297   clrf    CM1CON0
06BA   0188           00298   clrf    CM2CON0
06BB   0189           00299   clrf    CM2CON1
06BC   0188           00300   clrf    ANSEL
06BD   0189           00301   clrf    ANSELH
06BE   1408           00302   bsf     ANSEL,ANS0
06BF   1488           00303   bsf     ANSEL,ANS1
06C0   1508           00304   bsf     ANSEL,ANS2
06C1   1588           00305   bsf     ANSEL,ANS3
06C2   1283           00306   bcf     STATUS,RP0 ;
06C3   1303           00307   bcf     STATUS,RP1 ; --> BANK0
                      00308  else
                      00309   bsf     STATUS,RP0 ; --> BANK1
                      00310   movlw   0xC2
                      00311   movwf   ADCON1
                      00312   bcf     STATUS,RP0 ; --> BANK0
                      00313  endif
                      00314  ERRORLEVEL +302
                      00315   ; Inicialización de PORTS
                      00316  ERRORLEVEL -302
06C4   1683           00317   bsf     STATUS,RP0 ; --> BANK1
                      00318   ; PORTA: salida solamente RA4
06C5   30EF           00319   movlw   0xEF
06C6   0085           00320   movwf   TRISA
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 106


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00321   ; PORTB: INT0 como entrada, las demás salida.
06C7   3001           00322   movlw   0x01
06C8   0086           00323   movwf   TRISB
                      00324   ; PORTC: no se toca, cada función especial que lo configure
                      00325   ; PORTD: para arrancar se deja todo entrada, no se toca
                      00326   ; PORTE: todas salidas
06C9   3000           00327   movlw   0x00
06CA   0089           00328   movwf   TRISE
06CB   1283           00329   bcf     STATUS,RP0 ; --> BANK0
                      00330  ERRORLEVEL +302
                      00331   ; estado inicial del multiplexor --> nada seleccionado
06CC   1606           00332   bsf     NIN1
06CD   1786           00333   bsf     NIN2
06CE   1306           00334   bcf     OUT1
06CF   1286           00335   bcf     OUT2
                      00336   ; estado inicial de lineas de control del display
06D0   1486           00337   bsf     DISPLAY_EN
06D1   1106           00338   bcf     DISPLAY_RS
06D2   1186           00339   bcf     DISPLAY_RW
                      00340   ; estado inicial del PORT A y E
06D3   0185           00341   clrf    PORTA
06D4   0189           00342   clrf    PORTE
                      00343   ;
                      00344  ERRORLEVEL -302
06D5   1683           00345   bsf     STATUS,RP0    ; --> BANK1
06D6   01D0           00346   clrf    ContPulseE1B0
06D7   01D1           00347   clrf    ContPulseE1B1
06D8   01D2           00348   clrf    ContPulseE1B2
06D9   01D3           00349   clrf    ContPulseE1B3
06DA   01D4           00350   clrf    ContPulseE1B4
06DB   01D5           00351   clrf    ContPulseE1B5
06DC   01D6           00352   clrf    ContPulseE1B6
06DD   01D7           00353   clrf    ContPulseE1B7
06DE   01D8           00354   clrf    ContPulseE2B0
06DF   01D9           00355   clrf    ContPulseE2B1
06E0   01DA           00356   clrf    ContPulseE2B2
06E1   01DB           00357   clrf    ContPulseE2B3
06E2   01DC           00358   clrf    ContPulseE2B4
06E3   01DD           00359   clrf    ContPulseE2B5
06E4   01DE           00360   clrf    ContPulseE2B6
06E5   01DF           00361   clrf    ContPulseE2B7
06E6   30FF           00362   movlw   0xFF
06E7   00C0           00363   movwf   MaskNotifE1
06E8   00C1           00364   movwf   MaskNotifE2
06E9   00C2           00365   movwf   MaskNotifS1
06EA   00C3           00366   movwf   MaskNotifS2
06EB   00C4           00367   movwf   MaskNotifAN
06EC   00E0           00368   movwf   ANALOG1_MAXH
06ED   00E1           00369   movwf   ANALOG1_MAXL
06EE   00E4           00370   movwf   ANALOG2_MAXH
06EF   00E5           00371   movwf   ANALOG2_MAXL
06F0   00E8           00372   movwf   ANALOG3_MAXH
06F1   00E9           00373   movwf   ANALOG3_MAXL
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 107


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

06F2   00EC           00374   movwf   ANALOG4_MAXH
06F3   00ED           00375   movwf   ANALOG4_MAXL
06F4   01E2           00376   clrf    ANALOG1_MINH 
06F5   01E3           00377   clrf    ANALOG1_MINL 
06F6   01E6           00378   clrf    ANALOG2_MINH 
06F7   01E7           00379   clrf    ANALOG2_MINL 
06F8   01EA           00380   clrf    ANALOG3_MINH 
06F9   01EB           00381   clrf    ANALOG3_MINL 
06FA   01EE           00382   clrf    ANALOG4_MINH 
06FB   01EF           00383   clrf    ANALOG4_MINL
06FC   301F           00384   movlw   0x1F
06FD   00B3           00385   movwf   ADALRM1DELAY
06FE   00B4           00386   movwf   ADALRM2DELAY
06FF   00B5           00387   movwf   ADALRM3DELAY
0700   00B6           00388   movwf   ADALRM4DELAY
0701   1283           00389   bcf     STATUS,RP0    ; --> BANK0
                      00390  ERRORLEVEL +302
                      00391   ; inicializacion de los buffers
0702   3010           00392   movlw   TXINITBUFFER  ; Inicio del buffer de transmisión
0703   00A9           00393   movwf   TxPtrAdd
0704   00AA           00394   movwf   TxPtrSnd
0705   3090           00395   movlw   RXINITBUFFER
0706   00AB           00396   movwf   RxPtrAdd
0707   00AC           00397   movwf   RxPtrAddTmp
0708   00AD           00398   movwf   RxPtrRcv
0709   01AF           00399   clrf    RxCharCount
070A   01B0           00400   clrf    RxCharSum
070B   01B1           00401   clrf    RxTimeOut
070C   01A8           00402   clrf    Variant
070D   01CF           00403   clrf    IRCount
                      00404   ; Para que notifique todos los estados al ponerse online
070E   300A           00405   movlw   REINTENTOS
070F   00B7           00406   movwf   CountNotifE1
0710   00B8           00407   movwf   CountNotifE2
0711   00BD           00408   movwf   CountNotifS1
0712   00BE           00409   movwf   CountNotifS2
0713   00B9           00410   movwf   CountNotifA1
0714   00BA           00411   movwf   CountNotifA2
0715   00BB           00412   movwf   CountNotifA3
0716   00BC           00413   movwf   CountNotifA4
                      00414   ; Inicializo los divisores del timer
0717   3024           00415   movlw   DIVISOR1
0718   00A3           00416   movwf   TDIV1
0719   3064           00417   movlw   DIVISOR2
071A   00A4           00418   movwf   TDIV2
071B   01F4           00419   clrf    ENTRADA1
071C   01F5           00420   clrf    ENTRADA2
071D   01F2           00421   clrf    SALIDA1
071E   01F3           00422   clrf    SALIDA2
071F   01F9           00423   clrf    ANALOG_FLGS
0720   01FB           00424   clrf    DISPLAY_FLGS
                      00425   ; inicializo las mascaras de seguidores
0721   01F6           00426   clrf    Mascara_E1S1
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 108


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0722   01F7           00427   clrf    Mascara_E2S2
0723   01F8           00428   clrf    Mascara_ANS2
                      00429   ;
0724   01A5           00430   clrf    DelayDisplay
0725   01B6           00431   clrf    DelayResend
0726   01C7           00432   clrf    ConvertDelay
0727   01B3           00433   clrf    SaveEECount
0728   01B4           00434   clrf    ResetCount
0729   01C8           00435   clrf    CntTrafic
072A   01B2           00436   clrf    RxLastCnt
072B   01CC           00437   clrf    RegTmpD
072C   01CD           00438   clrf    RegTmpL
                      00439   ; Default Address
072D   30FE           00440   movlw   DEFADDR
072E   00F1           00441   movwf   LocAddr
                      00442  ERRORLEVEL -302
072F   1683           00443   bsf     STATUS,RP0 ; --> BANK1
0730   01C7           00444   clrf    LocSeg
0731   01C6           00445   clrf    LocMin
0732   01C5           00446   clrf    LocHora
0733   01C9           00447   clrf    LocFecha
0734   01C8           00448   clrf    LocDia
0735   01CA           00449   clrf    LocMes
0736   01CB           00450   clrf    LocAnio
0737   01B0           00451   clrf    BeepCount
0738   01AE           00452   clrf    BeepRetry
0739   01AF           00453   clrf    BeepDelay
073A   01A7           00454   clrf    DisplayTO
073B   01B1           00455   clrf    BKSALIDA1
073C   01B2           00456   clrf    BKSALIDA2
073D   1283           00457   bcf     STATUS,RP0 ; --> BANK0
                      00458  ERRORLEVEL +302
                      00459   ; Default Baud Rate
073E   3017           00460   movlw   0x17       ; 9600
073F   00FA           00461   movwf   BaudRate
                      00462 ; =============================================================================
0740   2???           00463   call    ReadConf        ; LECTURA CONFIGURACION
                      00464 ; =============================================================================
                      00465   ; inicialización Serial (despues de leer configuracion por el baudrate)
                      00466  ERRORLEVEL -302
                      00467   ; Baud Rate
0741   087A           00468   movf    BaudRate,w
0742   1683           00469   bsf     STATUS,RP0 ; --> BANK1
0743   0099           00470   movwf   SPBRG
                      00471   ; Tx
0744   1307           00472   bcf     TRISC,6          ; TX como output
0745   3024           00473   movlw   0x24             ; Enable TX, 8 Bit, Synch, High baud rate
0746   0098           00474   movwf   TXSTA
0747   1283           00475   bcf     STATUS,RP0 ; --> BANK0
                      00476  ERRORLEVEL +302
                      00477   ; Rx
0748   3090           00478   movlw   0x90             ; Enable Rx, 8 bit, Synch, Continuous
0749   0098           00479   movwf   RCSTA
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 109


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

074A   1798           00480   bsf     RCSTA,SPEN       ; habilito Rx
                      00481  ERRORLEVEL -302
074B   1683           00482   bsf     STATUS,RP0 ; --> BANK1
074C   168C           00483   bsf     PIE1,RCIE        ; Interrupcion de Rx
074D   1283           00484   bcf     STATUS,RP0 ; --> BANK0
                      00485  ERRORLEVEL +302
                      00486   ; Inicialización de flags (despues de leer configuracion)
074E   01FE           00487   clrf    IOFLAGS
074F   01FF           00488   clrf    STATFLAGS
0750   157E           00489   bsf     CAMBIO_S1
0751   15FE           00490   bsf     CAMBIO_S2
0752   107E           00491   bcf     CAMBIO_E1
0753   10FE           00492   bcf     CAMBIO_E2
0754   127E           00493   bcf     CAMBIO_AN
0755   11FB           00494   bcf     DATE_OK           ; para que pida la fecha y hora al host
0756   10FB           00495   bcf     DISPLAY_INIT      ; --- para que haga la inicialización
0757   157B           00496   bsf     DISPLAY_DATA      ; -/
                      00497   ;
0758   178B           00498   bsf     INTCON,GIE    ; habilitacion global de interrupciones
                      00499   ;
0759   3005           00500   movlw   0x05
075A   00B5           00501   movwf   DelayStart
075B   2???           00502   call    LongBeep
                      00503  ERRORLEVEL -306
                      00504   ; Salto a la pagina 1 y llamo a DISPLAY_Refresh para que inicialice el display
075C   ???? ????      00505   PAGESEL DISPLAY_Refresh
075E   2???           00506   call    DISPLAY_Refresh
075F   ???? ????      00507   PAGESEL $
                      00508  ERRORLEVEL +306
0761   2???           00509   goto    Main
                      00510 ; ============================================================================
                      00511 ; Loop del programa
                      00512 ; ============================================================================
0762                  00513 Main
0762   0064           00514   clrwdt
0763   1CFF           00515   btfss   SYSREADY
0764   2???           00516   goto    Main          ; no entro al loop hasta que no está listo
0765   1218           00517   bcf     RCSTA,CREN    ; reseteo la recepción
0766   1618           00518   bsf     RCSTA,CREN
                      00519   ; para que muestre la Screen0 (si está el display)
0767   01FC           00520   clrf    ScrnId
0768   157B           00521   bsf     DISPLAY_DATA
0769                  00522 MainLoop
0769   0064           00523   clrwdt
                      00524   ; >> Procesamiento interno >>
076A   2???           00525   call    Presencia
076B   2???           00526   call    CtrlSeguim
076C   2???           00527   call    STATUS_Refresh
076D   2???           00528   call    RxDequeue
076E   2???           00529   call    TxDequeueCtrl
076F   2???           00530   call    CheckRxOverflow
                      00531  ERRORLEVEL -306
                      00532   ; Funciones de la PAGE 1
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 110


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0770   ???? ????      00533   PAGESEL IO_Refresh
0772   2???           00534   call    IO_Refresh
0773   ???? ????      00535   PAGESEL DISPLAY_Refresh
0775   2???           00536   call    DISPLAY_Refresh
0776   ???? ????      00537   PAGESEL CLOCK_Refresh
0778   2???           00538   call    CLOCK_Refresh
                      00539   ; Funciones de la PAGE 2
0779   ???? ????      00540   PAGESEL Notificaciones
077B   2???           00541   call    Notificaciones
                      00542   ; Vuelvo a la pagina de inicio
077C   ???? ????      00543   PAGESEL $
                      00544  ERRORLEVEL +306
                      00545   ; Grabo EE
077E   1B7F           00546   btfsc   SAVETOEE 
077F   2???           00547   call    WriteConf
                      00548   ; vuelta a empesar
0780   2???           00549   goto  MainLoop
                      00550 ; ============================================================================
                      00551 ; STATUS_Refresh
                      00552 ;   mantiene el led de status, el buzzer y controla los botones
                      00553 ;               STAT_LED   <-
                      00554 ;               BUZZER     <-
                      00555 ;               BTN_EN     -> EXT_BOTONES (BANK1)
                      00556 ; ============================================================================
0781                  00557 STATUS_Refresh
                      00558   ; sondeo los botones
                      00559 ;  bsf     BTN_EN
                      00560 ;  nop
                      00561 ;  movf    DATABUS,w
                      00562 ;  bcf     BTN_EN
                      00563 ;  movwf   EXT_BOTONES
                      00564   ; Blink del led de status
0781                  00565 STATUS_Led
0781   1683           00566   bsf     STATUS,RP0 ; --> BANK1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0782   0847           00567   movf    LocSeg,w
0783   1283           00568   bcf     STATUS,RP0 ; --> BANK0
0784   1C7F           00569   btfss   HSTONLINE
0785   2???           00570   goto    STATUS_Led_HOff
0786   3901           00571   andlw   0x01
0787   1D03           00572   btfss   STATUS,Z
0788   1009           00573   bcf     STAT_LED
0789   1903           00574   btfsc   STATUS,Z
078A   1409           00575   bsf     STAT_LED
                      00576   ;
078B   2???           00577   goto    STATUS_Led_End
                      00578 
078C                  00579 STATUS_Led_HOff
078C   3904           00580   andlw   0x04
078D   1D03           00581   btfss   STATUS,Z
078E   1009           00582   bcf     STAT_LED
078F   1903           00583   btfsc   STATUS,Z
0790   1409           00584   bsf     STAT_LED
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 111


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0791                  00585 STATUS_Led_End
                      00586   ; FALTA ...
                      00587 
                      00588 
                      00589 
0791   0008           00590   return
                      00591 ; ============================================================================
                      00592 ; Presencia - Se envia por unica vez un par de segundos luego del arranque
                      00593 ;              si no hay respuesta se reenvia cada 30 segundos
                      00594 ; ============================================================================
0792                  00595 Presencia
                      00596   ; solamente si está off-line
0792   187F           00597   btfsc   HSTONLINE
0793   0008           00598   return
                      00599   ; me fijo si tengo que esperar
0794   08B6           00600   movf    DelayResend,f
0795   1D03           00601   btfss   STATUS,Z
0796   0008           00602   return
                      00603   ; Un beep por cada echo offline
0797   2???           00604   call    ShortBeep
                      00605   ; Reintento cada 90 Seg
0798   305A           00606   movlw   0x5A
0799   00B6           00607   movwf   DelayResend
                      00608   ; Inicializo el ensaje
079A   2???           00609   call    ClrTx
                      00610   ; >>>> mensaje de presencia >>>>
079B   3051           00611   movlw   'Q'        ; start char
079C   00E0           00612   movwf   txtyp
079D   3000           00613   movlw   HSTADDR    ; dest addr
079E   00E1           00614   movwf   txdst
079F   0871           00615   movf    LocAddr,w  ; local addr
07A0   00E2           00616   movwf   txsrc
07A1   0828           00617   movf    Variant,w  ; contador
07A2   00E3           00618   movwf   txcnt
07A3   3050           00619   movlw   'P'        ; comando - 'P' = Aviso de presencia o ping
07A4   00E4           00620   movwf   txfcn
07A5   3002           00621   movlw   HARTYPE    ; tipo de dispositivo
07A6   00E5           00622   movwf   txdat1
07A7   3001           00623   movlw   HARDVER    ; version de dispositivo
07A8   00E6           00624   movwf   txdat2
07A9   3001           00625   movlw   SOFTVER    ; version de software
07AA   00E7           00626   movwf   txdat3
07AB   3003           00627   movlw   PROCESSOR_VER ; micro procesador
07AC   00E8           00628   movwf   txdat4
07AD   3000           00629   movlw   0             ; presencia de display
07AE   187B           00630   btfsc   DISPLAY_OK
07AF   3050           00631   movlw   0x50 ; display de 80 caracteres
07B0   00E9           00632   movwf   txdat5
                      00633   ; <<<< mensaje de presencia <<<<
                      00634   ; lo encola y termina
07B1   2???           00635   goto    TxEnqueue
                      00636 
                      00637 ; ============================================================================
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 112


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00638 ; CtrlSeguim - SALIDA(n+1) = ( ENTRADA & MASCARA ) | ( SALIDA(n) & -MASCARA )
                      00639 ; ============================================================================
07B2                  00640 CtrlSeguim
07B2   187E           00641   btfsc   CAMBIO_E1
07B3   2???           00642   call    CtrlSeguim1
07B4   1283           00643   bcf     STATUS,RP0 ; --> BANK0
07B5   18FE           00644   btfsc   CAMBIO_E2
07B6   2???           00645   call    CtrlSeguim2
07B7   1283           00646   bcf     STATUS,RP0 ; --> BANK0
07B8   1A7E           00647   btfsc   CAMBIO_AN
07B9   2???           00648   call    CtrlSeguimAN
07BA   1283           00649   bcf     STATUS,RP0 ; --> BANK0
07BB   0008           00650   return
                      00651 ; ----------------------------------------------------------------------------
07BC                  00652 CtrlSeguim1
07BC   107E           00653   bcf     CAMBIO_E1
                      00654   ; me hago un backup de la salida 1
07BD   0872           00655   movf    SALIDA1,w
07BE   00CB           00656   movwf   RegTmpG2
                      00657   ; (E & M)
07BF   0876           00658   movf    Mascara_E1S1,w
07C0   0574           00659   andwf   ENTRADA1,w
07C1   00CA           00660   movwf   RegTmpG
                      00661   ; -M
07C2   0876           00662   movf    Mascara_E1S1,w
07C3   3AFF           00663   xorlw   0xFF
                      00664   ; (Sn & -M)
07C4   0572           00665   andwf   SALIDA1,w
                      00666   ; (E & M) | (Sn & -M)
07C5   044A           00667   iorwf   RegTmpG,w
                      00668   ; w --> SALIDA1
07C6   00F2           00669   movwf   SALIDA1
07C7   157E           00670   bsf     CAMBIO_S1
07C8   0008           00671   return
                      00672 ; ----------------------------------------------------------------------------
07C9                  00673 CtrlSeguim2
07C9   10FE           00674   bcf     CAMBIO_E2
                      00675   ; me hago un backup de la salida 2
07CA   0873           00676   movf    SALIDA2,w
07CB   00CB           00677   movwf   RegTmpG2
                      00678   ; (E & M)
07CC   0877           00679   movf    Mascara_E2S2,w
07CD   0575           00680   andwf   ENTRADA2,w
07CE   00CA           00681   movwf   RegTmpG
                      00682   ; -M
07CF   0877           00683   movf    Mascara_E2S2,w
07D0   3AFF           00684   xorlw   0xFF
                      00685   ; (Sn & -M)
07D1   0573           00686   andwf   SALIDA2,w
                      00687   ; (E & M) | (Sn & -M)
07D2   044A           00688   iorwf   RegTmpG,w
                      00689   ; w --> SALIDA2
07D3   00F3           00690   movwf   SALIDA2
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 113


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

07D4   15FE           00691   bsf     CAMBIO_S2
07D5   0008           00692   return
                      00693 ; ----------------------------------------------------------------------------
07D6                  00694 CtrlSeguimAN
07D6   127E           00695   bcf     CAMBIO_AN
                      00696   ; me hago un backup de la salida 2
07D7   0873           00697   movf    SALIDA2,w
07D8   00CB           00698   movwf   RegTmpG2
                      00699   ; (AN & M)
07D9   0878           00700   movf    Mascara_ANS2,w
07DA   0579           00701   andwf   ANALOG_FLGS,w
07DB   00CA           00702   movwf   RegTmpG
                      00703   ; -M
07DC   0878           00704   movf    Mascara_ANS2,w
07DD   3AFF           00705   xorlw   0xFF
                      00706   ; (Sn & -M)
07DE   0573           00707   andwf   SALIDA2,w
                      00708   ; (AN & M) | (Sn & -M)
07DF   044A           00709   iorwf   RegTmpG,w
                      00710   ; w --> SALIDA2
07E0   00F3           00711   movwf   SALIDA2
07E1   15FE           00712   bsf     CAMBIO_S2
07E2   0008           00713   return
                      00714 ; ============================================================================
                      00715 ; ShortBeep - inicia un sonido corto del buzzer
                      00716 ; Short2Beep, Short3Beep, Short5Beep - 2, 3 y 5 pitidos
                      00717 ; ============================================================================
07E3                  00718 ShortBeep
07E3   3001           00719   movlw   0x01
07E4   2???           00720   goto   NumBeep
                      00721 ; -------------------------------------
07E5                  00722 Short2Beep
07E5   3002           00723   movlw   0x02
07E6   2???           00724   goto   NumBeep
                      00725 ; -------------------------------------
07E7                  00726 Short3Beep
07E7   3003           00727   movlw   0x03
07E8   2???           00728   goto   NumBeep
                      00729 ; -------------------------------------
07E9                  00730 Short5Beep
07E9   3005           00731   movlw   0x05
07EA   2???           00732   goto   NumBeep
                      00733 ; ============================================================================
                      00734 ; NumBeep - inicia tantos beeps como indique w
                      00735 ; ============================================================================
07EB                  00736 NumBeep
07EB   1489           00737   bsf     BUZZER        ; enciendo el buffer
                      00738  ERRORLEVEL -302
07EC   1683           00739   bsf     STATUS,RP0 ; --> BANK1
07ED   00AE           00740   movwf   BeepRetry     ; me traigo el valor de W y lo aplico a retry
07EE   03AE           00741   decf    BeepRetry,f   ; le resto uno
07EF   3006           00742   movlw   SHORT_BEEP    ; seteo la duracion del primer beep
07F0   00B0           00743   movwf   BeepCount
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 114


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

07F1   01AF           00744   clrf    BeepDelay     ; elimino el delay entre beeps
07F2   1283           00745   bcf     STATUS,RP0 ; --> BANK0
                      00746  ERRORLEVEL +302
07F3   0008           00747   return
                      00748 ; ============================================================================
                      00749 ; LongBeep - inicia un sonido largo del buzzer
                      00750 ; ============================================================================
07F4                  00751 LongBeep
07F4   1489           00752   bsf     BUZZER
07F5   3032           00753   movlw   LONG_BEEP
                      00754  ERRORLEVEL -302
07F6   1683           00755   bsf     STATUS,RP0 ; --> BANK1
07F7   00B0           00756   movwf   BeepCount
07F8   01AE           00757   clrf    BeepRetry
07F9   01AF           00758   clrf    BeepDelay
07FA   1283           00759   bcf     STATUS,RP0 ; --> BANK0
                      00760  ERRORLEVEL +302
07FB   0008           00761   return
                      00762 
                      00763 ; ============================================================================
2FE9 3FFF             00764   END
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 115


SYMBOL TABLE
  LABEL                             VALUE 

ABDEN                             00000000
ABDOVF                            00000007
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADALRM1DELAY                      000000B3
ADALRM2DELAY                      000000B4
ADALRM3DELAY                      000000B5
ADALRM4DELAY                      000000B6
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADC_READY                         ANALOG_FLGS,4
ADChan1                           00000B3F
ADChan2                           00000B4B
ADChan3                           00000B57
ADChan4                           00000B63
ADChanTbl                         00000809
ADCheck                           00000800
ADControl                         00000B70
ADCtrl1                           00000B72
ADCtrl1_off                       00000B8A
ADCtrl1_off2on                    00000BA7
ADCtrl1_off_l                     00000B93
ADCtrl1_on                        00000B79
ADCtrl1_on2off                    00000B9C
ADCtrl1_on_l                      00000B81
ADCtrl2                           00000BB1
ADCtrl2_off                       00000BC9
ADCtrl2_off2on                    00000BE6
ADCtrl2_off_l                     00000BD2
ADCtrl2_on                        00000BB8
ADCtrl2_on2off                    00000BDB
ADCtrl2_on_1                      00000BC0
ADCtrl3                           00000BF0
ADCtrl3_off                       00000C08
ADCtrl3_off2on                    00000C25
ADCtrl3_off_l                     00000C11
ADCtrl3_on                        00000BF7
ADCtrl3_on2off                    00000C1A
ADCtrl3_on_l                      00000BFF
ADCtrl4                           00000C2F
ADCtrl4_off                       00000C47
ADCtrl4_off2on                    00000C64
ADCtrl4_off_l                     00000C50
ADCtrl4_on                        00000C36
ADCtrl4_on2off                    00000C59
ADCtrl4_on_l                      00000C3E
ADCtrlFin                         00000C6E
ADDEN                             00000003
ADEnable                          00000B37
ADFM                              00000007
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 116


SYMBOL TABLE
  LABEL                             VALUE 

ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
AN1_UMBRAL                        ANALOG_FLGS,0
AN2_UMBRAL                        ANALOG_FLGS,1
AN3_UMBRAL                        ANALOG_FLGS,2
AN4_UMBRAL                        ANALOG_FLGS,3
ANALOG1H                          0000003F
ANALOG1L                          00000040
ANALOG1_MAXH                      000000E0
ANALOG1_MAXL                      000000E1
ANALOG1_MINH                      000000E2
ANALOG1_MINL                      000000E3
ANALOG2H                          00000041
ANALOG2L                          00000042
ANALOG2_MAXH                      000000E4
ANALOG2_MAXL                      000000E5
ANALOG2_MINH                      000000E6
ANALOG2_MINL                      000000E7
ANALOG3H                          00000043
ANALOG3L                          00000044
ANALOG3_MAXH                      000000E8
ANALOG3_MAXL                      000000E9
ANALOG3_MINH                      000000EA
ANALOG3_MINL                      000000EB
ANALOG4H                          00000045
ANALOG4L                          00000046
ANALOG4_MAXH                      000000EC
ANALOG4_MAXL                      000000ED
ANALOG4_MINH                      000000EE
ANALOG4_MINL                      000000EF
ANALOG_FLGS                       00000079
ANS0                              00000000
ANS1                              00000001
ANS10                             00000002
ANS11                             00000003
ANS12                             00000004
ANS13                             00000005
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS5                              00000005
ANS6                              00000006
ANS7                              00000007
ANS8                              00000000
ANS9                              00000001
ANSEL                             00000188
ANSELH                            00000189
BAUDCTL                           00000187
BCLIE                             00000003
BCLIF                             00000003
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 117


SYMBOL TABLE
  LABEL                             VALUE 

BEEP_DELAY                        0x0C
BF                                00000000
BKSALIDA1                         000000B1
BKSALIDA2                         000000B2
BOTONES                           000000A8
BRG0                              00000000
BRG1                              00000001
BRG10                             00000002
BRG11                             00000003
BRG12                             00000004
BRG13                             00000005
BRG14                             00000006
BRG15                             00000007
BRG16                             00000003
BRG2                              00000002
BRG3                              00000003
BRG4                              00000004
BRG5                              00000005
BRG6                              00000006
BRG7                              00000007
BRG8                              00000000
BRG9                              00000001
BRGH                              00000002
BSTADDR                           0xFF
BTNFILTER                         0x32
BTN_EN                            PORTE,2
BUZZER                            PORTE,1
BaudRate                          0000007A
BeepCount                         000000B0
BeepDelay                         000000AF
BeepRetry                         000000AE
Btn0                              0000099B
Btn0Off                           000009A7
Btn0On                            0000099D
Btn1                              000009AD
Btn1Off                           000009B9
Btn1On                            000009AF
Btn2                              000009BF
Btn2Off                           000009CB
Btn2On                            000009C1
Btn3                              000009D1
Btn3Off                           000009DD
Btn3On                            000009D3
Btn4                              000009E3
Btn4Off                           000009EF
Btn4On                            000009E5
Btn5                              000009F5
Btn5Off                           00000A01
Btn5On                            000009F7
Btn6                              00000A07
Btn6Off                           00000A13
Btn6On                            00000A09
Btn7                              00000A19
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 118


SYMBOL TABLE
  LABEL                             VALUE 

Btn7Off                           00000A25
Btn7On                            00000A1B
BtnExit                           00000A2B
C                                 00000000
C1CH0                             00000000
C1CH1                             00000001
C1IE                              00000005
C1IF                              00000005
C1OE                              00000005
C1ON                              00000007
C1OUT                             00000006
C1POL                             00000004
C1R                               00000002
C1RSEL                            00000005
C1SEN                             00000005
C2CH0                             00000000
C2CH1                             00000001
C2IE                              00000006
C2IF                              00000006
C2OE                              00000005
C2ON                              00000007
C2OUT                             00000006
C2POL                             00000004
C2R                               00000002
C2REN                             00000004
C2RSEL                            00000004
C2SYNC                            00000000
CAMBIO_AN                         IOFLAGS,4
CAMBIO_E1                         IOFLAGS,0
CAMBIO_E2                         IOFLAGS,1
CAMBIO_S1                         IOFLAGS,2
CAMBIO_S2                         IOFLAGS,3
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 119


SYMBOL TABLE
  LABEL                             VALUE 

CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CKE                               00000006
CKP                               00000004
CLOCK_Refresh                     00000C89
CM1CON0                           00000107
CM2CON0                           00000108
CM2CON1                           00000109
CONFIG_START                      0xC0
CONV_DELAY                        0x05
CREN                              00000004
CSRC                              00000007
CheckBtn                          0000099A
CheckPulse                        00000A7F
CheckPulseExit                    00000B00
CheckRxOverflow                   000001ED
ClockMant                         00000B09
ClockMant_End                     00000B1E
ClrRx                             000001F3
ClrTx                             00000100
CntTrafic                         00000048
ContBtn0                          000000A0
ContBtn1                          000000A1
ContBtn2                          000000A2
ContBtn3                          000000A3
ContBtn4                          000000A4
ContBtn5                          000000A5
ContBtn6                          000000A6
ContBtn7                          000000A7
ContPulseE1B0                     000000D0
ContPulseE1B1                     000000D1
ContPulseE1B2                     000000D2
ContPulseE1B3                     000000D3
ContPulseE1B4                     000000D4
ContPulseE1B5                     000000D5
ContPulseE1B6                     000000D6
ContPulseE1B7                     000000D7
ContPulseE2B0                     000000D8
ContPulseE2B1                     000000D9
ContPulseE2B2                     000000DA
ContPulseE2B3                     000000DB
ContPulseE2B4                     000000DC
ContPulseE2B5                     000000DD
ContPulseE2B6                     000000DE
ContPulseE2B7                     000000DF
ControlBeep                       0000096A
ControlBeep2                      0000097A
ControlChkSum                     000001E5
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 120


SYMBOL TABLE
  LABEL                             VALUE 

ControlRxByte                     000001BF
ControlRxStart                    000001CC
ControlRxStartOk                  000001DA
ControlSrc                        000001DF
ConvertDelay                      00000047
CountNotifA1                      00000039
CountNotifA2                      0000003A
CountNotifA3                      0000003B
CountNotifA4                      0000003C
CountNotifE1                      00000037
CountNotifE2                      00000038
CountNotifS1                      0000003D
CountNotifS2                      0000003E
CtrlSeguim                        000007B2
CtrlSeguim1                       000007BC
CtrlSeguim2                       000007C9
CtrlSeguimAN                      000007D6
CtrlStartAD                       00000A4D
CtrlTrafic                        00000A57
D                                 00000005
DATABUS                           PORTD
DATA_ADDRESS                      00000005
DATE_OK                           DISPLAY_FLGS,3
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DEC2ASCII                         00000817
DEC_H                             000000AB
DEC_L                             000000AD
DEC_M                             000000AC
DEFADDR                           0xFE
DISPLAY_CLOCK                     DISPLAY_FLGS,4
DISPLAY_DATA                      DISPLAY_FLGS,2
DISPLAY_EN                        PORTB,1
DISPLAY_FLGS                      0000007B
DISPLAY_INIT                      DISPLAY_FLGS,1
DISPLAY_OK                        DISPLAY_FLGS,0
DISPLAY_RS                        PORTB,2
DISPLAY_RW                        PORTB,3
DISPLAY_Refresh                   00000CD1
DIVISOR1                          0x24
DIVISOR2                          0x64
DUPMSG                            STATFLAGS,7
D_A                               00000005
D_NOT_A                           00000005
DelayDisplay                      00000025
DelayResend                       00000036
DelayStart                        00000035
Delay_1ms                         00000C7D
Delay_1ms_Loop                    00000C7F
Delay_x1ms                        00000C84
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 121


SYMBOL TABLE
  LABEL                             VALUE 

Delay_x1ms_Loop                   00000C85
Delay_x5us                        00000C77
Delay_x5us_Loop                   00000C78
DisplayCtrl                       0000091D
DisplayTO                         00000027
ECCPAS                            0000009C
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDAT                             0000010C
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
ENTRADA1                          00000074
ENTRADA2                          00000075
EXT_BOTONES                       000000A9
End_IO_Refresh                    00000E28
ErrCde1                           00000026
ExternInt                         00000969
F                                 00000001
FERR                              00000002
FSR                               00000004
FVREN                             00000000
FcnQ3                             00000341
FcnQ3Set                          00000355
FcnQ3SetA                         0000036B
FcnQ3SetB                         00000031
FcnQ3s1                           0000034E
FcnQ3s2                           00000352
FcnQ4                             0000036F
FcnQ5                             00000388
FcnQ5Set                          000003AD
FcnQ5s1                           0000039C
FcnQ5s2                           000003A5
FcnQ6                             000003B3
FcnQ6e1                           000003BF
FcnQ6e2                           000003C8
FcnQ7                             000003D1
FcnQ7s1                           000003DD
FcnQ7s2                           000003E8
FcnQ8                             000003F3
FcnQ8Fin                          00000463
FcnQ8e1                           00000408
FcnQ8e2                           0000041F
FcnQ8e3                           00000436
FcnQ8e4                           0000044D
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 122


SYMBOL TABLE
  LABEL                             VALUE 

FcnQA                             000004C4
FcnQA1                            000004D9
FcnQA2                            000004DC
FcnQA3                            000004DF
FcnQA4                            000004E2
FcnQASet                          000004E5
FcnQB                             000004BB
FcnQC                             00000546
FcnQC_LongBeep                    0000054E
FcnQD                             00000550
FcnQE                             0000055C
FcnQError                         0000031A
FcnQF                             000004F3
FcnQFEnd                          0000050F
FcnQFe1                           00000503
FcnQFe2                           00000507
FcnQFeA                           0000050B
FcnQG                             00000568
FcnQH                             00000574
FcnQI                             00000499
FcnQIOper                         000004AD
FcnQIs1                           000004A6
FcnQIs2                           000004AA
FcnQJ                             00000580
FcnQK                             0000058C
FcnQL                             0000046A
FcnQM                             00000598
FcnQN                             000005A4
FcnQO                             00000512
FcnQOEnd                          00000543
FcnQOe1                           0000052A
FcnQOe2                           0000052F
FcnQOeA                           0000053E
FcnQOk                            0000030D
FcnQOs1                           00000534
FcnQOs2                           00000539
FcnQP                             00000325
FcnQP1                            0000032C
FcnQQ                             000005B0
FcnQR                             00000494
FcnQT                             00000473
FcnR6                             000005C3
FcnR6e1                           000005CC
FcnR6e2                           000005D4
FcnR7                             000005DC
FcnR7s1                           000005E5
FcnR7s2                           000005ED
FcnR9                             000005F5
FcnR9a1                           00000606
FcnR9a2                           00000611
FcnR9a3                           0000061C
FcnR9a4                           00000627
FcnRP                             000005BB
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 123


SYMBOL TABLE
  LABEL                             VALUE 

FcnRT                             00000632
GCEN                              00000007
GIE                               00000007
GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
GetDateTime                       00000B20
GetPulseCountS1                   00000053
GetPulseCountS2                   0000005C
HARDVER                           0x01
HARTYPE                           0x02
HEX2DEC                           00000D83
HEX2DEC_H                         00000D88
HEX2DEC_L                         00000D96
HEX2DEC_M                         00000D8F
HEXADECIMAL                       000000AA
HSTADDR                           0x00
HSTONLINE                         STATFLAGS,0
HTS                               00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INT0                              PORTB,0
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOCB                              00000096
IOCB0                             00000000
IOCB1                             00000001
IOCB2                             00000002
IOCB3                             00000003
IOCB4                             00000004
IOCB5                             00000005
IOCB6                             00000006
IOCB7                             00000007
IOFLAGS                           0000007E
IO_Refresh                        00000D9B
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRCode1                           000000B9
IRCode2                           000000BA
IRCode3                           000000BB
IRCode4                           000000BC
IRCode5                           000000BD
IRCodeByte                        000000B7
IRCodeByteI                       000000B8
IRCodeInt                         00000923
IRCodeLoad1                       00000955
IRCodeLoad2                       00000959
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 124


SYMBOL TABLE
  LABEL                             VALUE 

IRCodeLoad3                       0000095D
IRCodeLoad4                       00000961
IRCodeLoad5                       00000965
IRCodeSend                        0000093B
IRCodeSendCont                    0000094F
IRCodeStart                       00000939
IRCodeStop                        00000936
IRCount                           0000004F
IRP                               00000007
IR_OUT                            PORTA,4
Init                              0000069C
LCD_BUSY                          00000CE3
LCD_DATOS                         00000CFE
LCD_E                             00000CDD
LCD_INI                           00000D13
LCD_LINE1                         00000D03
LCD_LINE1R                        00000D05
LCD_LINE2                         00000D07
LCD_LINE2R                        00000D09
LCD_LINE3                         00000D0B
LCD_LINE3R                        00000D0D
LCD_LINE4                         00000D0F
LCD_LINE4R                        00000D11
LCD_NO_PRESENT                    00000CF8
LCD_REG                           00000CFA
LONG_BEEP                         0x32
LTS                               00000001
L_BUSY                            00000CEB
LocAddr                           00000071
LocAnio                           000000CB
LocDia                            000000C8
LocFecha                          000000C9
LocHora                           000000C5
LocMes                            000000CA
LocMin                            000000C6
LocSeg                            000000C7
LongBeep                          000007F4
MARCA_EE_OK                       0xB8
MC1OUT                            00000007
MC2OUT                            00000006
MSK                               00000093
MSK0                              00000000
MSK1                              00000001
MSK2                              00000002
MSK3                              00000003
MSK4                              00000004
MSK5                              00000005
MSK6                              00000006
MSK7                              00000007
Main                              00000762
MainLoop                          00000769
Mascara_ANS2                      00000078
Mascara_E1S1                      00000076
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 125


SYMBOL TABLE
  LABEL                             VALUE 

Mascara_E2S2                      00000077
MaskNotifAN                       000000C4
MaskNotifE1                       000000C0
MaskNotifE2                       000000C1
MaskNotifS1                       000000C2
MaskNotifS2                       000000C3
NIN1                              PORTB,4
NIN2                              PORTB,7
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
Notificaciones                    00001100
NotificarAnalog                   0000114B
NotificarAnalog1                  00001151
NotificarAnalog1Cont              00001159
NotificarAnalog2                  00001175
NotificarAnalog2Cont              0000117D
NotificarAnalog3                  00001199
NotificarAnalog3Cont              000011A1
NotificarAnalog4                  000011BD
NotificarAnalog4Cont              000011C5
NotificarAnalogFin                000011E1
NotificarInput                    0000110B
NotificarInput1                   00001110
NotificarInput1Cont               00001118
NotificarInput2                   00001126
NotificarInput2Cont               0000112E
NotificarInputFin                 0000113B
NotificarOutput                   000011F7
NotificarOutput1                  000011FC
NotificarOutput1Cont              00001204
NotificarOutput2                  00001214
NotificarOutput2Cont              0000121C
NotificarOutputFin                0000122B
NumBeep                           000007EB
OERR                              00000001
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 126


SYMBOL TABLE
  LABEL                             VALUE 

OUT1                              PORTB,6
OUT2                              PORTB,5
P                                 00000004
P1M0                              00000006
P1M1                              00000007
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PROCESSOR_VER                     0x03
PRSEN                             00000007
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PSTRCON                           0000009D
PULSR                             00000002
PULSS                             00000003
PWM1CON                           0000009B
Presencia                         00000792
PrintAbril                        00000E77
PrintAgosto                       00000E93
PrintDiaSemana                    00000828
PrintDiciembre                    00000EAF
PrintDomingo                      00000E5B
PrintEnero                        00000E62
PrintFebrero                      00000E69
PrintJueves                       00000E46
PrintJulio                        00000E8C
PrintJunio                        00000E85
PrintLunes                        00000E31
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 127


SYMBOL TABLE
  LABEL                             VALUE 

PrintMartes                       00000E38
PrintMarzo                        00000E70
PrintMayo                         00000E7E
PrintMes                          00000830
PrintMiercoles                    00000E3F
PrintNoviembre                    00000EA8
PrintOctubre                      00000EA1
PrintSabado                       00000E54
PrintSeptiembre                   00000E9A
PrintViernes                      00000E4D
ProcessCmd                        00000270
ProcessCmdOk                      0000027A
ProcessError                      00000306
ProcessResp                       000002EB
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIDL                             00000006
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 128


SYMBOL TABLE
  LABEL                             VALUE 

RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
RE3                               00000003
READ_WRITE                        00000002
REINTENTOS                        0x0A
REINT_DELAY                       0x0C
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
RXBUFFULL                         STATFLAGS,3
RXCHAREND                         STATFLAGS,5
RXCHARERR                         STATFLAGS,4
RXINITBUFFER                      00000090
RXMAXBUFFER                       000000E9
R_NOT_W                           00000002
R_W                               00000002
ReadConf                          00000651
ReadConfEnd                       00000668
ReadConfLoop                      00000660
ReadConfValid                     0000065D
ReadEnt1                          00000DAB
ReadEnt1Bad                       00000DCC
ReadEnt1Loop                      00000DB2
ReadEnt1Ok                        00000DBB
ReadEnt1OkFin                     00000DC7
ReadEnt2                          00000DD1
ReadEnt2Bad                       00000DF3
ReadEnt2Loop                      00000DD9
ReadEnt2Ok                        00000DE2
ReadEnt2OkFin                     00000DEE
ReadIRetry                        0000004E
RegTmpD                           0000004C
RegTmpG                           0000004A
RegTmpG2                          0000004B
RegTmpI                           00000049
RegTmpL                           0000004D
ResetCount                        00000034
ResetCtrl                         00000C70
ResetLoop                         00000C75
RxAddBuffer                       00000205
RxAddBufferCtrlFull               00000218
RxAddBufferSetAddr                00000213
RxAddBufferVuelta                 00000216
RxBuffer2LCD                      00000D6C
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 129


SYMBOL TABLE
  LABEL                             VALUE 

RxChar                            0000002E
RxCharCount                       0000002F
RxCharSum                         00000030
RxDequeue                         0000021D
RxDequeueCtrlVuelta               00000266
RxDequeueCtrlVueltaSi             0000026D
RxDequeueMsg                      00000223
RxInt                             000001A8
RxIntEnd                          000001BB
RxIntErr                          000001B7
RxLastCnt                         00000032
RxPtrAdd                          0000002B
RxPtrAddTmp                       0000002C
RxPtrRcv                          0000002D
RxTimeOut                         00000031
RxTimeOutCtrl                     00000992
S                                 00000003
SALIDA1                           00000072
SALIDA2                           00000073
SAVETOEE                          STATFLAGS,6
SBOREN                            00000004
SCKP                              00000004
SCS                               00000000
SEN                               00000000
SENDB                             00000003
SEND_IR                           IOFLAGS,5
SENS_INPUT                        0x05
SHORT_BEEP                        0x06
SMP                               00000007
SOFTVER                           0x01
SPBRG                             00000099
SPBRGH                            0000009A
SPEN                              00000007
SR0                               00000006
SR1                               00000007
SRCON                             00000185
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPMSK                            00000093
SSPOV                             00000006
SSPSTAT                           00000094
STATFLAGS                         0000007F
STATUS                            00000003
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 130


SYMBOL TABLE
  LABEL                             VALUE 

STATUS_Led                        00000781
STATUS_Led_End                    00000791
STATUS_Led_HOff                   0000078C
STATUS_Refresh                    00000781
STAT_LED                          PORTE,0
STRA                              00000000
STRB                              00000001
STRC                              00000002
STRD                              00000003
STRSYNC                           00000004
SWDTEN                            00000000
SYNC                              00000004
SYSREADY                          STATFLAGS,1
SaveEECount                       00000033
SaveEECtrl                        00000B02
Screen0                           00000EB6
Screen1                           00000EDC
ScrnId                            0000007C
SelectScreen                      0000083D
SetBtn0Off                        00000A2F
SetBtn0On                         00000A2D
SetBtn1Off                        00000A33
SetBtn1On                         00000A31
SetBtn2Off                        00000A37
SetBtn2On                         00000A35
SetBtn3Off                        00000A3B
SetBtn3On                         00000A39
SetBtn4Off                        00000A3F
SetBtn4On                         00000A3D
SetBtn5Off                        00000A43
SetBtn5On                         00000A41
SetBtn6Off                        00000A47
SetBtn6On                         00000A45
SetBtn7Off                        00000A4B
SetBtn7On                         00000A49
SetWBitW                          00000065
Short2Beep                        000007E5
Short3Beep                        000007E7
Short5Beep                        000007E9
ShortBeep                         000007E3
StartCtrl                         00000A53
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GINV                            00000007
T1GIV                             00000007
T1GSS                             00000001
T1INSYNC                          00000002
T1OSCEN                           00000003
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 131


SYMBOL TABLE
  LABEL                             VALUE 

T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TDIV1                             00000023
TDIV2                             00000024
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISBUS                           TRISD
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 132


SYMBOL TABLE
  LABEL                             VALUE 

TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRISE3                            00000003
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXBUFFULL                         STATFLAGS,2
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXINITBUFFER                      00000010
TXMAXBUFFER                       0000006F
TXREG                             00000019
TXSTA                             00000098
TimerInt                          00000900
TxDequeueCtrl                     00000178
TxDequeueCtrlEnd                  00000185
TxDequeueCtrlUp                   0000017F
TxEnqueue                         00000112
TxEnqueueCtrlBuffer               00000169
TxEnqueueCtrlVuelta               0000016E
TxEnqueueCtrlVueltaSi             00000175
TxEnqueueEnd                      0000016D
TxInt                             00000187
TxIntCont                         00000195
TxIntEnd                          000001A6
TxIntResetBuffer                  000001A4
TxPtrAdd                          00000029
TxPtrSnd                          0000002A
UA                                00000001
ULPWUE                            00000005
ULPWUIE                           00000002
ULPWUIF                           00000002
VCFG0                             00000004
VCFG1                             00000005
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 133


SYMBOL TABLE
  LABEL                             VALUE 

VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000097
VREN                              00000007
VROE                              00000006
VRR                               00000005
VRSS                              00000004
Variant                           00000028
W                                 00000000
WCOL                              00000007
WDTCON                            00000105
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPUB                              00000095
WPUB0                             00000000
WPUB1                             00000001
WPUB2                             00000002
WPUB3                             00000003
WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WUE                               00000001
WriteConInit                      00000682
WriteConf                         0000066B
WriteConfEnd                      00000698
WriteConfLoop                     00000685
WriteSal1                         00000DF8
WriteSal1Cont                     00000E01
WriteSal2                         00000E10
WriteSal2Cont                     00000E19
Z                                 00000002
_.org_1_0A61                      00000A61
_.org_1_0A7C                      00000A7C
_.org_1_0B25                      00000B25
_.org_1_0B34                      00000B34
_.org_1_0D1A                      00000D1A
_.org_1_0D22                      00000D22
_.org_1_0D2A                      00000D2A
_.org_3_110E                      0000110E
_.org_3_1148                      00001148
_.org_3_114E                      0000114E
_.org_3_11F4                      000011F4
_.org_3_11FA                      000011FA
_.org_3_1238                      00001238
_.org_5_0012                      00000012
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 134


SYMBOL TABLE
  LABEL                             VALUE 

_.org_5_0018                      00000018
_.org_5_001E                      0000001E
_.org_6_0559                      00000559
_.org_6_0565                      00000565
_.org_6_0571                      00000571
_.org_6_057D                      0000057D
_.org_6_0589                      00000589
_.org_6_0595                      00000595
_.org_6_05A1                      000005A1
_.org_6_05AD                      000005AD
_.org_6_0670                      00000670
_.org_6_067B                      0000067B
_.org_6_0686                      00000686
_.org_6_068F                      0000068F
_.org_6_075F                      0000075F
_.org_6_077C                      0000077C
_BOR21V                           00003EFF
_BOR40V                           00003FFF
_BOR4V_BOR21V                     00003EFF
_BOR4V_BOR40V                     00003FFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
_BOR_NSLEEP                       00003EFF
_BOR_OFF                          00003CFF
_BOR_ON                           00003FFF
_BOR_SBODEN                       00003DFF
_CONFIG1                          00002007
_CONFIG2                          00002008
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         00001FFF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRC_CLKOUT                00003FFF
_FOSC_EXTRC_NOCLKOUT              00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTRC_CLKOUT                00003FFD
_FOSC_INTRC_NOCLKOUT              00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_HS_OSC                           00003FFA
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 135


SYMBOL TABLE
  LABEL                             VALUE 

_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_LVP_OFF                          00002FFF
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FF9
__16F887                          00000001
fsr_saved                         00000022
pb0s1                             00000A80
pb0s2                             00000AC0
pb1s1                             00000A88
pb1s2                             00000AC8
pb2s1                             00000A90
pb2s2                             00000AD0
pb3s1                             00000A98
pb3s2                             00000AD8
pb4s1                             00000AA0
pb4s2                             00000AE0
pb5s1                             00000AA8
pb5s2                             00000AE8
pb6s1                             00000AB0
pb6s2                             00000AF0
pb7s1                             00000AB8
pb7s2                             00000AF8
pclath_saved                      00000021
rxchksum                          0000005F
rxcnt                             00000053
rxdat1                            00000055
rxdat10                           0000005E
rxdat2                            00000056
rxdat3                            00000057
rxdat4                            00000058
rxdat5                            00000059
MPASM 5.61  /HOME/WALTER/DROPBOX/GNU-MONITOR   4-15-2015  10:07:05         PAGE 136


SYMBOL TABLE
  LABEL                             VALUE 

rxdat6                            0000005A
rxdat7                            0000005B
rxdat8                            0000005C
rxdat9                            0000005D
rxdst                             00000051
rxfcn                             00000054
rxsrc                             00000052
rxtyp                             00000050
status_saved                      00000020
txchksum                          0000006F
txcnt                             00000063
txdat1                            00000065
txdat10                           0000006E
txdat2                            00000066
txdat3                            00000067
txdat4                            00000068
txdat5                            00000069
txdat6                            0000006A
txdat7                            0000006B
txdat8                            0000006C
txdat9                            0000006D
txdst                             00000061
txfcn                             00000064
txsrc                             00000062
txtyp                             00000060
w_saved                           00000070

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     1 reported,   345 suppressed

